{"version":3,"file":"index.js","sources":["../node_modules/eventemitter3/index.js","../src/JSONClassRegistry.ts","../src/ToFromJSONEventEmitter.ts","../src/Manager.ts","../src/DefaultManager.ts","../src/Component.ts","../src/components/RenderableComponent.ts","../src/DefaultDescriptorManager.ts","../src/components/TransformComponentManager.ts","../src/components/TransformComponent.ts","../src/math/AABB2.ts","../src/math/index.ts","../src/components/Transform2D/Transform2D.ts","../src/components/Transform3D/Transform3D.ts","../src/components/Camera2D/Camera2DManager.ts","../src/components/Camera2D/Camera2D.ts","../src/plugins/assets/Asset.ts","../src/IRequirement.ts","../src/Plugin.ts","../src/plugins/assets/Assets.ts","../src/plugins/assets/JSONAsset.ts","../src/plugins/assets/RawJSONAsset.ts","../src/plugins/assets/ImageAsset.ts","../src/plugins/renderer/RendererHandler.ts","../src/plugins/renderer/Renderer.ts","../src/plugins/Time.ts","../src/plugins/RunOnUpdatePlugin.ts","../src/plugins/input/EventListener.ts","../src/plugins/input/InputAxis.ts","../src/plugins/input/InputButton.ts","../src/plugins/input/InputHandler.ts","../src/plugins/input/MouseInputHandler.ts","../src/plugins/input/KeyboardInputHandler.ts","../src/plugins/input/TouchInputHandler.ts","../src/plugins/input/ResizeInputHandler.ts","../src/plugins/input/Input.ts","../src/plugins/input/InputEvent.ts","../src/plugins/input/KeyboardInputEvent.ts","../src/plugins/input/MouseInputEvent.ts","../src/plugins/input/MouseWheelInputEvent.ts","../src/plugins/input/ResizeInputEvent.ts","../src/plugins/input/TouchInputEvent.ts","../src/plugins/FullScreenCanvas.ts","../src/plugins/requestAnimationFrame.ts","../src/plugins/EventLoop.ts","../src/plugins/Loop.ts","../src/components/Camera2D/Camera2DControlManager.ts","../src/components/Camera2D/Camera2DControl.ts","../src/components/Camera3D/Camera3DManager.ts","../src/components/Camera3D/Camera3D.ts","../src/components/Sprite/SpriteManager.ts","../src/components/Sprite/Sprite.ts","../src/components/Sprite/SpriteClip.ts","../src/components/Sprite/SpriteSheet.ts","../src/components/RunOnUpdateComponent.ts","../src/components/index.ts","../src/Entity.ts","../src/Scene.ts","../src/Canvas.ts","../src/web/plugins/renderer/CtxRendererHandler.ts","../src/web/plugins/renderer/2d/TransformCtxRendererHandler.ts","../src/web/plugins/renderer/2d/SpriteCtxRendererHandler.ts","../src/web/plugins/renderer/CtxRenderer.ts","../src/web/plugins/assets/WebImageAsset.ts","../src/web/plugins/input/WebEventListener.ts","../src/web/WebCanvas.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport class JSONClassRegistry {\n  private constructorToTypeId: Map<\n    IConstructor<ToFromJSONEventEmitter>,\n    string\n  > = new Map();\n  private typeIdToConstructor: Map<\n    string,\n    IConstructor<ToFromJSONEventEmitter>\n  > = new Map();\n\n  getByConstructor<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    klass: IConstructor<T>\n  ) {\n    const typeId = this.constructorToTypeId.get(klass);\n    if (typeId) {\n      const storedKlass = this.typeIdToConstructor.get(typeId);\n\n      if (klass === storedKlass) {\n        return typeId;\n      } else {\n        throw new Error(\n          `${klass} and ${storedKlass} are using the same typeId ${typeId}`\n        );\n      }\n    } else {\n      const typeId = (\n        klass as any as typeof ToFromJSONEventEmitter\n      ).getTypeId();\n      this.constructorToTypeId.set(klass, typeId);\n      this.typeIdToConstructor.set(typeId, klass);\n      return typeId;\n    }\n  }\n  getById<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    typeId: string\n  ): IConstructor<T> | null {\n    return (this.typeIdToConstructor.get(typeId) as IConstructor<T>) || null;\n  }\n}\n\nexport const globalJSONClassRegistry = new JSONClassRegistry();\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport type { ValidEventTypes } from \"eventemitter3\";\nimport { EventEmitter } from \"eventemitter3\";\n\nexport abstract class ToFromJSONEventEmitter<\n  EventTypes extends ValidEventTypes = any\n> extends EventEmitter<EventTypes> {\n  static typeId?: string;\n  static toFromJSONEnabled = true;\n\n  static toString() {\n    return this.getTypeId();\n  }\n  static getTypeId() {\n    return this.typeId || this.name;\n  }\n  static isToFromJSONEnabled() {\n    return !!this.toFromJSONEnabled;\n  }\n\n  static getConstructorFromJSON<\n    T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter\n  >(json: IJSONObject): IConstructor<T> {\n    const constructor = globalJSONClassRegistry.getById<T>(\n      json.typeId as string\n    );\n    if (!constructor) {\n      throw new Error(\n        `Failed to get class ${json.typeId} from globalJSONClassRegistry make sure the Component was added`\n      );\n    }\n    return constructor;\n  }\n\n  static newFromJSON<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    json: IJSONObject\n  ): T {\n    const ComponentClass = this.getConstructorFromJSON<T>(json);\n    return new ComponentClass().fromJSON(json);\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  toJSON(): IJSONObject {\n    const typeId = globalJSONClassRegistry.getByConstructor(\n      this.getConstructor()\n    );\n\n    return {\n      typeId,\n    };\n  }\n  fromJSON(_json: IJSONObject) {\n    return this;\n  }\n}\n\nimport { globalJSONClassRegistry } from \"./JSONClassRegistry\";\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { Component } from \"./Component\";\nimport type { Plugin } from \"./Plugin\";\nimport type { Scene } from \"./Scene\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport abstract class Manager<\n  C extends Component = Component\n> extends ToFromJSONEventEmitter {\n  static managerPriority = 0;\n\n  static getManagerPriority() {\n    return this.managerPriority;\n  }\n\n  protected scene: Scene | null = null;\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene) {\n    this.scene = scene;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene = null;\n    return this;\n  }\n  getScene() {\n    return this.scene;\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getManagerPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getManagerPriority();\n  }\n\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>): P | null {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getPlugin(Plugin);\n    } else {\n      return null;\n    }\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    const plugin = this.getPlugin<P>(Plugin);\n    if (!plugin) {\n      throw new Error(`${this.getConstructor()} required ${Plugin} Plugin`);\n    }\n    return plugin;\n  }\n\n  getManager<M extends Manager = Manager>(Manager: IConstructor<M>): M | null {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getManager(Manager);\n    } else {\n      return null;\n    }\n  }\n  getRequiredManager<M extends Manager = Manager>(Manager: IConstructor<M>): M {\n    const manager = this.getManager(Manager);\n    if (!manager) {\n      throw new Error(`${this.getConstructor()} required ${Manager} Manager`);\n    }\n    return manager;\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n\n  abstract addComponent(component: C): this;\n  abstract removeComponent(component: C): this;\n  abstract isEmpty(): boolean;\n  abstract sort(): this;\n  abstract onInit(): this;\n  abstract onUpdate(): this;\n  abstract onAfterUpdate(): this;\n}\n","import type { Component } from \"./Component\";\nimport { Manager } from \"./Manager\";\n\nexport class DefaultManager<\n  C extends Component = Component\n> extends Manager<C> {\n  private components: C[] = [];\n\n  getComponents() {\n    return this.components;\n  }\n\n  addComponent(component: C) {\n    this.components.push(component);\n    return this;\n  }\n  removeComponent(component: C) {\n    const index = this.components.indexOf(component);\n\n    if (index !== -1) {\n      this.components.splice(index, 1);\n    }\n\n    return this;\n  }\n  isEmpty() {\n    return this.components.length === 0;\n  }\n\n  sortFunction = (a: C, b: C) => {\n    return a.getRequiredEntity().getDepth() - b.getRequiredEntity().getDepth();\n  };\n\n  sort() {\n    this.components.sort(this.sortFunction);\n    return this;\n  }\n\n  onInit() {\n    for (const component of this.components) {\n      component.onInit();\n    }\n    return this;\n  }\n  onUpdate() {\n    for (const component of this.components) {\n      component.onUpdate();\n    }\n    return this;\n  }\n  onAfterUpdate() {\n    for (const component of this.components) {\n      component.onAfterUpdate();\n    }\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { IRequirement } from \"./IRequirement\";\nimport { DefaultManager } from \"./DefaultManager\";\nimport type { Entity } from \"./Entity\";\nimport type { Manager } from \"./Manager\";\nimport type { Plugin } from \"./Plugin\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface IComponentEventType {\n  \"add-to-scene\": () => void;\n  \"remove-from-scene\": () => void;\n}\n\nexport abstract class Component extends ToFromJSONEventEmitter<IComponentEventType> {\n  static Manager: IConstructor<Manager> = DefaultManager;\n  static requiredComponents: IRequirement<Component>[] = [];\n  static requiredPlugins: IRequirement<Plugin>[] = [];\n\n  static getManagerConstructor<M extends Manager = Manager>(): IConstructor<M> {\n    if (!this.Manager) {\n      throw new Error(this + \" invalid Manager `\" + this.Manager + \"` \" + this);\n    }\n    return this.Manager as IConstructor<M>;\n  }\n  static getRequiredComponents(): IRequirement<Component>[] {\n    return this.requiredComponents;\n  }\n  static getRequiredPlugins(): IRequirement<Plugin>[] {\n    return this.requiredPlugins;\n  }\n\n  private entity: Entity | null = null;\n  private manager: Manager | null = null;\n\n  getManagerConstructor<M extends Manager = Manager>(): IConstructor<M> {\n    return Object.getPrototypeOf(this).constructor.getManagerConstructor();\n  }\n  getRequiredComponents(): IRequirement<Component>[] {\n    return Object.getPrototypeOf(this).constructor.requiredComponents;\n  }\n  getRequiredPlugins(): IRequirement<Plugin>[] {\n    return Object.getPrototypeOf(this).constructor.requiredPlugins;\n  }\n\n  getComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C | null {\n    return this.entity ? this.entity.getComponent(Component) : null;\n  }\n  getRequiredComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C {\n    const component = this.getComponent(Component);\n    if (!component) {\n      throw new Error(\n        `${this.getConstructor()} Component requires ${Component} Component`\n      );\n    }\n    return component;\n  }\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getPlugin(Plugin);\n    } else {\n      return null;\n    }\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    const plugin = this.getPlugin(Plugin);\n    if (!plugin) {\n      throw new Error(\n        `${this.getConstructor()} Component requires ${Plugin} Plugin`\n      );\n    }\n    return plugin;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setEntity(entity: Entity) {\n    this.entity = entity;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeEntity() {\n    this.entity = null;\n    return this;\n  }\n  getEntity() {\n    return this.entity;\n  }\n  getRequiredEntity() {\n    const entity = this.getEntity();\n    if (!entity) {\n      throw new Error(`${this.getConstructor()} Component requires an Entity`);\n    }\n    return entity;\n  }\n\n  getScene() {\n    const entity = this.entity;\n    if (entity) {\n      return entity.getScene();\n    } else {\n      return null;\n    }\n  }\n  getRequiredScene() {\n    const svene = this.getScene();\n    if (!svene) {\n      throw new Error(`${this.getConstructor()} Component requires a Scene`);\n    }\n    return svene;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setManager(manager: Manager) {\n    this.manager = manager;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeManager() {\n    this.manager = null;\n    return this;\n  }\n  getManager<M extends Manager = Manager>(): M | null {\n    return this.manager as M;\n  }\n  getRequiredManager<M extends Manager = Manager>(): M {\n    const manager = this.getManager();\n    if (!manager) {\n      throw new Error(\n        `${this.getConstructor()} Component is not part of a Manager ${Object.getPrototypeOf(\n          this\n        ).getManagerConstructor()} Manager`\n      );\n    }\n    return manager as M;\n  }\n\n  getSceneManager<M extends Manager = Manager>(Manager: IConstructor<M>) {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getManager(Manager);\n    } else {\n      return null;\n    }\n  }\n  getRequiredSceneManager<M extends Manager = Manager>(\n    Manager: IConstructor<M>\n  ) {\n    const manager = this.getSceneManager(Manager);\n    if (!manager) {\n      throw new Error(\n        `${this.getConstructor()} Component requires ${Object.getPrototypeOf(\n          this\n        ).getManagerConstructor()} Manager`\n      );\n    }\n    return manager;\n  }\n\n  onInit() {\n    return this;\n  }\n  onDetach() {\n    return this;\n  }\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { Component } from \"../Component\";\n\nexport class RenderableComponent extends Component {\n  private renderable = true;\n\n  getRenderable() {\n    return this.renderable;\n  }\n  setRenderable(renderable = true) {\n    this.renderable = renderable;\n    return this;\n  }\n}\n","import type { Component } from \"./Component\";\nimport { DefaultManager } from \"./DefaultManager\";\n\nexport class DefaultDescriptorManager<\n  C extends Component = Component\n> extends DefaultManager<C> {\n  onInit() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { DefaultDescriptorManager } from \"../DefaultDescriptorManager\";\nimport type { TransformComponent } from \"./TransformComponent\";\n\nexport class TransformComponentManager extends DefaultDescriptorManager<TransformComponent> {}\n","import { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport type { Entity } from \"../Entity\";\nimport { RenderableComponent } from \"./RenderableComponent\";\nimport { TransformComponentManager } from \"./TransformComponentManager\";\n\nconst VEC2_0 = vec2.create(),\n  VEC3_0 = vec3.create();\n\nexport abstract class TransformComponent extends RenderableComponent {\n  static Manager = TransformComponentManager;\n\n  static getParentTransform(entity: Entity): TransformComponent | null {\n    const parent = entity.getParent();\n    if (parent) {\n      return TransformComponent.getTransform(parent);\n    } else {\n      return null;\n    }\n  }\n\n  static getTransform(entity: Entity): TransformComponent | null;\n  static getTransform(_entity: any): any {\n    return undefined;\n  }\n\n  static getRequiredTransform(entity: Entity) {\n    const transform = TransformComponent.getTransform(entity);\n    if (!transform) {\n      throw new Error(`Entity required a TransformComponent`);\n    }\n    return transform;\n  }\n\n  private needsUpdate = true;\n  private localNeedsUpdate = true;\n\n  onDetach() {\n    return this.setNeedsUpdate();\n  }\n\n  getParentTransform() {\n    const entity = this.getEntity();\n    if (entity) {\n      return TransformComponent.getParentTransform(entity);\n    } else {\n      return null;\n    }\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.setLocalNeedsUpdate(needsUpdate);\n\n    if (needsUpdate !== this.needsUpdate) {\n      this.needsUpdate = needsUpdate;\n      const entity = this.getEntity();\n      if (entity) {\n        for (const child of entity.getChildren()) {\n          for (const transform of child.getComponentsInstanceOf(\n            TransformComponent as any\n          )) {\n            (transform as TransformComponent).setNeedsUpdate(needsUpdate);\n          }\n        }\n      }\n    }\n    return this;\n  }\n  getNeedsUpdate() {\n    return this.needsUpdate;\n  }\n\n  setLocalNeedsUpdate(localNeedsUpdate = true) {\n    this.localNeedsUpdate = localNeedsUpdate;\n    return this;\n  }\n  getLocalNeedsUpdate() {\n    return this.localNeedsUpdate;\n  }\n\n  updateLocalMatrixIfNeeded() {\n    if (this.localNeedsUpdate) {\n      this.localNeedsUpdate = false;\n      return this.updateLocalMatrix();\n    } else {\n      return this;\n    }\n  }\n\n  updateMatrixIfNeeded() {\n    if (this.needsUpdate) {\n      this.needsUpdate = false;\n      return this.updateMatrix();\n    } else {\n      return this;\n    }\n  }\n\n  translate2(position: vec2): this {\n    const current = this.getLocalPosition2(VEC2_0);\n    vec2.add(current, current, position);\n    return this.setLocalPosition2(current);\n  }\n  translate3(position: vec3): this {\n    const current = this.getLocalPosition3(VEC3_0);\n    vec3.add(current, current, position);\n    return this.setLocalPosition3(current);\n  }\n\n  scale2(scale: vec2): this {\n    const current = this.getLocalScale2(VEC2_0);\n    vec2.mul(current, current, scale);\n    return this.setLocalPosition2(current);\n  }\n  scale3(scale: vec3): this {\n    const current = this.getLocalScale3(VEC3_0);\n    vec3.mul(current, current, scale);\n    return this.setLocalPosition3(current);\n  }\n\n  abstract updateLocalMatrix(): this;\n  abstract updateMatrix(): this;\n\n  abstract getMatrix2d(out: mat2d): mat2d;\n  abstract getMatrix4(out: mat4): mat4;\n\n  abstract getLocalMatrix2d(out: mat2d): mat2d;\n  abstract getLocalMatrix4(out: mat4): mat4;\n\n  abstract getLocalPosition2(out: vec2): vec2;\n  abstract getLocalPosition3(out: vec3): vec3;\n\n  abstract setLocalPosition2(localPosition: vec2): this;\n  abstract setLocalPosition3(localPosition: vec3): this;\n\n  abstract getLocalRotationZ(): number;\n  abstract getLocalRotationQuat(out: quat): quat;\n\n  abstract setLocalRotationZ(localRotation: number): this;\n  abstract setLocalRotationQuat(localRotation: quat): this;\n\n  abstract getLocalScale2(out: vec2): vec2;\n  abstract getLocalScale3(out: vec3): vec3;\n\n  abstract setLocalScale2(localScale: vec2): this;\n  abstract setLocalScale3(localScale: vec3): this;\n\n  abstract getPosition2(out: vec2): vec2;\n  abstract getPosition3(out: vec3): vec3;\n\n  abstract getRotationZ(): number;\n  abstract getRotationQuat(out: quat): quat;\n\n  abstract getScale2(out: vec2): vec2;\n  abstract getScale3(out: vec3): vec3;\n}\n","import { vec2 } from \"gl-matrix\";\n\nexport class AABB2 {\n  static create() {\n    return new AABB2();\n  }\n\n  static fromValues(min: vec2, max: vec2) {\n    return AABB2.set(AABB2.create(), min, max);\n  }\n\n  static set(out: AABB2, min: vec2, max: vec2) {\n    AABB2.setMin(out, min);\n    AABB2.setMax(out, max);\n    return out;\n  }\n  static setMin(out: AABB2, min: vec2) {\n    vec2.copy(out.min, min);\n    return out;\n  }\n  static setMax(out: AABB2, max: vec2) {\n    vec2.copy(out.max, max);\n    return out;\n  }\n\n  static identity(out: AABB2) {\n    vec2.set(out.min, Infinity, Infinity);\n    vec2.set(out.max, -Infinity, -Infinity);\n    return out;\n  }\n\n  static expandPoint(out: AABB2, aabb: AABB2, v: vec2) {\n    vec2.min(out.min, aabb.min, v);\n    vec2.max(out.max, aabb.max, v);\n    return out;\n  }\n\n  static union(out: AABB2, a: AABB2, b: AABB2) {\n    vec2.min(out.min, a.min, b.min);\n    vec2.max(out.max, a.max, b.max);\n    return out;\n  }\n\n  static intersects(a: AABB2, b: AABB2) {\n    return !this.notIntersects(a, b);\n  }\n\n  static notIntersects(a: AABB2, b: AABB2) {\n    return (\n      a.max[0] < b.min[0] ||\n      a.min[0] > b.max[0] ||\n      a.max[1] < b.min[1] ||\n      a.min[1] > b.max[1]\n    );\n  }\n\n  min: vec2 = vec2.fromValues(Infinity, Infinity);\n  max: vec2 = vec2.fromValues(-Infinity, -Infinity);\n}\n","import { mat2d, vec2, vec3, vec4, mat4 } from \"gl-matrix\";\nimport { AABB2 } from \"./AABB2\";\n\nexport const DEG_TO_RAD = Math.PI / 180;\nexport const RAD_TO_DEG = 180 / Math.PI;\nexport const HALF_PI = Math.PI * 0.5;\nexport const TAU = Math.PI * 2;\nexport const EPSILON = 0.000001;\n\nexport function composeMat2d(\n  out: mat2d,\n  position: vec2,\n  scale: vec2,\n  rotation: number\n): mat2d {\n  const sx = scale[0],\n    sy = scale[1],\n    c = Math.cos(rotation),\n    s = Math.sin(rotation);\n\n  out[0] = c * sx;\n  out[1] = s * sx;\n  out[2] = -s * sy;\n  out[3] = c * sy;\n  out[4] = position[0];\n  out[5] = position[1];\n\n  return out;\n}\n\nconst extractScale_VEC2_0 = vec2.create();\n\nexport function extractScale(out: vec2, matrix: mat2d): vec2 {\n  return vec2.set(\n    out,\n    vec2.len(vec2.set(extractScale_VEC2_0, matrix[0], matrix[1])),\n    vec2.len(vec2.set(extractScale_VEC2_0, matrix[2], matrix[3]))\n  );\n}\n\nexport function decomposeMat2d(\n  matrix: mat2d,\n  position: vec2,\n  scale: vec2\n): number {\n  vec2.set(position, matrix[4], matrix[5]);\n  extractScale(scale, matrix);\n  return getRotationFromMat2d(matrix);\n}\n\nexport function getRotationFromMat2d(matrix: mat2d): number {\n  return Math.atan2(matrix[2], matrix[0]);\n}\n\nexport function getPointFromAngle(out: vec2, angle: number) {\n  out[0] = Math.cos(angle);\n  out[1] = Math.sin(angle);\n  return out;\n}\n\nexport function getAngleFromPoint(out: vec2) {\n  const x = out[0],\n    y = out[1],\n    angle = Math.atan2(y, x);\n\n  if (y < 0) {\n    return TAU + angle;\n  } else {\n    return angle;\n  }\n}\n\nconst getTangentAngle_VEC2_0 = vec2.create();\n\nexport function getTangentAngle(vec: vec2) {\n  const tmp = vec2.copy(getTangentAngle_VEC2_0, vec),\n    tmpX = tmp[0];\n  tmp[0] = tmp[1];\n  tmp[1] = tmpX;\n  return getAngleFromPoint(tmp);\n}\n\nexport function getAngleBetweenPoints(a: vec2, b: vec2): number {\n  const sign = b[1] < a[1] ? -1 : 1;\n  return Math.acos(vec2.dot(a, b) / (vec2.len(a) * vec2.len(b))) * sign;\n}\n\nexport function sign(value: number) {\n  return value < 0 ? -1 : 1;\n}\n\nexport function clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n\nexport function angleVec2(out: vec2) {\n  return Math.atan2(out[1], out[0]);\n}\n\nexport function vec2FromAngle(out: vec2, angle: number) {\n  out[0] = Math.cos(angle);\n  out[1] = Math.sin(angle);\n  return out;\n}\n\nexport function projectPointOnAxis(out: vec2, point: vec2, axis: vec2) {\n  const squaredLength = vec2.squaredLength(axis),\n    dotProduct = vec2.dot(point, axis);\n\n  return vec2.scale(out, axis, dotProduct / squaredLength);\n}\n\nexport function radToDeg(rad: number) {\n  return rad * RAD_TO_DEG;\n}\n\nexport function degToRad(def: number) {\n  return def * DEG_TO_RAD;\n}\n\nexport function equals(a: number, b: number) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\n\nexport function toHex(color: vec3 | vec4) {\n  return `#${((color[0] * 255) | 0).toString(16)}${(\n    (color[1] * 255) |\n    0\n  ).toString(16)}${((color[2] * 255) | 0).toString(16)}`;\n}\n\nexport function toRgb(color: vec3 | vec4) {\n  return `rgb(${color[0] * 255}, ${color[1] * 255}, ${color[2] * 255})`;\n}\n\nexport function toRgba(color: vec4) {\n  return `rgba(${color[0] * 255}, ${color[1] * 255}, ${color[2] * 255}, ${\n    color[3]\n  })`;\n}\n\nexport function mat4FromMat2d(out: mat4, matrix: mat2d) {\n  return mat4.set(\n    out,\n    matrix[0],\n    matrix[1],\n    0.0,\n    matrix[4],\n    matrix[2],\n    matrix[3],\n    0.0,\n    matrix[5],\n    0.0,\n    0.0,\n    1.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    1.0\n  );\n}\n\nexport function mat2dFromMat4(out: mat2d, matrix: mat4) {\n  return mat2d.set(\n    out,\n    matrix[0],\n    matrix[1],\n    matrix[4],\n    matrix[5],\n    matrix[13],\n    matrix[14]\n  );\n}\n\nconst getAABB2_points = [\n  vec2.create(),\n  vec2.create(),\n  vec2.create(),\n  vec2.create(),\n];\n\nexport function getAABB2FromRect(\n  out: AABB2,\n  position: vec2,\n  angle: number,\n  size: vec2\n): AABB2 {\n  const points = getAABB2_points,\n    hw = size[0] * 0.5,\n    hh = size[1] * 0.5;\n\n  AABB2.identity(out);\n\n  vec2.set(points[0], position[0] - hw, position[1] - hh);\n  vec2.set(points[1], position[0] - hw, position[1] + hh);\n  vec2.set(points[2], position[0] + hw, position[1] + hh);\n  vec2.set(points[3], position[0] + hw, position[1] - hh);\n\n  points.forEach((point) => {\n    vec2.rotate(point, point, position, angle);\n    AABB2.expandPoint(out, out, point);\n  });\n\n  return out;\n}\n","import type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport {\n  composeMat2d,\n  decomposeMat2d,\n  getAngleBetweenPoints,\n  HALF_PI,\n  mat4FromMat2d,\n} from \"../../math\";\nimport { TransformComponent } from \"../TransformComponent\";\n\nconst VEC2_0 = vec2.create(),\n  VEC3_UP = vec3.fromValues(0, 0, 1),\n  MAT2_0 = mat2d.create();\n\nexport class Transform2D extends TransformComponent {\n  private localPosition: vec2 = vec2.create();\n  private localScale: vec2 = vec2.fromValues(1, 1);\n  private localRotation = 0.0;\n  private localMatrix: mat2d = mat2d.create();\n\n  private position: vec2 = vec2.create();\n  private scale: vec2 = vec2.fromValues(1, 1);\n  private rotation = 0.0;\n  private matrix: mat2d = mat2d.create();\n\n  getLocalPosition2(out: vec2) {\n    return vec2.copy(out, this.getLocalPosition());\n  }\n  getLocalPosition3(out: vec3) {\n    const localPosition = this.getLocalPosition();\n    out[0] = localPosition[0];\n    out[1] = localPosition[1];\n    return out;\n  }\n\n  setLocalPosition2(localPosition: vec2) {\n    return this.setLocalPosition(localPosition);\n  }\n  setLocalPosition3(localPosition: vec3) {\n    return this.setLocalPosition(\n      vec2.set(VEC2_0, localPosition[0], localPosition[1])\n    );\n  }\n\n  getPosition2(out: vec2) {\n    return vec2.copy(out, this.getPosition());\n  }\n  getPosition3(out: vec3) {\n    const position = this.getPosition();\n    out[0] = position[0];\n    out[1] = position[1];\n    return out;\n  }\n\n  getLocalRotationZ() {\n    return this.getLocalRotation();\n  }\n  getLocalRotationQuat(out: quat) {\n    return quat.fromEuler(out, 0, 0, this.getLocalRotation());\n  }\n\n  setLocalRotationZ(localRotation: number) {\n    return this.setLocalRotation(localRotation);\n  }\n  setLocalRotationQuat(localRotation: quat) {\n    return this.setLocalRotation(quat.getAxisAngle(VEC3_UP, localRotation));\n  }\n\n  getRotationZ() {\n    return this.getRotation();\n  }\n  getRotationQuat(out: quat) {\n    return quat.fromEuler(out, 0, 0, this.getRotation());\n  }\n\n  getLocalScale2(out: vec2) {\n    return vec2.copy(out, this.getLocalScale());\n  }\n  getLocalScale3(out: vec3) {\n    const localScale = this.getLocalScale();\n    out[0] = localScale[0];\n    out[1] = localScale[1];\n    return out;\n  }\n\n  setLocalScale2(localScale: vec2) {\n    return this.setLocalScale(localScale);\n  }\n  setLocalScale3(localScale: vec3) {\n    return this.setLocalScale(vec2.set(VEC2_0, localScale[0], localScale[1]));\n  }\n\n  getScale2(out: vec2) {\n    return vec2.copy(out, this.getScale());\n  }\n  getScale3(out: vec3) {\n    const scale = this.getScale();\n    out[0] = scale[0];\n    out[1] = scale[1];\n    return out;\n  }\n\n  setLocalPosition(localPosition: vec2) {\n    vec2.copy(this.localPosition, localPosition);\n    return this.setNeedsUpdate();\n  }\n  getPosition() {\n    return this.updateMatrixIfNeeded().position;\n  }\n  getLocalPosition() {\n    return this.localPosition;\n  }\n\n  setLocalScale(localScale: vec2) {\n    vec2.copy(this.localScale, localScale);\n    return this.setNeedsUpdate();\n  }\n  getScale() {\n    return this.updateMatrixIfNeeded().scale;\n  }\n  getLocalScale() {\n    return this.localScale;\n  }\n\n  setLocalRotation(localRotation: number) {\n    this.localRotation = localRotation;\n    return this.setNeedsUpdate();\n  }\n  getRotation() {\n    return this.updateMatrixIfNeeded().rotation;\n  }\n  getLocalRotation() {\n    return this.localRotation;\n  }\n\n  getMatrix() {\n    return this.updateMatrixIfNeeded().matrix;\n  }\n  getLocalMatrix() {\n    return this.updateLocalMatrixIfNeeded().localMatrix;\n  }\n\n  updateLocalMatrix() {\n    composeMat2d(\n      this.localMatrix,\n      this.localPosition,\n      this.localScale,\n      this.localRotation\n    );\n    return this;\n  }\n\n  updateMatrix() {\n    this.updateLocalMatrixIfNeeded();\n    const parentTransform = this.getParentTransform();\n    if (parentTransform) {\n      mat2d.mul(\n        this.matrix,\n        parentTransform.getMatrix2d(MAT2_0),\n        this.localMatrix\n      );\n      this.rotation = decomposeMat2d(this.matrix, this.position, this.scale);\n    } else {\n      mat2d.copy(this.matrix, this.localMatrix);\n      vec2.copy(this.position, this.localPosition);\n      vec2.copy(this.scale, this.localScale);\n      this.rotation = this.localRotation;\n    }\n    return this;\n  }\n\n  getMatrix4(out: mat4) {\n    return mat4FromMat2d(out, this.getMatrix());\n  }\n  getMatrix2d(out: mat2d) {\n    return mat2d.copy(out, this.getMatrix());\n  }\n\n  getLocalMatrix4(out: mat4) {\n    return mat4FromMat2d(out, this.getLocalMatrix());\n  }\n  getLocalMatrix2d(out: mat2d) {\n    return mat2d.copy(out, this.getLocalMatrix());\n  }\n\n  toLocalPosition(out: vec2, position: vec2) {\n    return vec2.sub(out, position, this.getPosition());\n  }\n\n  lookAt(position: vec2) {\n    return this.setLocalRotation(\n      getAngleBetweenPoints(\n        this.localPosition,\n        this.toLocalPosition(VEC2_0, position)\n      ) - HALF_PI\n    );\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      localPosition: this.localPosition as IJSONArray,\n      localScale: this.localScale as IJSONArray,\n      localRotation: this.localRotation,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .setLocalPosition(json.localPosition as vec2)\n      .setLocalScale(json.localScale as vec2)\n      .setLocalRotation(json.localRotation as number);\n  }\n}\n","import type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport { mat2dFromMat4 } from \"../../math\";\nimport { TransformComponent } from \"../TransformComponent\";\n\nconst MAT4_0 = mat4.create(),\n  QUAT_0 = quat.create(),\n  VEC3_0 = vec3.create(),\n  VEC3_UP = vec3.fromValues(0, 0, 1);\n\nexport class Transform3D extends TransformComponent {\n  private localPosition: vec3 = vec3.create();\n  private localScale: vec3 = vec3.fromValues(1, 1, 1);\n  private localRotation: quat = quat.identity(quat.create());\n  private localMatrix: mat4 = mat4.create();\n\n  private position: vec3 = vec3.create();\n  private scale: vec3 = vec3.fromValues(1, 1, 1);\n  private rotation: quat = quat.identity(quat.create());\n  private matrix: mat4 = mat4.create();\n\n  getLocalPosition3(out: vec3) {\n    return vec3.copy(out, this.getLocalPosition());\n  }\n  getLocalPosition2(out: vec2) {\n    const localPosition = this.getLocalPosition();\n    out[0] = localPosition[0];\n    out[1] = localPosition[1];\n    return out;\n  }\n\n  setLocalPosition2(localPosition: vec2) {\n    return this.setLocalPosition(\n      vec3.set(\n        VEC3_0,\n        localPosition[0],\n        localPosition[1],\n        this.localPosition[2]\n      )\n    );\n  }\n  setLocalPosition3(localPosition: vec3) {\n    return this.setLocalPosition(localPosition);\n  }\n\n  getPosition3(out: vec3) {\n    return vec3.copy(out, this.getPosition());\n  }\n  getPosition2(out: vec2) {\n    const position = this.getPosition();\n    out[0] = position[0];\n    out[1] = position[1];\n    return out;\n  }\n\n  getLocalRotationQuat(out: quat) {\n    return quat.copy(out, this.localRotation);\n  }\n  getLocalRotationZ() {\n    return quat.getAxisAngle(VEC3_UP, this.localRotation);\n  }\n\n  setLocalRotationZ(localRotation: number) {\n    const localRotationQuat = quat.copy(QUAT_0, this.getLocalRotation());\n    quat.rotateZ(localRotationQuat, localRotationQuat, localRotation);\n    return this.setLocalRotation(localRotationQuat);\n  }\n  setLocalRotationQuat(localRotation: quat) {\n    return this.setLocalRotation(localRotation);\n  }\n\n  getRotationQuat(out: quat) {\n    return quat.copy(out, this.getRotation());\n  }\n  getRotationZ() {\n    return quat.getAxisAngle(VEC3_UP, this.getRotation());\n  }\n\n  getLocalScale3(out: vec3) {\n    return vec3.copy(out, this.getLocalScale());\n  }\n  getLocalScale2(out: vec2) {\n    const localScale = this.getLocalScale();\n    out[0] = localScale[0];\n    out[1] = localScale[1];\n    return out;\n  }\n\n  setLocalScale2(localScale: vec2) {\n    return this.setLocalScale(\n      vec3.set(VEC3_0, localScale[0], localScale[1], this.localScale[2])\n    );\n  }\n  setLocalScale3(localScale: vec3) {\n    return this.setLocalScale(localScale);\n  }\n\n  getScale3(out: vec3) {\n    return vec3.copy(out, this.getScale());\n  }\n  getScale2(out: vec2) {\n    const scale = this.getScale();\n    out[0] = scale[0];\n    out[1] = scale[1];\n    return out;\n  }\n\n  setLocalPosition(localPosition: vec3) {\n    vec3.copy(this.localPosition, localPosition);\n    return this.setNeedsUpdate();\n  }\n  getPosition() {\n    return this.updateMatrixIfNeeded().position;\n  }\n  getLocalPosition() {\n    return this.localPosition;\n  }\n\n  setLocalScale(localScale: vec3) {\n    vec3.copy(this.localScale, localScale);\n    return this.setNeedsUpdate();\n  }\n  getScale() {\n    return this.updateMatrixIfNeeded().scale;\n  }\n  getLocalScale() {\n    return this.localScale;\n  }\n\n  setLocalRotation(localRotation: quat) {\n    quat.copy(this.localRotation, localRotation);\n    return this.setNeedsUpdate();\n  }\n  getRotation() {\n    return this.updateMatrixIfNeeded().rotation;\n  }\n  getLocalRotation() {\n    return this.localRotation;\n  }\n\n  getMatrix() {\n    return this.updateMatrixIfNeeded().matrix;\n  }\n  getLocalMatrix() {\n    return this.updateLocalMatrixIfNeeded().localMatrix;\n  }\n\n  updateLocalMatrix() {\n    mat4.fromRotationTranslationScale(\n      this.localMatrix,\n      this.localRotation,\n      this.localPosition,\n      this.localScale\n    );\n\n    return this;\n  }\n\n  updateMatrix() {\n    this.updateLocalMatrixIfNeeded();\n    const parentTransform = this.getParentTransform();\n    if (parentTransform) {\n      mat4.mul(\n        this.matrix,\n        parentTransform.getMatrix4(MAT4_0),\n        this.localMatrix\n      );\n      mat4.getRotation(this.rotation, this.matrix);\n      mat4.getScaling(this.scale, this.matrix);\n      mat4.getTranslation(this.position, this.matrix);\n    } else {\n      mat4.copy(this.matrix, this.localMatrix);\n      vec3.copy(this.position, this.localPosition);\n      vec3.copy(this.scale, this.localScale);\n      quat.copy(this.rotation, this.localRotation);\n    }\n    return this;\n  }\n\n  getMatrix4(out: mat4) {\n    return mat4.copy(out, this.getMatrix());\n  }\n  getMatrix2d(out: mat2d) {\n    return mat2dFromMat4(out, this.getMatrix());\n  }\n\n  getLocalMatrix4(out: mat4) {\n    return mat4.copy(out, this.getLocalMatrix());\n  }\n  getLocalMatrix2d(out: mat2d) {\n    return mat2dFromMat4(out, this.getLocalMatrix());\n  }\n\n  toLocalPosition(out: vec3, position: vec3) {\n    return vec3.sub(out, position, this.getPosition());\n  }\n\n  lookAt(position: vec3, up: vec3 = VEC3_UP) {\n    mat4.getRotation(\n      this.localRotation,\n      mat4.targetTo(\n        MAT4_0,\n        this.localPosition,\n        this.toLocalPosition(VEC3_0, position),\n        up\n      )\n    );\n    return this.setNeedsUpdate();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      localPosition: this.localPosition as IJSONArray,\n      localScale: this.localScale as IJSONArray,\n      localRotation: this.localRotation as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .setLocalPosition(json.localPosition as vec3)\n      .setLocalScale(json.localScale as vec3)\n      .setLocalRotation(json.localRotation as quat);\n  }\n}\n","import { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Camera2D } from \"./Camera2D\";\n\nexport class Camera2DManager extends DefaultDescriptorManager<Camera2D> {\n  private active: Camera2D | null = null;\n\n  setActive(camera: Camera2D) {\n    if (camera.getManager() === this) {\n      this.active = camera;\n    } else {\n      throw new Error(\n        \"Camera2DManager.setActive(camera: Camera2D): cannot set active if camera is not in manager\"\n      );\n    }\n    return this;\n  }\n  getActive() {\n    return this.active;\n  }\n  getRequiredActive() {\n    if (!this.active) {\n      throw new Error(`Expected an Active Camera`);\n    }\n    return this.active;\n  }\n\n  addComponent(camera: Camera2D) {\n    super.addComponent(camera);\n\n    if (this.active === null) {\n      this.active = camera;\n    }\n\n    return this;\n  }\n\n  removeComponent(camera: Camera2D) {\n    super.removeComponent(camera);\n\n    if (this.active) {\n      if (this.active === camera) {\n        this.active = null;\n      }\n    }\n\n    return this;\n  }\n}\n","import { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { mat2d, vec2, vec4 } from \"gl-matrix\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { extractScale } from \"../../math\";\nimport type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { Camera2DManager } from \"./Camera2DManager\";\nimport { AABB2 } from \"../../math/AABB2\";\n\nconst MAT2D_0 = mat2d.create(),\n  VEC2_0 = vec2.create(),\n  POINTS = [vec2.create(), vec2.create(), vec2.create(), vec2.create()];\n\nexport class Camera2D extends RenderableComponent {\n  static Manager = Camera2DManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n\n  private width = 1.0;\n  private height = 1.0;\n  private aspect = 1.0;\n\n  private size = 1;\n  private minSize = Number.EPSILON;\n  private maxSize = Infinity;\n\n  private projection = mat2d.identity(mat2d.create());\n  private view = mat2d.identity(mat2d.create());\n\n  private needsUpdate = true;\n  private background: vec4 = vec4.create();\n\n  getBackground() {\n    return this.background;\n  }\n  setBackground(background: vec4) {\n    vec4.copy(this.background, background);\n    return this;\n  }\n\n  set(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = width;\n      this.height = height;\n      this.aspect = width / height;\n      return this.setNeedsUpdate();\n    } else {\n      return this;\n    }\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n  getAspect() {\n    return this.aspect;\n  }\n\n  getSize() {\n    return this.size;\n  }\n  setSize(size: number) {\n    this.size =\n      size < this.minSize\n        ? this.minSize\n        : size > this.maxSize\n        ? this.maxSize\n        : size;\n    return this.setNeedsUpdate();\n  }\n  getMinSize() {\n    return this.minSize;\n  }\n  setMinSize(minSize: number) {\n    this.minSize = minSize;\n    return this.setNeedsUpdate();\n  }\n  getMaxSize() {\n    return this.minSize;\n  }\n  setMaxSize(maxSize: number) {\n    this.maxSize = maxSize;\n    return this.setNeedsUpdate();\n  }\n\n  setZoom(zoom: number) {\n    const entity = this.getEntity();\n    if (entity) {\n      const transform = TransformComponent.getTransform(entity);\n      if (transform) {\n        transform.setLocalScale2(vec2.set(VEC2_0, zoom, zoom));\n      }\n    }\n    return this;\n  }\n  getZoom() {\n    const entity = this.getEntity();\n    if (entity) {\n      const transform = TransformComponent.getTransform(entity);\n      if (transform) {\n        return (\n          vec2.len(extractScale(VEC2_0, transform.getMatrix2d(MAT2D_0))) *\n          this.size\n        );\n      }\n    }\n    return this.size;\n  }\n\n  getView() {\n    const entity = this.getEntity();\n    if (entity) {\n      const transform = TransformComponent.getTransform(entity);\n      if (transform) {\n        mat2d.invert(this.view, transform.getMatrix2d(MAT2D_0));\n      }\n    }\n    return this.view;\n  }\n\n  getProjection() {\n    return this.updateProjectionIfNeeded().projection;\n  }\n\n  getAABB2(out: AABB2): AABB2 {\n    const matrix = MAT2D_0,\n      points = POINTS;\n\n    AABB2.identity(out);\n\n    vec2.set(points[0], 0, 0);\n    vec2.set(points[1], this.width, 0);\n    vec2.set(points[2], this.width, this.height);\n    vec2.set(points[3], 0, this.height);\n\n    mat2d.mul(matrix, this.projection, this.view);\n    mat2d.invert(matrix, matrix);\n\n    for (const point of points) {\n      point[0] = 2.0 * (point[0] / this.width) - 1.0;\n      point[1] = -2.0 * (point[1] / this.height) + 1.0;\n      vec2.transformMat2d(point, point, matrix);\n      AABB2.expandPoint(out, out, point);\n    }\n\n    return out;\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.needsUpdate = needsUpdate;\n    return this;\n  }\n\n  updateProjectionIfNeeded() {\n    if (this.needsUpdate) {\n      return this.updateProjection();\n    } else {\n      return this;\n    }\n  }\n\n  isActive(): boolean {\n    return this.getRequiredManager<Camera2DManager>().getActive() === this;\n  }\n  setActive() {\n    this.getRequiredManager<Camera2DManager>().setActive(this);\n    return this;\n  }\n  updateProjection() {\n    const size = this.getSize(),\n      right = size * this.aspect,\n      left = -right,\n      top = size,\n      bottom = -top,\n      width = right - left,\n      height = top - bottom,\n      x = (right + left) / width,\n      y = (top + bottom) / height;\n\n    mat2d.set(this.projection, 2 / width, 0.0, 0.0, 2 / height, -x, -y);\n    this.needsUpdate = false;\n\n    return this;\n  }\n\n  toRelative(out: vec2, screen: vec2) {\n    this.toWorld(out, screen);\n    vec2.transformMat2d(out, out, this.view);\n    return out;\n  }\n\n  toWorld(out: vec2, screen: vec2) {\n    const mat = MAT2D_0;\n\n    out[0] = 2.0 * (screen[0] / this.width) - 1.0;\n    out[1] = -2.0 * (screen[1] / this.height) + 1.0;\n\n    mat2d.mul(mat, this.projection, this.view);\n    mat2d.invert(mat, mat);\n    vec2.transformMat2d(out, out, mat);\n\n    return out;\n  }\n\n  toScreen(out: vec2, world: vec2) {\n    const mat = mat2d.mul(MAT2D_0, this.projection, this.view);\n\n    vec2.transformMat2d(out, world, mat);\n\n    out[0] = (out[0] + 1.0) * 0.5 * this.width;\n    out[1] = (1.0 - out[1]) * 0.5 * this.height;\n\n    return out;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      width: this.width,\n      height: this.height,\n      background: this.background as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .set(json.width as number, json.height as number)\n      .setBackground(json.background as vec4);\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport { v4 } from \"uuid\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\n\n// tslint:disable-next-line: interface-name\nexport interface Asset {\n  on(event: \"load\" | \"unload\", listener: () => void): this;\n  on(\n    event: \"load-error\" | \"unload-error\",\n    listener: (error: Error) => void\n  ): this;\n}\n\nexport abstract class Asset extends ToFromJSONEventEmitter {\n  private uuid = v4();\n  private name = \"\";\n  private loaded = false;\n  private loading = false;\n\n  getUUID() {\n    return this.uuid;\n  }\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name = name;\n    return this;\n  }\n  isLoaded() {\n    return this.loaded;\n  }\n  isLoading() {\n    return this.loading;\n  }\n\n  load() {\n    if (this.loaded) {\n      return Promise.resolve();\n    } else {\n      this.loading = true;\n      return this.loadAsset()\n        .then(() => {\n          this.loading = false;\n          this.loaded = true;\n          this.emit(\"load\");\n        })\n        .catch((error) => {\n          this.loading = true;\n          this.emit(\"load-error\", error);\n          throw error;\n        });\n    }\n  }\n\n  unload() {\n    if (!this.loaded) {\n      return Promise.resolve();\n    } else {\n      return this.unloadAsset()\n        .then(() => {\n          this.loaded = false;\n          this.emit(\"unload\");\n        })\n        .catch((error) => {\n          this.emit(\"unload-error\", error);\n          throw error;\n        });\n    }\n  }\n\n  protected abstract loadAsset(): Promise<void>;\n  protected abstract unloadAsset(): Promise<void>;\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      uuid: this.uuid,\n      name: this.name,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.uuid = json.uuid as string;\n    this.name = json.name as string;\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\n\nexport type IRequirement<T> = IConstructor<T> | Array<IConstructor<T>>;\n\nexport function filterRequirements<T>(\n  requirements: IRequirement<T>[],\n  filter: (value: IConstructor<T>) => boolean\n): IRequirement<T>[] {\n  return requirements.reduce((missing, requirement) => {\n    if (Array.isArray(requirement)) {\n      if (!requirement.some(filter)) {\n        missing.push(requirement);\n      }\n    } else {\n      if (filter(requirement)) {\n        missing.push(requirement);\n      }\n    }\n    return missing;\n  }, [] as IRequirement<T>[]);\n}\n\nexport function requirementToString<T>(requirement: IRequirement<T>): string {\n  if (Array.isArray(requirement)) {\n    return `one of ${requirement.map(requirementToString).join(\", \")}`;\n  } else {\n    return requirement.name || (requirement as any).typeId || \"UnknownClass\";\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport {\n  IRequirement,\n  filterRequirements,\n  requirementToString,\n} from \"./IRequirement\";\nimport type { Manager } from \"./Manager\";\nimport type { Scene } from \"./Scene\";\nimport type { ValidEventTypes } from \"eventemitter3\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport abstract class Plugin<\n  EventTypes extends ValidEventTypes = any\n> extends ToFromJSONEventEmitter<EventTypes> {\n  static pluginPriority = 0;\n  static requiredPlugins: IRequirement<Plugin>[] = [];\n\n  static getPluginPriority() {\n    return this.pluginPriority;\n  }\n  static getRequiredPlugins(): IRequirement<Plugin>[] {\n    return this.requiredPlugins;\n  }\n\n  private scene: Scene | null = null;\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getPluginPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getPluginPriority();\n  }\n  getRequiredPlugins(): IConstructor<Plugin>[] {\n    return Object.getPrototypeOf(this).constructor.requiredPlugins;\n  }\n\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>): P | null {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getPlugin(Plugin);\n    } else {\n      return null;\n    }\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>): P {\n    const plugin = this.getPlugin<P>(Plugin);\n    if (!plugin) {\n      throw new Error(`${this.getConstructor()} required ${Plugin} Plugin`);\n    }\n    return plugin;\n  }\n\n  getManager<M extends Manager = Manager>(Manager: IConstructor<M>): M | null {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getManager(Manager);\n    } else {\n      return null;\n    }\n  }\n  getRequiredManager<M extends Manager = Manager>(Manager: IConstructor<M>) {\n    const manager = this.getManager<M>(Manager);\n    if (!manager) {\n      throw new Error(`${this.getConstructor()} required ${Manager} Manager`);\n    }\n    return manager;\n  }\n\n  validateRequirements() {\n    const missingPlugins: IRequirement<Plugin>[] = [];\n\n    for (const plugin of this.getRequiredScene().getPlugins()) {\n      const missingRequiredPlugins = filterRequirements(\n        plugin.getRequiredPlugins(),\n        (P) => !this.getRequiredScene().hasPlugin(P)\n      );\n\n      if (missingRequiredPlugins.length > 0) {\n        missingPlugins.push(...missingRequiredPlugins);\n      }\n    }\n\n    if (missingPlugins.length > 0) {\n      const pluginMessage = missingPlugins\n        .map(\n          (missingRequirement) =>\n            `${requirementToString(\n              this.getConstructor()\n            )} Plugin requires ${requirementToString(\n              missingRequirement\n            )} Plugin`\n        )\n        .join(\"\\n\");\n\n      throw new Error(pluginMessage);\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene) {\n    this.scene = scene;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene = null;\n    return this;\n  }\n  getScene() {\n    return this.scene;\n  }\n  getRequiredScene() {\n    const scene = this.getScene();\n    if (!scene) {\n      throw new Error(`${this.getConstructor()} required a Scene`);\n    }\n    return scene;\n  }\n\n  onInit() {\n    return this;\n  }\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n}\n","import { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { Plugin } from \"../../Plugin\";\nimport { Asset } from \"./Asset\";\n\nexport class Assets extends Plugin {\n  private assetMap: Record<string, Asset> = {};\n  private assets: Asset[] = [];\n  private loadedAssets: Asset[] = [];\n  private loadingPromises: Map<Asset, Promise<void>> = new Map();\n  private unloadingPromises: Map<Asset, Promise<void>> = new Map();\n\n  find(fn: (asset: Asset) => boolean) {\n    return this.assets.find(fn);\n  }\n  findWithName(name: string) {\n    return this.find((asset) => asset.getName() === name);\n  }\n\n  findAll(fn: (asset: Asset) => boolean): Asset[] {\n    return this.assets.filter(fn);\n  }\n  findAllWithName(name: string) {\n    return this.findAll((asset) => asset.getName() === name);\n  }\n\n  isLoading() {\n    return this.loadingPromises.size > 0;\n  }\n\n  getAsset<T extends Asset = Asset>(uuid: string): T | null {\n    return (this.assetMap[uuid] as T) || null;\n  }\n  getRequiredAsset<T extends Asset = Asset>(uuid: string): T {\n    const asset = this.getAsset<T>(uuid);\n    if (!asset) {\n      throw new Error(`Required Asset ${uuid} not found`);\n    }\n    return asset;\n  }\n  getAssets(): readonly Asset[] {\n    return this.assets;\n  }\n\n  getLoadedAssets(): readonly Asset[] {\n    return this.loadedAssets;\n  }\n  getLoadingAssets() {\n    return Array.from(this.loadingPromises.keys());\n  }\n\n  getUnloadingAssets() {\n    return Array.from(this.unloadingPromises.keys());\n  }\n  getUnloadedAssets(): readonly Asset[] {\n    return this.assets.filter((asset) => !asset.isLoaded());\n  }\n\n  addAsset(...assets: Asset[]) {\n    return this.addAssets(assets);\n  }\n  addAssets(assets: Asset[]) {\n    for (const asset of assets) {\n      this._addAsset(asset);\n    }\n    return this;\n  }\n\n  removeAsset(...assets: Asset[]) {\n    return this.removeAssets(assets);\n  }\n  removeAssets(assets: Asset[]) {\n    for (const asset of assets) {\n      this._removeAsset(asset);\n    }\n    return this;\n  }\n\n  loadAll() {\n    return this.loadAssets(this.getUnloadedAssets());\n  }\n  loadAllInBackground() {\n    return this.loadAssetsInBackground(this.getUnloadedAssets());\n  }\n\n  loadAssetInBackground(...assets: readonly Asset[]) {\n    return this.loadAssetsInBackground(assets);\n  }\n  loadAssetsInBackground(assets: readonly Asset[]) {\n    this.loadAssets(assets);\n    return this;\n  }\n\n  unloadAssetInBackground(...assets: readonly Asset[]) {\n    return this.unloadAssetsInBackground(assets);\n  }\n  unloadAssetsInBackground(assets: readonly Asset[]) {\n    this.unloadAssets(assets);\n    return this;\n  }\n\n  loadAsset(...assets: readonly Asset[]) {\n    return this.loadAssets(assets);\n  }\n  loadAssets(assets: readonly Asset[]) {\n    return Promise.all(assets.map((asset) => this._loadAsset(asset)));\n  }\n\n  unloadAsset(...assets: readonly Asset[]) {\n    return this.unloadAssets(assets);\n  }\n  unloadAssets(assets: readonly Asset[]) {\n    return Promise.all(assets.map((asset) => this._unloadAsset(asset)));\n  }\n\n  private _loadAsset(asset: Asset): Promise<void> {\n    if (asset.isLoaded()) {\n      return Promise.resolve();\n    } else {\n      const promise = this.loadingPromises.get(asset);\n\n      if (promise) {\n        return promise;\n      } else {\n        const promise = asset\n          .load()\n          .then(() => {\n            this.loadingPromises.delete(asset);\n            this.loadedAssets.push(asset);\n          })\n          .catch((error) => {\n            this.loadingPromises.delete(asset);\n            throw error;\n          });\n\n        this.loadingPromises.set(asset, promise);\n\n        return promise;\n      }\n    }\n  }\n\n  private _unloadAsset(asset: Asset): Promise<void> {\n    if (!asset.isLoaded()) {\n      return Promise.resolve();\n    } else {\n      const promise = this.unloadingPromises.get(asset);\n\n      if (promise) {\n        return promise;\n      } else {\n        const promise = asset\n          .load()\n          .then(() => {\n            this.unloadingPromises.delete(asset);\n            this.loadedAssets.splice(this.loadedAssets.indexOf(asset), 1);\n          })\n          .catch((error) => {\n            this.unloadingPromises.delete(asset);\n            throw error;\n          });\n\n        this.unloadingPromises.set(asset, promise);\n\n        return promise;\n      }\n    }\n  }\n\n  private _addAsset(asset: Asset) {\n    const uuid = asset.getUUID();\n\n    if (!this.assetMap[uuid]) {\n      this.assetMap[uuid] = asset;\n      this.assets.push(asset);\n    }\n    return this;\n  }\n\n  private _removeAsset(asset: Asset) {\n    const uuid = asset.getUUID();\n\n    if (this.assetMap[uuid]) {\n      delete this.assetMap[uuid];\n      this.assets.splice(this.assets.indexOf(asset), 1);\n    }\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      assets: this.assets.map((asset) => asset.toJSON()),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.assets)) {\n      this.addAssets(\n        json.assets.map((json) => Asset.newFromJSON(json as IJSONObject))\n      );\n    }\n    return this;\n  }\n}\n","import type { IJSON, IJSONObject } from \"@aicacia/json\";\nimport { Asset } from \"./Asset\";\n\nexport class JSONAsset extends Asset {\n  private json: IJSON = null;\n  private src: RequestInfo;\n  private options?: RequestInit;\n\n  constructor(src: RequestInfo, options?: RequestInit) {\n    super();\n    this.src = src;\n    this.options = options;\n  }\n\n  getJSON() {\n    return this.json;\n  }\n\n  protected loadAsset() {\n    return fetch(this.src, this.options)\n      .then((response) => response.json())\n      .then((json) => {\n        this.json = json;\n      });\n  }\n\n  protected unloadAsset() {\n    this.json = null;\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      src: this.src,\n      options: this.options,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.src = json.src as RequestInfo;\n    this.options = json.options as RequestInit;\n    return this;\n  }\n}\n","import type { IJSON, IJSONObject } from \"@aicacia/json\";\nimport { Asset } from \"./Asset\";\n\nexport class RawJSONAsset extends Asset {\n  private json: IJSON;\n\n  constructor(json: IJSON) {\n    super();\n    this.json = json;\n  }\n\n  getJSON() {\n    return this.json;\n  }\n\n  protected loadAsset() {\n    return Promise.resolve();\n  }\n\n  protected unloadAsset() {\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      json: this.json,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.json = json.json as IJSON;\n    return this;\n  }\n}\n","import { Asset } from \"./Asset\";\n\nexport abstract class ImageAsset extends Asset {\n  abstract getWidth(): number;\n  abstract getHeight(): number;\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { Plugin } from \"../../Plugin\";\nimport type { Manager } from \"../../Manager\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\nimport type { Renderer } from \"./Renderer\";\nimport type { IJSONObject } from \"@aicacia/json\";\n\nexport abstract class RendererHandler<\n  R extends Renderer = Renderer\n> extends ToFromJSONEventEmitter {\n  static rendererHandlerPriority: number;\n\n  static getRendererHandlerPriority() {\n    return this.rendererHandlerPriority;\n  }\n\n  private renderer: R | null = null;\n  private enabled = true;\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getRendererHandlerPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getRendererHandlerPriority();\n  }\n\n  UNSAFE_setRenderer(renderer: R) {\n    this.renderer = renderer;\n    return this;\n  }\n  UNSAFE_removeRenderer() {\n    this.renderer = null;\n    return this;\n  }\n  getRenderer() {\n    return this.renderer;\n  }\n  getRequiredRenderer() {\n    if (!this.renderer) {\n      throw new Error(\n        `${this.getConstructor()} expected to be added to a Renderer first`\n      );\n    }\n    return this.renderer;\n  }\n\n  getScene() {\n    if (this.renderer) {\n      return this.renderer.getScene();\n    } else {\n      return null;\n    }\n  }\n  getRequiredScene() {\n    const scene = this.getScene();\n    if (!scene) {\n      throw new Error(`${this.getConstructor()} required scene`);\n    }\n    return scene;\n  }\n\n  getManager<M extends Manager>(Manager: IConstructor<M>) {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getManager(Manager);\n    } else {\n      return null;\n    }\n  }\n  getRequiredManager<M extends Manager>(Manager: IConstructor<M>) {\n    const manager = this.getManager(Manager);\n    if (!manager) {\n      throw new Error(`${this.getConstructor()} required ${Manager} Manager`);\n    }\n    return manager;\n  }\n\n  getPlugin<P extends Plugin>(Plugin: new (...args: any[]) => P) {\n    const scene = this.getScene();\n    if (scene) {\n      return scene.getPlugin(Plugin);\n    } else {\n      return null;\n    }\n  }\n  getRequiredPlugin<P extends Plugin>(Plugin: new (...args: any[]) => P) {\n    const plugin = this.getPlugin(Plugin);\n    if (!plugin) {\n      throw new Error(`${this.getConstructor()} required ${Plugin} Plugin`);\n    }\n    return plugin;\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onBeforeRender() {\n    return this;\n  }\n  onRender() {\n    return this;\n  }\n  onAfterRender() {\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      enabled: this.enabled,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.enabled = json.enabled as boolean;\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { Plugin } from \"../../Plugin\";\n\nexport abstract class Renderer extends Plugin {\n  static pluginPriority = Infinity;\n\n  private rendererHandlers: RendererHandler[] = [];\n  private rendererHandlerMap: Map<\n    IConstructor<RendererHandler>,\n    RendererHandler\n  > = new Map();\n\n  getRendererHandlers(): readonly RendererHandler[] {\n    return this.rendererHandlers;\n  }\n  getRendererHandler<R extends RendererHandler>(\n    RendererHandler: IConstructor<R>\n  ): R | null {\n    return (this.rendererHandlerMap.get(RendererHandler) as R) || null;\n  }\n\n  addRendererHandlers(rendererHandlers: RendererHandler[]) {\n    for (const rendererHandler of rendererHandlers) {\n      this._addRendererHandler(rendererHandler);\n    }\n    return this.sortRendererHandlers();\n  }\n  addRendererHandler(...rendererHandlers: RendererHandler[]) {\n    return this.addRendererHandlers(rendererHandlers);\n  }\n\n  removeRendererHandlers(RendererHandlers: IConstructor<RendererHandler>[]) {\n    for (const RendererHandler of RendererHandlers) {\n      this._removeRendererHandler(RendererHandler);\n    }\n    return this.sortRendererHandlers();\n  }\n  removeRendererHandler(...rendererHandlers: IConstructor<RendererHandler>[]) {\n    return this.removeRendererHandlers(rendererHandlers);\n  }\n\n  onUpdate() {\n    for (const rendererHandler of this.rendererHandlers) {\n      if (rendererHandler.getEnabled()) {\n        rendererHandler.onBeforeRender();\n        rendererHandler.onRender();\n      }\n    }\n    return this;\n  }\n  onAfterUpdate() {\n    for (const rendererHandler of this.rendererHandlers) {\n      if (rendererHandler.getEnabled()) {\n        rendererHandler.onAfterRender();\n      }\n    }\n    return this;\n  }\n\n  private _addRendererHandler<R extends RendererHandler = RendererHandler>(\n    rendererHandler: R\n  ) {\n    const RendererHandler = rendererHandler.getConstructor();\n\n    if (!this.rendererHandlerMap.has(RendererHandler)) {\n      this.rendererHandlers.push(rendererHandler);\n      this.rendererHandlerMap.set(RendererHandler, rendererHandler);\n      rendererHandler.UNSAFE_setRenderer(this);\n      rendererHandler.onAdd();\n      this.emit(\"add-renderer_handler\", rendererHandler);\n    }\n\n    return this;\n  }\n  private _removeRendererHandler<R extends RendererHandler = RendererHandler>(\n    RendererHandler: IConstructor<R>\n  ) {\n    const rendererHandler = this.rendererHandlerMap.get(RendererHandler);\n    if (rendererHandler) {\n      this.emit(\"remove-renderer_handler\", rendererHandler);\n      rendererHandler.onRemove();\n\n      this.rendererHandlers.splice(\n        this.rendererHandlers.indexOf(rendererHandler),\n        1\n      );\n      this.rendererHandlerMap.delete(RendererHandler);\n      rendererHandler.UNSAFE_removeRenderer();\n    }\n    return this;\n  }\n\n  private sortRendererHandlers() {\n    this.rendererHandlers.sort(this.sortRendererHandlersFunction);\n    return this;\n  }\n  private sortRendererHandlersFunction = (\n    a: RendererHandler,\n    b: RendererHandler\n  ) => {\n    return a.getRendererHandlerPriority() - b.getRendererHandlerPriority();\n  };\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      rendererHandlers: this.rendererHandlers.map((rendererHandler) =>\n        rendererHandler.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.rendererHandlers)) {\n      this.addRendererHandlers(\n        json.rendererHandlers.map((json) =>\n          RendererHandler.newFromJSON(json as IJSONObject)\n        )\n      );\n    }\n    return this;\n  }\n}\n\nimport { RendererHandler } from \"./RendererHandler\";\n","import type { IJSONObject } from \"@aicacia/json\";\nimport { Plugin } from \"../Plugin\";\n\nexport class Time extends Plugin {\n  static pluginPriority = -Infinity;\n\n  private scale = 1.0;\n\n  private fixedDelta: number = 1.0 / 60.0;\n\n  private frame = 0;\n  private last: number = -(1.0 / 60.0);\n  private current = 0.0;\n  private delta: number = 1.0 / 60.0;\n  private fps = 60.0;\n  private fpsFrame = 0;\n  private fpsLast = 0;\n\n  private startTime: number = Date.now() * 0.001;\n  private minDelta = 0.000001;\n  private maxDelta = Infinity;\n\n  getStartTime() {\n    return this.startTime;\n  }\n\n  getDelta() {\n    return this.delta * this.scale;\n  }\n  getRealDelta() {\n    return this.delta * this.scale;\n  }\n\n  getCurrent() {\n    return this.current;\n  }\n\n  getMinDelta() {\n    return this.minDelta;\n  }\n  setMinDelta(minDelta: number) {\n    this.minDelta = minDelta;\n    return this;\n  }\n\n  getMaxDelta() {\n    return this.maxDelta;\n  }\n  setMaxDelta(maxDelta: number) {\n    this.maxDelta = maxDelta;\n    return this;\n  }\n\n  getFrame() {\n    return this.frame;\n  }\n  getFps() {\n    return this.fps;\n  }\n\n  getScale() {\n    return this.scale;\n  }\n  setScale(scale: number) {\n    this.scale = scale;\n    return this;\n  }\n\n  getFixedDelta() {\n    return this.fixedDelta * this.scale;\n  }\n  setFixedDelta(fixedDelta: number) {\n    this.fixedDelta = fixedDelta;\n    return this;\n  }\n\n  now() {\n    return Date.now() * 0.001 - this.startTime;\n  }\n\n  onUpdate() {\n    ++this.frame;\n\n    this.last = this.current;\n    this.current = this.now();\n\n    this.fpsFrame++;\n    if (this.fpsLast + 1 < this.current) {\n      this.fps = this.fpsFrame / (this.current - this.fpsLast);\n\n      this.fpsLast = this.current;\n      this.fpsFrame = 0;\n    }\n\n    this.delta = (this.current - this.last) * this.scale;\n    this.delta =\n      this.delta < this.minDelta\n        ? this.minDelta\n        : this.delta > this.maxDelta\n        ? this.maxDelta\n        : this.delta;\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      frame: this.frame,\n      scale: this.scale,\n      fixedDelta: this.fixedDelta,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.frame = json.frame as number;\n    this.scale = json.scale as number;\n    this.fixedDelta = json.fixedDelta as number;\n    return this;\n  }\n}\n","import { Plugin } from \"../Plugin\";\nimport type { IRunOnUpdateFn } from \"../IRunOnUpdateFn\";\n\nexport abstract class RunOnUpdatePlugin extends Plugin {\n  private queue: IRunOnUpdateFn<this>[] = [];\n  private swap: IRunOnUpdateFn<this>[] = [];\n\n  runOnUpdate(...fns: IRunOnUpdateFn<this>[]) {\n    this.queue.push(...fns);\n    return this;\n  }\n\n  onUpdate() {\n    if (this.queue.length > 0) {\n      const queue = this.queue;\n\n      this.queue = this.swap;\n      this.swap = queue;\n\n      for (const fn of queue) {\n        fn.call(this);\n      }\n      this.swap.length = 0;\n    }\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\nimport type { Time } from \"../Time\";\nimport type { Input } from \"./Input\";\nimport type { InputEvent } from \"./InputEvent\";\n\nexport abstract class EventListener<\n  I extends Input = Input\n> extends ToFromJSONEventEmitter {\n  private input: I | null = null;\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setInput(input: I) {\n    this.input = input;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeInput() {\n    this.input = null;\n    return this;\n  }\n  getInput() {\n    return this.input;\n  }\n  getRequiredInput() {\n    const input = this.getInput();\n    if (!input) {\n      throw new Error(`${this.getConstructor()} requires a Input Plugin`);\n    }\n    return input;\n  }\n  getScene() {\n    const input = this.getInput();\n    if (input) {\n      return input.getScene();\n    } else {\n      return null;\n    }\n  }\n  getRequiredScene() {\n    const scene = this.getScene();\n    if (!scene) {\n      throw new Error(`${this.getConstructor()} requires a Scene`);\n    }\n    return scene;\n  }\n\n  queueEvent(event: InputEvent) {\n    const input = this.getInput();\n    if (input) {\n      input.queueEvent(event);\n    }\n    return this;\n  }\n  abstract dequeueEvent(event: InputEvent): boolean;\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate(_time: Time) {\n    return this;\n  }\n  onAfterUpdate(_time: Time) {\n    return this;\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport type { Time } from \"../Time\";\n\nexport class InputAxis {\n  private name: string;\n\n  private negButton: string;\n  private posButton: string;\n\n  private gravity = 3;\n  private sensitivity = 3;\n\n  private dead = 0.001;\n\n  private value = 0.0;\n\n  constructor(name: string, negButton: string, posButton: string) {\n    this.name = name;\n    this.negButton = negButton;\n    this.posButton = posButton;\n  }\n\n  getName() {\n    return this.name;\n  }\n\n  getNegButton() {\n    return this.negButton;\n  }\n  setNegButton(negButton: string) {\n    this.negButton = negButton;\n    return this;\n  }\n  getPosButton() {\n    return this.posButton;\n  }\n  setPosButton(posButton: string) {\n    this.posButton = posButton;\n    return this;\n  }\n\n  getGravity() {\n    return this.gravity;\n  }\n  setGravity(gravity: number) {\n    this.gravity = gravity;\n    return this;\n  }\n  getSensitivity() {\n    return this.sensitivity;\n  }\n  setSensitivity(sensitivity: number) {\n    this.sensitivity = sensitivity;\n    return this;\n  }\n\n  getDead() {\n    return this.dead;\n  }\n  setDead(dead: number) {\n    this.dead = dead;\n    return this;\n  }\n\n  getValue() {\n    return this.value;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setValue(value: number) {\n    this.value = value;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_update(time: Time, value: number, isNeg: boolean, isPos: boolean) {\n    const delta = time.getDelta();\n\n    if (isNeg) {\n      value -= this.getSensitivity() * delta;\n    }\n    if (isPos) {\n      value += this.getSensitivity() * delta;\n    }\n\n    if (!isPos && !isNeg && value !== 0.0) {\n      value -= (value >= 0 ? 1 : -1) * this.getGravity() * delta;\n    }\n\n    value = value >= 1.0 ? 1.0 : value <= -1.0 ? -1.0 : value;\n\n    if (Math.abs(value) <= this.getDead()) {\n      value = 0.0;\n    }\n\n    this.value = value;\n  }\n\n  toJSON() {\n    return {\n      name: this.name,\n      negButton: this.negButton,\n      posButton: this.posButton,\n      gravity: this.gravity,\n      sensitivity: this.sensitivity,\n      dead: this.dead,\n      value: this.value,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    this.name = json.name as string;\n    this.negButton = json.negButton as string;\n    this.posButton = json.posButton as string;\n    this.gravity = json.gravity as number;\n    this.sensitivity = json.sensitivity as number;\n    this.dead = json.dead as number;\n    this.value = json.value as number;\n    return this;\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\n\nexport class InputButton {\n  private name: string;\n  private value = 0.0;\n  private frameDown = 0;\n  private frameUp = 0;\n\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  getName() {\n    return this.name;\n  }\n\n  getFrameDown() {\n    return this.frameDown;\n  }\n  getFrameUp() {\n    return this.frameUp;\n  }\n\n  getValue() {\n    return this.value;\n  }\n  UNSAFE_setValue(value: number) {\n    this.value = value;\n    return this;\n  }\n\n  UNSAFE_up(frame: number) {\n    if (this.value === 1.0) {\n      this.frameUp = frame;\n    }\n    this.value = 0.0;\n    return this;\n  }\n  UNSAFE_down(frame: number) {\n    if (this.value === 0.0) {\n      this.frameDown = frame;\n    }\n    this.value = 1.0;\n    return this;\n  }\n\n  toJSON() {\n    return {\n      name: this.name,\n      value: this.value,\n      frameDown: this.frameDown,\n      frameUp: this.frameUp,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    this.name = json.name as string;\n    this.value = json.value as number;\n    this.frameDown = json.frameDown as number;\n    this.frameUp = json.frameUp as number;\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\n\nexport abstract class InputHandler<\n  I extends Input = Input\n> extends ToFromJSONEventEmitter {\n  private input: I | null = null;\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setInput(input: I) {\n    this.input = input;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeInput() {\n    this.input = null;\n    return this;\n  }\n  getInput() {\n    return this.input;\n  }\n  getRequiredInput() {\n    const input = this.getInput();\n    if (!input) {\n      throw new Error(`${this.getConstructor()} requires a Input Plugin`);\n    }\n    return input;\n  }\n  getScene() {\n    const input = this.getInput();\n    if (input) {\n      return input.getScene();\n    } else {\n      return null;\n    }\n  }\n  getRequiredScene() {\n    const scene = this.getScene();\n    if (!scene) {\n      throw new Error(`${this.getConstructor()} requires a Scene`);\n    }\n    return scene;\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate(_time: Time) {\n    return this;\n  }\n  onAfterUpdate(_time: Time) {\n    return this;\n  }\n  abstract onEvent(time: Time, event: InputEvent): this;\n}\n\nimport type { Time } from \"../Time\";\nimport type { Input } from \"./Input\";\nimport type { InputEvent } from \"./InputEvent\";\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { MouseInputEvent } from \"./MouseInputEvent\";\nimport type { MouseWheelInputEvent } from \"./MouseWheelInputEvent\";\n\nexport class MouseInputHandler extends InputHandler {\n  onEvent(time: Time, event: MouseInputEvent | MouseWheelInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"mousemove\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        break;\n      case \"mousedown\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        input\n          .getOrCreateButton(`mouse-${event.button}`)\n          .UNSAFE_down(time.getFrame());\n        break;\n      case \"mouseup\":\n      case \"mouseleave\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        input\n          .getOrCreateButton(`mouse-${event.button}`)\n          .UNSAFE_up(time.getFrame());\n        break;\n      case \"wheel\":\n        input.getOrCreateButton(\"mouse-wheel\").UNSAFE_setValue(event.wheel);\n        break;\n    }\n    return this;\n  }\n\n  onAfterUpdate() {\n    this.getRequiredInput().getOrCreateButton(\"mouse-wheel\").UNSAFE_setValue(0);\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { KeyboardInputEvent } from \"./KeyboardInputEvent\";\n\nexport class KeyboardInputHandler extends InputHandler {\n  onEvent(time: Time, event: KeyboardInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"keydown\":\n        input.getOrCreateButton(event.code).UNSAFE_down(time.getFrame());\n        break;\n      case \"keyup\":\n        input.getOrCreateButton(event.code).UNSAFE_up(time.getFrame());\n        break;\n    }\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { TouchInputEvent } from \"./TouchInputEvent\";\n\nexport class TouchInputHandler extends InputHandler {\n  onEvent(time: Time, event: TouchInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"touchstart\":\n        input.getOrCreateButton(`touch-${event.id}-x`).UNSAFE_setValue(event.x);\n        input.getOrCreateButton(`touch-${event.id}-y`).UNSAFE_setValue(event.y);\n\n        input\n          .getOrCreateButton(`touch-${event.id}`)\n          .UNSAFE_down(time.getFrame());\n        break;\n      case \"touchmove\":\n        input.getOrCreateButton(`touch-${event.id}-x`).UNSAFE_setValue(event.x);\n        input.getOrCreateButton(`touch-${event.id}-y`).UNSAFE_setValue(event.y);\n        break;\n      case \"touchend\":\n        input.getOrCreateButton(`touch-${event.id}`).UNSAFE_up(time.getFrame());\n        break;\n    }\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { ResizeInputEvent } from \"./ResizeInputEvent\";\n\nexport class ResizeInputHandler extends InputHandler {\n  onEvent(_time: Time, event: ResizeInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"resize\":\n        input.getOrCreateButton(\"screen-width\").UNSAFE_setValue(event.width);\n        input.getOrCreateButton(\"screen-height\").UNSAFE_setValue(event.height);\n        break;\n    }\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\nimport { Plugin } from \"../../Plugin\";\nimport { Time } from \"../Time\";\nimport { InputAxis } from \"./InputAxis\";\nimport { InputButton } from \"./InputButton\";\nimport { InputHandler } from \"./InputHandler\";\nimport { MouseInputHandler } from \"./MouseInputHandler\";\nimport { KeyboardInputHandler } from \"./KeyboardInputHandler\";\nimport type { EventListener } from \"./EventListener\";\nimport { TouchInputHandler } from \"./TouchInputHandler\";\nimport type { InputEvent } from \"./InputEvent\";\nimport { ResizeInputHandler } from \"./ResizeInputHandler\";\nimport { IJSONObject, isJSONArray } from \"@aicacia/json\";\n\nexport type IInputEventTypes = {\n  \"add-input_handler\": (handler: InputHandler) => void;\n  \"remove-input_handler\": (handler: InputHandler) => void;\n  \"add-event_listener\": (listener: EventListener) => void;\n  \"remove-event_listener\": (listener: EventListener) => void;\n} & {\n  [name: string]: (event: InputEvent) => void;\n};\n\nexport class Input extends Plugin<IInputEventTypes> {\n  private events: InputEvent[] = [];\n\n  private inputHandlers: InputHandler[] = [];\n  private inputHandlerMap: Map<IConstructor<InputHandler>, InputHandler> =\n    new Map();\n\n  private eventListeners: EventListener[] = [];\n  private eventListenerMap: Map<IConstructor<EventListener>, EventListener> =\n    new Map();\n\n  private buttons: Record<string, InputButton> = {};\n  private axes: Record<string, InputAxis> = {};\n\n  constructor() {\n    super();\n\n    this.addInputHandler(\n      new MouseInputHandler(),\n      new KeyboardInputHandler(),\n      new TouchInputHandler(),\n      new ResizeInputHandler()\n    );\n    this.addAxis(\n      new InputAxis(\"horizontal-keys\", \"ArrowLeft\", \"ArrowRight\"),\n      new InputAxis(\"vertical-keys\", \"ArrowDown\", \"ArrowUp\")\n    );\n  }\n\n  queueEvent(event: InputEvent) {\n    this.emit(\"event\", event);\n    this.events.push(event);\n    return this;\n  }\n\n  addAxes(axes: InputAxis[]) {\n    for (const axis of axes) {\n      this._addAxis(axis);\n    }\n    return this;\n  }\n  addAxis(...axes: InputAxis[]) {\n    return this.addAxes(axes);\n  }\n  getAxis(name: string): InputAxis | null {\n    return this.axes[name] || null;\n  }\n  getAxisValue(name: string) {\n    const axis = this.getAxis(name);\n    if (axis) {\n      return axis.getValue();\n    } else {\n      return 0.0;\n    }\n  }\n\n  getRequiredAxis(name: string) {\n    const axis = this.getAxis(name);\n    if (!axis) {\n      throw new Error(`Failed to get Required Axis ${name}`);\n    }\n    return axis;\n  }\n\n  getInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ): I | null {\n    return (this.inputHandlerMap.get(InputHandler) as I) || null;\n  }\n  getRequiredInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ) {\n    const inputHandler = this.getInputHandler(InputHandler);\n    if (!inputHandler) {\n      throw new Error(`Failed to get Required InputHandler ${InputHandler}`);\n    }\n    return inputHandler;\n  }\n\n  getEventListener<I extends EventListener = EventListener>(\n    EventListener: IConstructor<I>\n  ): I | null {\n    return (this.eventListenerMap.get(EventListener) as I) || null;\n  }\n  getRequiredEventListener<I extends EventListener = EventListener>(\n    EventListener: IConstructor<I>\n  ) {\n    const eventListener = this.getEventListener(EventListener);\n    if (!eventListener) {\n      throw new Error(`Failed to get Required EventListener ${EventListener}`);\n    }\n    return eventListener;\n  }\n\n  removeAxes(axes: InputAxis[]) {\n    for (const axis of axes) {\n      this._removeAxis(axis);\n    }\n    return this;\n  }\n  removeAxis(...axes: InputAxis[]) {\n    return this.removeAxes(axes);\n  }\n\n  addInputHandlers(inputHandlers: InputHandler[]) {\n    for (const inputHandler of inputHandlers) {\n      this._addInputHandler(inputHandler);\n    }\n    return this;\n  }\n  addInputHandler(...inputHandlers: InputHandler[]) {\n    return this.addInputHandlers(inputHandlers);\n  }\n\n  removeInputHandlers(inputHandlers: IConstructor<InputHandler>[]) {\n    for (const inputHandler of inputHandlers) {\n      this._removeInputHandler(inputHandler);\n    }\n    return this;\n  }\n  removeInputHandler(...inputHandlers: IConstructor<InputHandler>[]) {\n    return this.removeInputHandlers(inputHandlers);\n  }\n\n  addEventListeners(eventListeners: EventListener[]) {\n    for (const eventListener of eventListeners) {\n      this._addEventListener(eventListener);\n    }\n    return this;\n  }\n  addEventListener(...eventListeners: EventListener[]) {\n    return this.addEventListeners(eventListeners);\n  }\n\n  removeEventListeners(EventListeners: IConstructor<EventListener>[]) {\n    for (const EventListener of EventListeners) {\n      this._removeEventListener(EventListener);\n    }\n    return this;\n  }\n  removeEventListener(...eventListeners: IConstructor<EventListener>[]) {\n    return this.removeEventListeners(eventListeners);\n  }\n\n  getOrCreateButton(name: string) {\n    const button = this.buttons[name];\n\n    if (button) {\n      return button;\n    } else {\n      const newButton = new InputButton(name);\n      this.buttons[name] = newButton;\n      return newButton;\n    }\n  }\n  getButton(name: string): InputButton | null {\n    return this.buttons[name] || null;\n  }\n  getButtonValue(name: string) {\n    const button = this.getButton(name);\n    if (button) {\n      return button.getValue();\n    } else {\n      return 0.0;\n    }\n  }\n\n  isDownCurrentFrame(name: string) {\n    return (\n      this.getButton(name)?.getFrameDown() ===\n      this.getRequiredPlugin(Time).getFrame()\n    );\n  }\n  isDown(name: string) {\n    return !this.isUp(name);\n  }\n\n  isUpCurrentFrame(name: string) {\n    return (\n      this.getButton(name)?.getFrameUp() ===\n      this.getRequiredPlugin(Time).getFrame()\n    );\n  }\n  isUp(name: string) {\n    return this.getButtonValue(name) == 0.0;\n  }\n\n  onUpdate() {\n    const time = this.getRequiredPlugin(Time);\n    for (const eventListener of this.eventListeners) {\n      eventListener.onUpdate(time);\n    }\n    for (const inputHandler of this.inputHandlers) {\n      for (const event of this.events) {\n        inputHandler.onEvent(time, event);\n      }\n      inputHandler.onUpdate(time);\n    }\n    for (const event of this.events) {\n      this.emit(event.type, event);\n    }\n    for (const eventListener of this.eventListeners) {\n      for (let i = 0; i < this.events.length; i++) {\n        const event = this.events[i];\n\n        if (eventListener.dequeueEvent(event)) {\n          this.events.splice(i, 1);\n          i--;\n        }\n      }\n    }\n    this.events.length = 0;\n    this.updateAxes(time);\n    return this;\n  }\n\n  onAfterUpdate() {\n    const time = this.getRequiredPlugin(Time);\n    for (const eventListener of this.eventListeners) {\n      eventListener.onAfterUpdate(time);\n    }\n    for (const inputHandler of this.inputHandlers) {\n      inputHandler.onAfterUpdate(time);\n    }\n    return this;\n  }\n\n  private _addAxis(axis: InputAxis) {\n    if (!this.axes[axis.getName()]) {\n      this.axes[axis.getName()] = axis;\n    }\n    return this;\n  }\n\n  private _removeAxis(axis: InputAxis) {\n    if (this.axes[axis.getName()]) {\n      delete this.axes[axis.getName()];\n    }\n    return this;\n  }\n\n  private updateAxes(time: Time) {\n    for (const axis of Object.values(this.axes)) {\n      this.updateAxis(axis, time);\n    }\n  }\n\n  private updateAxis(axis: InputAxis, time: Time) {\n    const posValue = this.getButtonValue(axis.getPosButton()),\n      negValue = this.getButtonValue(axis.getNegButton());\n\n    axis.UNSAFE_update(\n      time,\n      axis.getValue(),\n      negValue !== 0.0,\n      posValue !== 0.0\n    );\n  }\n\n  private _addInputHandler<I extends InputHandler = InputHandler>(\n    inputHandler: I\n  ) {\n    const InputHandler = inputHandler.getConstructor();\n\n    if (!this.inputHandlerMap.has(InputHandler)) {\n      this.inputHandlers.push(inputHandler);\n      this.inputHandlerMap.set(InputHandler, inputHandler);\n      inputHandler.UNSAFE_setInput(this);\n      inputHandler.onAdd();\n      this.emit(\"add-input_handler\", inputHandler);\n    }\n\n    return this;\n  }\n  private _removeInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ) {\n    const inputHandler = this.getInputHandler(InputHandler);\n    if (inputHandler) {\n      this.emit(\"remove-input_handler\", inputHandler);\n      inputHandler.onRemove();\n\n      this.inputHandlers.splice(this.inputHandlers.indexOf(inputHandler), 1);\n      this.inputHandlerMap.delete(InputHandler);\n      inputHandler.UNSAFE_removeInput();\n    }\n    return this;\n  }\n\n  private _addEventListener<E extends EventListener = EventListener>(\n    eventListener: E\n  ) {\n    const EventListener = eventListener.getConstructor();\n\n    if (!this.eventListenerMap.has(EventListener)) {\n      this.eventListeners.push(eventListener);\n      this.eventListenerMap.set(EventListener, eventListener);\n      eventListener.UNSAFE_setInput(this);\n      eventListener.onAdd();\n      this.emit(\"add-event_listener\", eventListener);\n    }\n\n    return this;\n  }\n  private _removeEventListener<E extends EventListener = EventListener>(\n    EventListener: IConstructor<E>\n  ) {\n    const eventListener = this.getEventListener(EventListener);\n    if (eventListener) {\n      this.emit(\"remove-event_listener\", eventListener);\n      eventListener.onRemove();\n\n      this.eventListeners.splice(this.eventListeners.indexOf(eventListener), 1);\n      this.eventListenerMap.delete(EventListener);\n      eventListener.UNSAFE_removeInput();\n    }\n    return this;\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      buttons: Object.values(this.buttons).map((button) => button.toJSON()),\n      axes: Object.values(this.axes).map((axis) => axis.toJSON()),\n      inputHandlers: this.inputHandlers.map((inputHandler) =>\n        inputHandler.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.buttons)) {\n      for (const value of json.buttons) {\n        const buttonJSON = value as ReturnType<InputButton[\"toJSON\"]>,\n          button = new InputButton(buttonJSON.name).fromJSON(buttonJSON);\n        this.buttons[button.getName()] = button;\n      }\n    }\n    if (isJSONArray(json.axes)) {\n      this.addAxes(\n        json.axes.map((json) => {\n          const axisJSON = json as ReturnType<InputAxis[\"toJSON\"]>;\n          return new InputAxis(\n            axisJSON.name,\n            axisJSON.negButton,\n            axisJSON.posButton\n          ).fromJSON(axisJSON);\n        })\n      );\n    }\n    if (isJSONArray(json.inputHandlers)) {\n      this.addInputHandlers(\n        json.inputHandlers.map((json) =>\n          InputHandler.newFromJSON(json as IJSONObject)\n        )\n      );\n    }\n    return this;\n  }\n}\n","export class InputEvent<T extends string = string> {\n  type: T;\n\n  constructor(type: T) {\n    this.type = type;\n  }\n\n  static init<T extends string = string>(\n    event: InputEvent,\n    type: T\n  ): InputEvent {\n    event.type = type;\n    return event;\n  }\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class KeyboardInputEvent extends InputEvent<\"keyup\" | \"keydown\"> {\n  code = \"\";\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class MouseInputEvent extends InputEvent<\n  \"mousemove\" | \"mousedown\" | \"mouseup\" | \"mouseleave\"\n> {\n  button = 0;\n  x = 0;\n  y = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class MouseWheelInputEvent extends InputEvent<\"wheel\"> {\n  wheel = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class ResizeInputEvent extends InputEvent<\"resize\"> {\n  width = 0;\n  height = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class TouchInputEvent extends InputEvent<\n  \"touchstart\" | \"touchmove\" | \"touchend\"\n> {\n  id = 0;\n  x = 0;\n  y = 0;\n}\n","import type { Canvas } from \"../Canvas\";\nimport { RunOnUpdatePlugin } from \"./RunOnUpdatePlugin\";\nimport { Input } from \"./input\";\nimport type { IRequirement } from \"../IRequirement\";\nimport type { Plugin } from \"../Plugin\";\n\nexport class FullScreenCanvas extends RunOnUpdatePlugin {\n  static toFromJSONEnabled = false;\n  static requiredPlugins: IRequirement<Plugin>[] = [Input];\n\n  private canvas: Canvas;\n\n  constructor(canvas: Canvas) {\n    super();\n\n    this.canvas = canvas;\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  onAdd() {\n    this.getRequiredPlugin(Input).on(\"resize\", this.onResizeEventListener);\n    return this;\n  }\n\n  onRemove() {\n    this.getRequiredPlugin(Input).off(\"resize\", this.onResizeEventListener);\n    return this;\n  }\n\n  private onResizeEventListener = () => {\n    this.runOnUpdate(this.onResize);\n  };\n\n  private onResize() {\n    const input = this.getRequiredPlugin(Input);\n    this.canvas.set(\n      input.getButtonValue(\"screen-width\"),\n      input.getButtonValue(\"screen-height\")\n    );\n  }\n}\n","export type IRequestAnimationFrame = (\n  callback: (timestamp: number) => void\n) => number;\nexport type ICancelAnimationFrame = (handle: number) => void;\n\nconst win = typeof window !== \"undefined\" ? window : ({} as any),\n  p = typeof performance !== \"undefined\" ? performance : Date,\n  now = () => p.now();\n\nlet requestAnimationFrame: IRequestAnimationFrame =\n    win.requestAnimationFrame && win.requestAnimationFrame.bind(win),\n  cancelAnimationFrame: ICancelAnimationFrame =\n    win.cancelAnimationFrame && win.cancelAnimationFrame.bind(win);\n\nif (!requestAnimationFrame || !cancelAnimationFrame) {\n  let lastTime = 0;\n  requestAnimationFrame = (callback: (timestamp: number) => void) => {\n    const curr = now(),\n      next = Math.max(lastTime + 1000 / 60, curr);\n    return setTimeout(() => {\n      callback((lastTime = next));\n    }, next - curr) as any;\n  };\n  cancelAnimationFrame = (h) => clearTimeout(h as any);\n}\n\nexport { requestAnimationFrame, cancelAnimationFrame, now };\n","import {\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from \"./requestAnimationFrame\";\nimport { Input } from \"./input\";\nimport { Plugin } from \"../Plugin\";\n\nexport class EventLoop extends Plugin {\n  static requiredPlugins = [Input];\n  private id: number | null = null;\n  private running = false;\n\n  onInit() {\n    this.getRequiredPlugin(Input).on(\"event\", this.start);\n    this.start();\n    return this;\n  }\n  onRemove() {\n    this.getRequiredPlugin(Input).off(\"event\", this.start);\n    return this;\n  }\n\n  start = () => {\n    if (!this.running) {\n      this.running = true;\n      this.request();\n    }\n  };\n  stop() {\n    this.running = false;\n\n    if (this.id !== null) {\n      cancelAnimationFrame(this.id);\n      this.id = null;\n    }\n    return this;\n  }\n  isStopped() {\n    return this.running === false;\n  }\n\n  private run = (_ms: number) => {\n    this.id = null;\n    this.getRequiredScene().update();\n    this.running = false;\n    return this;\n  };\n\n  private request() {\n    this.id = requestAnimationFrame(this.run);\n    return this;\n  }\n}\n","import {\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from \"./requestAnimationFrame\";\nimport { Plugin } from \"../Plugin\";\n\nexport type ILoopHandler = (ms: number) => void;\n\nexport class Loop extends Plugin {\n  private id: number | null = null;\n  private running = false;\n  private resolves: Array<() => void> = [];\n\n  promise(): Promise<void> {\n    if (this.running) {\n      return new Promise((resolve) => this.resolves.push(resolve));\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  start() {\n    if (!this.running) {\n      this.running = true;\n      this.request();\n    }\n  }\n  stop() {\n    this.running = false;\n\n    if (this.id !== null) {\n      cancelAnimationFrame(this.id);\n      this.id = null;\n    }\n    return this;\n  }\n  isStopped() {\n    return this.running === false;\n  }\n\n  private run = (_ms: number) => {\n    this.getRequiredScene().update();\n\n    if (this.running) {\n      this.request();\n    } else if (this.resolves.length) {\n      const resolves = this.resolves;\n\n      this.resolves = [];\n\n      for (const resolve of resolves) {\n        resolve();\n      }\n    }\n    return this;\n  };\n\n  private request() {\n    this.id = requestAnimationFrame(this.run);\n    return this;\n  }\n\n  onInit() {\n    this.start();\n    return this;\n  }\n}\n","import { DefaultManager } from \"../../DefaultManager\";\nimport type { Camera2DControl } from \"./Camera2DControl\";\n\nexport class Camera2DControlManager extends DefaultManager<Camera2DControl> {\n  onInit() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { vec2 } from \"gl-matrix\";\nimport { Input } from \"../../plugins\";\nimport { Camera2D } from \"./Camera2D\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { Camera2DControlManager } from \"./Camera2DControlManager\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport { EPSILON } from \"../../math\";\n\nconst VEC2_0 = vec2.create(),\n  VEC2_1 = vec2.create(),\n  VEC2_2 = vec2.create(),\n  ZERO = vec2.fromValues(0, 0),\n  MIN_SCALE = vec2.fromValues(EPSILON, EPSILON);\n\nexport class Camera2DControl extends RenderableComponent {\n  static Manager = Camera2DControlManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n  static requiredPlugins = [Input];\n\n  private enabled = true;\n\n  private panSpeed = 1.0;\n  private zoomSpeed = 1.0;\n\n  private dragging = false;\n  private lastMouse: vec2 = vec2.create();\n  private offset: vec2 = vec2.create();\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getPanSpeed() {\n    return this.panSpeed;\n  }\n  setPanSpeed(panSpeed: number) {\n    this.panSpeed = panSpeed;\n    return this;\n  }\n\n  getZoomSpeed() {\n    return this.zoomSpeed;\n  }\n  setZoomSpeed(zoomSpeed: number) {\n    this.zoomSpeed = zoomSpeed;\n    return this;\n  }\n\n  onUpdate() {\n    const input = this.getRequiredPlugin(Input),\n      transform = TransformComponent.getRequiredTransform(\n        this.getRequiredEntity()\n      ),\n      scale = transform.getLocalScale2(VEC2_1),\n      camera = this.getRequiredComponent(Camera2D),\n      worldMouse = camera.toRelative(\n        VEC2_0,\n        vec2.set(\n          VEC2_0,\n          -input.getButtonValue(\"mouse-x\"),\n          -input.getButtonValue(\"mouse-y\")\n        )\n      );\n\n    if (this.dragging) {\n      vec2.sub(this.offset, worldMouse, this.lastMouse);\n      vec2.scale(this.offset, this.offset, this.panSpeed);\n      vec2.mul(this.offset, this.offset, scale);\n      vec2.rotate(this.offset, this.offset, ZERO, transform.getRotationZ());\n      this.enabled && transform.translate2(this.offset);\n    }\n\n    if (input.isDown(\"mouse-0\")) {\n      this.dragging = true;\n    } else {\n      this.dragging = false;\n    }\n\n    const mouseWheel = input.getButtonValue(\"mouse-wheel\"),\n      zoomSpeed = vec2.set(VEC2_2, this.zoomSpeed, this.zoomSpeed);\n\n    if (mouseWheel !== 0 && this.enabled) {\n      if (mouseWheel > 0) {\n        vec2.add(scale, scale, zoomSpeed);\n      } else if (mouseWheel < 0) {\n        vec2.sub(scale, scale, zoomSpeed);\n        vec2.max(scale, MIN_SCALE, scale);\n      }\n      transform.setLocalScale2(scale);\n    }\n\n    vec2.copy(this.lastMouse, worldMouse);\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      enabled: this.enabled,\n      zoomSpeed: this.zoomSpeed,\n      panSpeed: this.panSpeed,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    this.setEnabled(json.enabled as boolean);\n    this.setZoomSpeed(json.zoomSpeed as number);\n    this.setPanSpeed(json.panSpeed as number);\n    return this;\n  }\n}\n","import { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Camera3D } from \"./Camera3D\";\n\nexport class Camera3DManager extends DefaultDescriptorManager<Camera3D> {\n  private active: Camera3D | null = null;\n\n  setActive(camera: Camera3D) {\n    if (camera.getManager() === this) {\n      this.active = camera;\n    } else {\n      throw new Error(\n        \"Camera3DManager.setActive(camera: Camera3D): cannot set active if camera is not in manager\"\n      );\n    }\n    return this;\n  }\n  getActive() {\n    return this.active;\n  }\n  getRequiredActive() {\n    if (this.active) {\n      throw new Error(`Expected an Active Camera`);\n    }\n    return this.active;\n  }\n\n  addComponent(camera: Camera3D) {\n    super.addComponent(camera);\n\n    if (this.active === null) {\n      this.active = camera;\n    }\n\n    return this;\n  }\n\n  removeComponent(camera: Camera3D) {\n    super.removeComponent(camera);\n\n    if (this.active) {\n      if (this.active === camera) {\n        this.active = null;\n      }\n    }\n\n    return this;\n  }\n}\n","import { mat4, vec2, vec3, vec4 } from \"gl-matrix\";\nimport { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { EPSILON } from \"../../math\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { Camera3DManager } from \"./Camera3DManager\";\nimport type { IJSONArray, IJSONObject } from \"@aicacia/json\";\n\nconst MAT4_0 = mat4.create(),\n  VEC2_0 = vec2.create();\n\nexport class Camera3D extends RenderableComponent {\n  static Manager = Camera3DManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n\n  private width = 1.0;\n  private height = 1.0;\n  private aspect = 1.0;\n\n  private orthographic = false;\n\n  private size = 1;\n  private minSize = Number.EPSILON;\n  private maxSize = Infinity;\n\n  private fov = 16;\n  private near = EPSILON;\n  private far = 1024;\n\n  private projection = mat4.identity(mat4.create());\n  private view = mat4.identity(mat4.create());\n\n  private needsUpdate = true;\n  private background: vec4 = vec4.create();\n\n  getBackground() {\n    return this.background;\n  }\n  setBackground(background: vec4) {\n    vec4.copy(this.background, background);\n    return this;\n  }\n\n  set(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = width;\n      this.height = height;\n      this.aspect = width / height;\n      return this.setNeedsUpdate();\n    } else {\n      return this;\n    }\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n  getAspect() {\n    return this.aspect;\n  }\n\n  getSize() {\n    return this.size;\n  }\n  setSize(size: number) {\n    this.size =\n      size < this.minSize\n        ? this.minSize\n        : size > this.maxSize\n        ? this.maxSize\n        : size;\n    return this.setNeedsUpdate();\n  }\n  getMinSize() {\n    return this.minSize;\n  }\n  setMinSize(minSize: number) {\n    this.minSize = minSize;\n    return this.setNeedsUpdate();\n  }\n  getMaxSize() {\n    return this.minSize;\n  }\n  setMaxSize(maxSize: number) {\n    this.maxSize = maxSize;\n    return this.setNeedsUpdate();\n  }\n\n  getFov() {\n    return this.fov;\n  }\n  setFov(fov: number) {\n    this.fov = fov;\n    return this.setNeedsUpdate();\n  }\n\n  getNear() {\n    return this.near;\n  }\n  setNear(near: number) {\n    this.near = near;\n    return this.setNeedsUpdate();\n  }\n  getFar() {\n    return this.far;\n  }\n  setFar(far: number) {\n    this.far = far;\n    return this.setNeedsUpdate();\n  }\n\n  getView() {\n    const entity = this.getEntity();\n    if (entity) {\n      const transform = TransformComponent.getTransform(entity);\n      if (transform) {\n        mat4.invert(this.view, transform.getMatrix4(MAT4_0));\n      }\n    }\n    return this.view;\n  }\n\n  getProjection() {\n    return this.updateProjectionIfNeeded().projection;\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.needsUpdate = needsUpdate;\n    return this;\n  }\n\n  updateProjectionIfNeeded() {\n    if (this.needsUpdate) {\n      return this.updateProjection();\n    } else {\n      return this;\n    }\n  }\n\n  isActive(): boolean {\n    return this.getRequiredManager<Camera3DManager>().getActive() === this;\n  }\n  setActive() {\n    this.getRequiredManager<Camera3DManager>().setActive(this);\n    return this;\n  }\n  updateProjection() {\n    if (this.orthographic) {\n      const right = this.size * this.aspect,\n        left = -right,\n        top = this.size,\n        bottom = -top;\n\n      mat4.ortho(\n        this.projection,\n        left,\n        right,\n        bottom,\n        top,\n        this.near,\n        this.far\n      );\n    } else {\n      mat4.perspective(\n        this.projection,\n        this.fov,\n        this.aspect,\n        this.near,\n        this.far\n      );\n    }\n    this.needsUpdate = false;\n\n    return this;\n  }\n\n  toRelative(out: vec3, screen: vec2) {\n    this.toWorld(out, screen);\n    vec3.transformMat4(out, out, this.getView());\n    return out;\n  }\n\n  toWorld(out: vec3, screen: vec2) {\n    const mat = MAT4_0;\n\n    out[0] = 2.0 * (screen[0] / this.width) - 1.0;\n    out[1] = -2.0 * (screen[1] / this.height) + 1.0;\n    out[2] = this.near;\n\n    mat4.mul(mat, this.projection, this.getView());\n    mat4.invert(mat, mat);\n    vec3.transformMat4(out, out, mat);\n\n    return out;\n  }\n\n  toScreen(out: vec2, world: vec3) {\n    const mat = mat4.mul(MAT4_0, this.getProjection(), this.getView());\n\n    VEC2_0[0] = world[0];\n    VEC2_0[1] = world[1];\n    vec2.transformMat4(out, VEC2_0, mat);\n\n    out[0] = (out[0] + 1.0) * 0.5 * this.width;\n    out[1] = (1.0 - out[1]) * 0.5 * this.height;\n\n    return out;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      width: this.width,\n      height: this.height,\n      size: this.size,\n      fov: this.fov,\n      near: this.near,\n      far: this.far,\n      background: this.background as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .set(json.width as number, json.height as number)\n      .setSize(json.size as number)\n      .setFov(json.fov as number)\n      .setNear(json.near as number)\n      .setFar(json.far as number)\n      .setBackground(json.background as vec4);\n  }\n}\n","import { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Sprite } from \"./Sprite\";\n\nexport class SpriteManager extends DefaultDescriptorManager<Sprite> {\n  private layers: Record<number, Sprite[]> = {};\n\n  isEmpty() {\n    return Object.values(this.layers).length === 0;\n  }\n\n  getComponents() {\n    return ([] as Sprite[]).concat(...Object.values(this.layers));\n  }\n\n  addComponent(sprite: Sprite) {\n    this.getOrCreateLayer(sprite.getLayer()).push(sprite);\n    return this;\n  }\n  removeComponent(sprite: Sprite) {\n    const layerIndex = sprite.getLayer(),\n      layer = this.layers[layerIndex];\n\n    if (layer) {\n      const index = layer.indexOf(sprite);\n\n      if (index !== -1) {\n        layer.splice(index, 1);\n\n        if (layer.length === 0) {\n          delete this.layers[layerIndex];\n        }\n      }\n    }\n\n    return this;\n  }\n\n  sortFunction = (a: Sprite, b: Sprite) => {\n    return a.getRequiredEntity().getDepth() - b.getRequiredEntity().getDepth();\n  };\n\n  sort() {\n    for (const layer of Object.values(this.layers)) {\n      layer.sort(this.sortFunction);\n    }\n    return this;\n  }\n\n  private getOrCreateLayer(layerIndex: number) {\n    const layer = this.layers[layerIndex];\n\n    if (layer) {\n      return layer;\n    } else {\n      const newLayer: Sprite[] = [];\n      this.layers[layerIndex] = newLayer;\n      return newLayer;\n    }\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport type { vec2 } from \"gl-matrix\";\nimport { Assets } from \"../../plugins\";\nimport type { ImageAsset } from \"../../plugins/assets/ImageAsset\";\nimport { RenderableComponent } from \"../RenderableComponent\";\n\nexport class Sprite extends RenderableComponent {\n  static requiredPlugins = [Assets];\n\n  private layer = 0;\n  private imageAsset: ImageAsset | null = null;\n\n  private clipX = 0;\n  private clipY = 0;\n  private clipWidth = 1;\n  private clipHeight = 1;\n  private width = 1;\n  private height = 1;\n\n  getClipX() {\n    return this.clipX;\n  }\n  setClipX(clipX: number) {\n    this.clipX = clipX;\n    return this;\n  }\n\n  getClipY() {\n    return this.clipY;\n  }\n  setClipY(clipY: number) {\n    this.clipY = clipY;\n    return this;\n  }\n\n  getClipWidth() {\n    return this.clipWidth;\n  }\n  setClipWidth(clipWidth: number) {\n    this.clipWidth = clipWidth;\n    return this;\n  }\n\n  getClipHeight() {\n    return this.clipHeight;\n  }\n  setClipHeight(clipHeight: number) {\n    this.clipHeight = clipHeight;\n    return this;\n  }\n\n  getSize(out: vec2): vec2 {\n    out[0] = this.width;\n    out[1] = this.height;\n    return out;\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    this.width = width;\n    return this;\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    this.height = height;\n    return this;\n  }\n\n  getLayer() {\n    return this.layer;\n  }\n  setLayer(layer: number) {\n    const manager = this.getManager();\n    manager?.removeComponent(this);\n    this.layer = layer | 0;\n    manager?.addComponent(this);\n    return this;\n  }\n\n  getImageAsset<T extends ImageAsset = ImageAsset>(): T | null {\n    return this.imageAsset as T;\n  }\n  setImageAsset(imageAsset: ImageAsset) {\n    this.imageAsset = imageAsset;\n\n    if (imageAsset.isLoaded()) {\n      this.onImageLoadHandler();\n    } else {\n      imageAsset.on(\"load\", this.onImageLoadHandler);\n    }\n\n    return this;\n  }\n\n  private onImageLoadHandler = () => {\n    if (this.imageAsset) {\n      this.clipWidth = this.imageAsset.getWidth();\n      this.clipHeight = this.imageAsset.getHeight();\n      this.imageAsset.off(\"load\", this.onImageLoadHandler);\n    }\n  };\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      imageAssetUUID: this.imageAsset ? this.imageAsset.getUUID() : null,\n      layer: this.layer,\n      clipX: this.clipX,\n      clipY: this.clipY,\n      clipWidth: this.clipWidth,\n      clipHeight: this.clipHeight,\n      width: this.width,\n      height: this.height,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    const onAddToScene = () => {\n      this.setImageAsset(\n        this.getRequiredPlugin(Assets).getRequiredAsset<ImageAsset>(\n          json.imageAssetUUID as string\n        )\n      );\n      this.off(\"add-to-scene\", onAddToScene);\n    };\n\n    this.on(\"add-to-scene\", onAddToScene);\n\n    return super\n      .fromJSON(json)\n      .setLayer(json.layer as number)\n      .setClipX(json.clipX as number)\n      .setClipY(json.clipY as number)\n      .setClipWidth(json.clipWidth as number)\n      .setClipHeight(json.clipHeight as number)\n      .setWidth(json.width as number)\n      .setHeight(json.height as number);\n  }\n}\n\nimport { SpriteManager } from \"./SpriteManager\";\n\nSprite.Manager = SpriteManager;\n","import type { IJSONObject } from \"@aicacia/json\";\n\nexport class SpriteClip {\n  private duration = 1.0;\n  private x = 0;\n  private y = 0;\n  private width = 1;\n  private height = 1;\n\n  getDuration() {\n    return this.duration;\n  }\n  setDuration(duration: number) {\n    this.duration = duration;\n    return this;\n  }\n\n  getX() {\n    return this.x;\n  }\n  setX(x: number) {\n    this.x = x;\n    return this;\n  }\n\n  getY() {\n    return this.y;\n  }\n  setY(y: number) {\n    this.y = y;\n    return this;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    this.width = width;\n    return this;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    this.height = height;\n    return this;\n  }\n\n  toJSON() {\n    return {\n      duration: this.duration,\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    this.duration = json.duration as number;\n    this.x = json.x as number;\n    this.y = json.y as number;\n    this.width = json.width as number;\n    this.height = json.height as number;\n    return this;\n  }\n}\n","import type { SpriteClip } from \"./SpriteClip\";\nimport { Component } from \"../../Component\";\nimport { Time } from \"../../plugins/Time\";\nimport { Sprite } from \"./Sprite\";\n\nexport class SpriteSheet extends Component {\n  static requiredComponents = [Sprite];\n  static requiredPlugins = [Time];\n\n  private currentTime = 0;\n  private currentFrame = 0;\n  private playBack = 1;\n  private currentName: string | null = null;\n  private spriteSheets: Record<string, SpriteClip[]> = {};\n\n  get(name: string) {\n    return this.spriteSheets[name];\n  }\n  set(name: string, spriteClips: SpriteClip[]) {\n    this.spriteSheets[name] = spriteClips;\n    return this;\n  }\n  getPlayBack() {\n    return this.playBack;\n  }\n  setPlayBack(playBack: number) {\n    this.playBack = playBack;\n    return this;\n  }\n  setCurrent(name: string) {\n    if (!this.spriteSheets.hasOwnProperty(name)) {\n      throw new Error(\n        `SpriteSheet setCurrent(name: string) no SpriteSheet found named ${name}`\n      );\n    }\n    this.currentName = name;\n    this.currentFrame = 0;\n    this.currentTime = 0;\n    return this;\n  }\n  getCurrent() {\n    if (this.currentName) {\n      return this.get(this.currentName);\n    } else {\n      return null;\n    }\n  }\n\n  onUpdate() {\n    const clips = this.getCurrent();\n\n    if (clips) {\n      const clip = clips[this.currentFrame];\n\n      if (clip) {\n        const sprite = this.getRequiredComponent(Sprite);\n\n        sprite.setClipX(clip.getX());\n        sprite.setClipY(clip.getY());\n        sprite.setClipWidth(clip.getWidth());\n        sprite.setClipHeight(clip.getHeight());\n\n        if (this.currentTime >= clip.getDuration()) {\n          this.currentTime = 0;\n          this.currentFrame += 1;\n\n          if (this.currentFrame >= clips.length) {\n            this.currentFrame = 0;\n          }\n        }\n\n        this.currentTime +=\n          this.getRequiredPlugin(Time).getDelta() * this.playBack;\n      }\n    }\n    return this;\n  }\n}\n","import { RenderableComponent } from \"./RenderableComponent\";\nimport type { IRunOnUpdateFn } from \"../IRunOnUpdateFn\";\n\nexport abstract class RunOnUpdateComponent extends RenderableComponent {\n  private queue: IRunOnUpdateFn<this>[] = [];\n  private swap: IRunOnUpdateFn<this>[] = [];\n\n  runOnUpdate(...fns: IRunOnUpdateFn<this>[]) {\n    this.queue.push(...fns);\n    return this;\n  }\n\n  onUpdate() {\n    if (this.queue.length > 0) {\n      const queue = this.queue;\n\n      this.queue = this.swap;\n      this.swap = queue;\n\n      for (const fn of queue) {\n        fn.call(this);\n      }\n      this.swap.length = 0;\n    }\n    return this;\n  }\n}\n","import { TransformComponent } from \"./TransformComponent\";\nimport { Transform2D } from \"./Transform2D\";\nimport { Transform3D } from \"./Transform3D\";\nimport type { Entity } from \"../Entity\";\n\nexport {\n  Camera2D,\n  Camera2DManager,\n  Camera2DControl,\n  Camera2DControlManager,\n} from \"./Camera2D\";\nexport { Camera3D, Camera3DManager } from \"./Camera3D\";\nexport { Sprite, SpriteClip, SpriteManager, SpriteSheet } from \"./Sprite\";\nexport { Transform2D };\nexport { Transform3D };\nexport { RenderableComponent } from \"./RenderableComponent\";\nexport { RunOnUpdateComponent } from \"./RunOnUpdateComponent\";\nexport { TransformComponentManager } from \"./TransformComponentManager\";\n\nTransformComponent.getTransform = function getTransform(\n  entity: Entity\n): TransformComponent | null {\n  const entityTransform =\n    entity.getComponent<TransformComponent>(Transform2D) ||\n    entity.getComponent<TransformComponent>(Transform3D);\n\n  if (entityTransform) {\n    return entityTransform;\n  } else {\n    return TransformComponent.getParentTransform(entity);\n  }\n};\n\nexport { TransformComponent };\n","import { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport type { IConstructor } from \"@aicacia/core\";\nimport {\n  filterRequirements,\n  IRequirement,\n  requirementToString,\n} from \"./IRequirement\";\nimport { Component } from \"./Component\";\nimport type { Plugin } from \"./Plugin\";\nimport type { Scene } from \"./Scene\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface IEntityEventTypes {\n  \"add-component\": (component: Component) => void;\n  \"remove-component\": (component: Component) => void;\n  \"add-child\": (child: Entity) => void;\n  \"remove-child\": (child: Entity) => void;\n}\n\nexport class Entity extends ToFromJSONEventEmitter<IEntityEventTypes> {\n  private name: string | null = null;\n  private depth = 0;\n  private scene: Scene | null = null;\n  private root: Entity = this;\n  private parent: Entity | null = null;\n  private tags: Set<string> = new Set();\n  private children: Entity[] = [];\n  private components: Map<IConstructor<Component>, Component> = new Map();\n\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name = name;\n    return this;\n  }\n  removeName() {\n    this.name = null;\n    return this;\n  }\n\n  hasTags(tags: string[]) {\n    return tags.every((tag) => this.tags.has(tag));\n  }\n  hasTag(...tags: string[]) {\n    return this.hasTags(tags);\n  }\n  getTags() {\n    return this.tags;\n  }\n  addTags(tags: string[]) {\n    for (const tag of tags) {\n      this.tags.add(tag);\n    }\n    return this;\n  }\n  removeTag(...tags: string[]) {\n    return this.removeTags(tags);\n  }\n  removeTags(tags: string[]) {\n    for (const tag of tags) {\n      this.tags.delete(tag);\n    }\n    return this;\n  }\n  clearTags() {\n    this.tags.clear();\n    return this;\n  }\n  addTag(...tags: string[]) {\n    return this.addTags(tags);\n  }\n\n  getDepth() {\n    return this.depth;\n  }\n  getRoot() {\n    return this.root;\n  }\n  isRoot() {\n    return this.root === this;\n  }\n\n  hasParent(): boolean {\n    return this.parent !== null;\n  }\n  getParent() {\n    return this.parent;\n  }\n\n  hasScene() {\n    return this.scene !== null;\n  }\n  getScene() {\n    return this.scene;\n  }\n  getRequiredScene() {\n    const scene = this.getScene();\n    if (!scene) {\n      throw new Error(\"Entity expected to have a Scene\");\n    }\n    return scene;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene, recur = false) {\n    this.scene = scene;\n    if (recur) {\n      for (const child of this.children) {\n        child.UNSAFE_setScene(scene, recur);\n      }\n    }\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene = null;\n    return this;\n  }\n\n  forEachChild(fn: (entity: Entity) => false | void, recur = true) {\n    for (const child of this.getChildren()) {\n      if (fn(child) === false) {\n        break;\n      }\n\n      if (recur) {\n        child.forEachChild(fn, recur);\n      }\n    }\n    return this;\n  }\n  find(fn: (entity: Entity) => boolean, recur = true): Entity | undefined {\n    for (const child of this.getChildren()) {\n      if (fn(child)) {\n        return child;\n      } else if (recur) {\n        const found = child.find(fn, recur);\n\n        if (found) {\n          return found;\n        }\n      }\n    }\n\n    return undefined;\n  }\n  findWithName(name: string) {\n    return this.find((child) => child.name === name);\n  }\n  findWithTag(...tags: string[]) {\n    return this.find((entity) => entity.hasTags(tags));\n  }\n  findWithTags(tags: string[]) {\n    return this.findWithTag(...tags);\n  }\n  findWithComponent<C extends Component>(Component: IConstructor<C>) {\n    return this.find((entity) => entity.getComponent(Component) !== null);\n  }\n\n  findAll(fn: (entity: Entity) => boolean, recur = true): Entity[] {\n    const children = this.getChildren(),\n      matching = [];\n\n    for (const child of children) {\n      if (fn(child)) {\n        matching.push(child);\n      } else if (recur) {\n        matching.push(...child.findAll(fn, recur));\n      }\n    }\n\n    return matching;\n  }\n  findAllWithName(name: string, recur = true) {\n    return this.findAll((child) => name === child.name, recur);\n  }\n  findAllWithTag(...tags: string[]) {\n    return this.findAll((entity) => entity.hasTags(tags));\n  }\n  findAllWithTags(tags: string[]) {\n    return this.findAllWithTag(...tags);\n  }\n  findAllWithComponent<C extends Component>(\n    Component: IConstructor<C>,\n    recur = true\n  ) {\n    return this.findAll(\n      (entity) => entity.getComponent(Component) !== null,\n      recur\n    );\n  }\n\n  findParent(fn: (entity: Entity) => boolean): Entity | undefined {\n    const parent = this.getParent();\n\n    if (parent) {\n      if (fn(parent)) {\n        return parent;\n      } else {\n        return parent.findParent(fn);\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  getComponents() {\n    return this.components;\n  }\n  hasComponent<C extends Component = Component>(Component: IConstructor<C>) {\n    return this.getComponent(Component) !== null;\n  }\n  getComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C | null {\n    return (this.components.get(Component) as C) || null;\n  }\n  getRequiredComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ) {\n    const component = this.getComponent(Component);\n    if (!component) {\n      throw new Error(`Entity expected to have a ${Component} Component`);\n    }\n    return component;\n  }\n  getComponentInstanceOf<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C | null {\n    for (const component of this.components.values()) {\n      if (component instanceof Component) {\n        return component;\n      }\n    }\n    return null;\n  }\n  getComponentsInstanceOf<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C[] {\n    return Array.from(this.components.values()).filter(\n      (component) => component instanceof Component\n    ) as C[];\n  }\n\n  addComponents(components: Component[]) {\n    for (const component of components) {\n      this._addComponent(component);\n    }\n    return this;\n  }\n  addComponent(...components: Component[]) {\n    return this.addComponents(components);\n  }\n\n  removeComponents(Components: IConstructor<Component>[]) {\n    for (const Component of Components) {\n      this._removeComponent(Component);\n    }\n    return this;\n  }\n  removeComponent(...components: IConstructor<Component>[]) {\n    return this.removeComponents(components);\n  }\n\n  removeFromScene() {\n    const scene = this.scene;\n    if (scene) {\n      scene.removeEntity(this);\n    }\n  }\n  detach() {\n    const parent = this.parent;\n    if (parent) {\n      parent._removeChild(this);\n      const scene = this.scene;\n\n      if (scene) {\n        scene.addEntity(this);\n      }\n      for (const component of this.components.values()) {\n        component.onDetach();\n      }\n    }\n  }\n  getChildren(): readonly Entity[] {\n    return this.children;\n  }\n  addChildren(children: Entity[]) {\n    for (const child of children) {\n      this._addChild(child);\n    }\n    return this;\n  }\n  addChild(...children: Entity[]) {\n    return this.addChildren(children);\n  }\n\n  removeChildren(children: Entity[]) {\n    for (const child of children) {\n      this._removeChild(child);\n    }\n    return this;\n  }\n  removeChild(...children: Entity[]) {\n    return this.removeChildren(children);\n  }\n\n  validateRequirements() {\n    const missingComponents: Map<\n        IConstructor<Component>,\n        IRequirement<Component>[]\n      > = new Map(),\n      missingPlugins: Map<\n        IConstructor<Component>,\n        IRequirement<Plugin>[]\n      > = new Map();\n\n    for (const [Component, component] of this.components) {\n      const missingRequiredComponents = filterRequirements(\n          component.getRequiredComponents(),\n          (C) => !this.hasComponent(C)\n        ),\n        missingRequiredPlugins = filterRequirements(\n          component.getRequiredPlugins(),\n          (P) => !this.getRequiredScene().hasPlugin(P)\n        );\n\n      if (missingRequiredComponents.length > 0) {\n        missingComponents.set(Component, missingRequiredComponents);\n      }\n      if (missingRequiredComponents.length > 0) {\n        missingPlugins.set(Component, missingRequiredPlugins);\n      }\n    }\n\n    if (missingComponents.size > 0 || missingPlugins.size > 0) {\n      const componentMessage = [...missingComponents.entries()]\n          .map(([component, missingRequirements]) =>\n            missingRequirements\n              .map(\n                (missingRequirement) =>\n                  `Entity's ${requirementToString(\n                    component\n                  )} requires ${requirementToString(\n                    missingRequirement\n                  )} Component`\n              )\n              .join(\"\\n\")\n          )\n          .join(\"\\n\"),\n        pluginMessage = [...missingPlugins.entries()]\n          .map(([component, missingRequirements]) =>\n            missingRequirements\n              .map(\n                (missingRequirement) =>\n                  `Entity's ${requirementToString(\n                    component\n                  )} requires ${requirementToString(missingRequirement)} Plugin`\n              )\n              .join(\"\\n\")\n          )\n          .join(\"\\n\");\n\n      throw new Error(\n        componentMessage\n          ? `${componentMessage}\\n${pluginMessage}`\n          : pluginMessage\n      );\n    }\n  }\n\n  private _addComponent<C extends Component>(component: C) {\n    const Component = component.getConstructor();\n\n    if (!this.components.has(Component)) {\n      component.UNSAFE_setEntity(this);\n\n      this.components.set(Component, component);\n      this.scene?.UNSAFE_addComponent(component);\n      this.emit(\"add-component\", component);\n    }\n    return this;\n  }\n\n  private _removeComponent<C extends Component>(Component: IConstructor<C>) {\n    const component = this.getComponent(Component);\n\n    if (component) {\n      this.emit(\"remove-component\", component);\n      component.UNSAFE_removeEntity();\n\n      this.components.delete(Component);\n      this.scene?.UNSAFE_removeComponent(component);\n    }\n    return this;\n  }\n\n  private _addChild(child: Entity) {\n    if (this.children.indexOf(child) === -1) {\n      if (child.isRoot()) {\n        child.scene?.removeEntity(child);\n      }\n      child.parent?._removeChild(child);\n\n      this.children.push(child);\n\n      child.parent = this;\n      child.root = this.root;\n      child.setDepth(this.depth + 1);\n      this.scene?.UNSAFE_addEntityNow(child, true);\n\n      this.emit(\"add-child\", child);\n    }\n    return this;\n  }\n  private _removeChild(child: Entity) {\n    this.scene?.UNSAFE_removeEntityNow(child);\n    this.UNSAFE_removeChild(child);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeChild(child: Entity) {\n    const index = this.children.indexOf(child);\n\n    if (index !== -1) {\n      this.emit(\"remove-child\", child);\n      this.children.splice(index, 1);\n\n      child.scene = null;\n      child.parent = null;\n      child.root = child;\n      child.setDepth(0);\n    }\n    return this;\n  }\n\n  private setDepth(depth: number) {\n    this.depth = depth;\n    for (const child of this.children) {\n      child.setDepth(depth + 1);\n    }\n    return this;\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      name: this.name,\n      tags: [...this.tags.values()],\n      children: this.children.map((child) => child.toJSON()),\n      components: [...this.components.values()].map((component) =>\n        component.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (json.name) {\n      this.name = json.name as string;\n    }\n    if (isJSONArray(json.tags)) {\n      this.addTags(json.tags as string[]);\n    }\n    if (isJSONArray(json.children)) {\n      this.addChildren(\n        json.children.map((childJSON) =>\n          new Entity().fromJSON(childJSON as IJSONObject)\n        )\n      );\n    }\n    if (isJSONArray(json.components)) {\n      this.addComponents(\n        json.components.map(\n          (componentJSON) =>\n            Component.newFromJSON(componentJSON as IJSONObject) as Component\n        )\n      );\n    }\n    return this;\n  }\n}\n","import { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport type { IConstructor } from \"@aicacia/core\";\nimport type { Component } from \"./Component\";\nimport { Entity } from \"./Entity\";\nimport type { Manager } from \"./Manager\";\nimport { Plugin } from \"./Plugin\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface ISceneEventTypes {\n  maintain(): void;\n  update(): void;\n  init(): void;\n  clear(): void;\n  \"add-component\": (component: Component) => void;\n  \"remove-component\": (component: Component) => void;\n  \"add-plugin\": (plugin: Plugin) => void;\n  \"remove-plugin\": (plugin: Plugin) => void;\n  \"add-entity\": (entity: Entity) => void;\n  \"remove-entity\": (entity: Entity) => void;\n}\n\nexport class Scene extends ToFromJSONEventEmitter<ISceneEventTypes> {\n  private name: string | null = null;\n\n  private entities: Entity[] = [];\n  private entitiesToAdd: Entity[] = [];\n  private entitiesToRemove: Entity[] = [];\n\n  private managers: Manager[] = [];\n  private managerMap: Map<IConstructor<Manager>, Manager> = new Map();\n\n  private plugins: Plugin[] = [];\n  private pluginsMap: Map<IConstructor<Plugin>, Plugin> = new Map();\n\n  private isUpdating = false;\n  private isInitted = false;\n\n  init() {\n    if (!this.isInitted) {\n      this.isInitted = true;\n      this.emit(\"init\");\n      this.maintain();\n      for (const plugin of this.plugins) {\n        plugin.onInit();\n      }\n      for (const manager of this.managers) {\n        manager.onInit();\n      }\n      this.isInitted = true;\n    }\n    return this;\n  }\n\n  maintain(emit = true) {\n    emit && this.emit(\"maintain\");\n    for (const entity of this.entitiesToRemove) {\n      this.removeEntityNow(entity, true);\n    }\n    this.entitiesToRemove.length = 0;\n    for (const entity of this.entitiesToAdd) {\n      this.addEntityNow(entity, true);\n    }\n    this.entitiesToAdd.length = 0;\n    return this;\n  }\n\n  update() {\n    this.init();\n    this.isUpdating = true;\n    this.emit(\"update\");\n    this.maintain();\n    for (const plugin of this.plugins) {\n      plugin.onUpdate();\n    }\n    for (const manager of this.managers) {\n      manager.onUpdate();\n    }\n    for (const manager of this.managers) {\n      manager.onAfterUpdate();\n    }\n    for (const plugin of this.plugins) {\n      plugin.onAfterUpdate();\n    }\n    this.isUpdating = false;\n    return this;\n  }\n\n  clear() {\n    this.emit(\"clear\");\n    this.removeEntities(this.entities);\n    this.removePlugin(...this.pluginsMap.keys());\n    return this;\n  }\n\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name = name;\n    return this;\n  }\n  removeName() {\n    this.name = null;\n    return this;\n  }\n\n  forEachEntity(fn: (entity: Entity) => false | void, recur = true) {\n    for (const entity of this.entities) {\n      if (fn(entity) === false) {\n        break;\n      }\n\n      if (recur) {\n        entity.forEachChild(fn, recur);\n      }\n    }\n    return this;\n  }\n  find(fn: (entity: Entity) => boolean, recur = true): Entity | undefined {\n    for (const entity of this.entities) {\n      if (fn(entity)) {\n        return entity;\n      } else if (recur) {\n        const found = entity.find(fn, recur);\n\n        if (found) {\n          return found;\n        }\n      }\n    }\n\n    return undefined;\n  }\n  findWithTag(...tags: string[]) {\n    return this.find((entity) => entity.hasTags(tags), true);\n  }\n  findWithTags(tags: string[]) {\n    return this.findWithTag(...tags);\n  }\n  findWithName(name: string) {\n    return this.find((entity) => entity.getName() === name, true);\n  }\n\n  findAll(fn: (entity: Entity) => boolean, recur = true): Entity[] {\n    const matching = [];\n\n    for (const entity of this.entities) {\n      if (fn(entity)) {\n        matching.push(entity);\n      } else if (recur) {\n        matching.push(...entity.findAll(fn, recur));\n      }\n    }\n\n    return matching;\n  }\n  findAllWithTag(...tags: string[]) {\n    return this.findAll((entity) => entity.hasTags(tags), true);\n  }\n  findAllWithTags(tags: string[]) {\n    return this.findAllWithTag(...tags);\n  }\n  findAllWithName(name: string) {\n    return this.findAll((entity) => entity.getName() === name, true);\n  }\n\n  getEntities(): readonly Entity[] {\n    return this.entities;\n  }\n\n  getManagers(): readonly Manager[] {\n    return this.managers;\n  }\n\n  getManager<M extends Manager>(Manager: IConstructor<M>): M | null {\n    return (this.managerMap.get(Manager) as M) || null;\n  }\n  getRequiredManager<M extends Manager>(Manager: IConstructor<M>) {\n    const manager = this.getManager(Manager);\n    if (!manager) {\n      throw new Error(`Scene required ${Manager} Manager`);\n    }\n    return manager;\n  }\n\n  getPlugins(): readonly Plugin[] {\n    return this.plugins;\n  }\n\n  hasPlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin) !== null;\n  }\n  getPlugin<P extends Plugin>(Plugin: IConstructor<P>): P | null {\n    return (this.pluginsMap.get(Plugin) as P) || null;\n  }\n  getRequiredPlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    const plugin = this.getPlugin(Plugin);\n    if (!plugin) {\n      throw new Error(`Scene required ${Plugin} Plugin`);\n    }\n    return plugin;\n  }\n\n  addPlugins(plugins: Plugin[]) {\n    for (const plugin of plugins) {\n      this._addPlugin(plugin);\n    }\n    return this.sortPlugins();\n  }\n  addPlugin(...plugins: Plugin[]) {\n    return this.addPlugins(plugins);\n  }\n\n  removePlugins(Plugins: IConstructor<Plugin>[]) {\n    for (const Plugin of Plugins) {\n      this._removePlugin(Plugin);\n    }\n    return this;\n  }\n  removePlugin(...plugins: IConstructor<Plugin>[]) {\n    return this.removePlugins(plugins);\n  }\n\n  addEntities(entities: Entity[]) {\n    this.entitiesToAdd.push(...entities);\n    return this;\n  }\n  addEntity(...entities: Entity[]) {\n    return this.addEntities(entities);\n  }\n\n  removeEntities(entities: Entity[]) {\n    this.entitiesToRemove.push(...entities);\n    return this;\n  }\n  removeEntity(...entities: Entity[]) {\n    return this.removeEntities(entities);\n  }\n\n  addEntityNow(entity: Entity, force = false) {\n    if (this.isUpdating && !force) {\n      throw new Error(\n        \"Scene.addEntityNow called while updating, use force to suppress this Error\"\n      );\n    }\n    return this.UNSAFE_addEntityNow(entity, false);\n  }\n\n  removeEntityNow(entity: Entity, force = false) {\n    if (this.isUpdating && !force) {\n      throw new Error(\n        \"Scene.removeEntityNow called while updating, use force to suppress this Error\"\n      );\n    }\n    return this.UNSAFE_removeEntityNow(entity);\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_addComponent(component: Component) {\n    const Manager: IConstructor<Manager> = component.getManagerConstructor();\n\n    let manager = this.getManager(Manager);\n    if (!manager) {\n      manager = new Manager();\n\n      manager.UNSAFE_setScene(this);\n\n      this.managers.push(manager);\n      this.managerMap.set(Manager, manager);\n      this.sortManagers();\n\n      manager.onAdd();\n    }\n\n    manager.addComponent(component);\n    component.UNSAFE_setManager(manager);\n\n    manager.sort();\n    component.onAdd();\n\n    component.emit(\"add-to-scene\");\n    this.emit(\"add-component\", component);\n\n    return this;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_removeComponent(component: Component) {\n    const Manager: IConstructor<Manager> = component.getManagerConstructor();\n\n    const manager = this.getManager(Manager);\n\n    this.emit(\"remove-component\", component);\n    component.emit(\"remove-from-scene\");\n\n    if (manager) {\n      component.onRemove();\n\n      manager.removeComponent(component);\n      component.UNSAFE_removeManager();\n\n      if (manager.isEmpty()) {\n        manager.onRemove();\n\n        this.managers.splice(this.managers.indexOf(manager), 1);\n        this.managerMap.delete(Manager);\n      }\n    }\n\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_addEntityNow(entity: Entity, isChild: boolean) {\n    const entityScene = entity.getScene();\n\n    if (entityScene) {\n      if (entityScene === this) {\n        throw new Error(\n          \"Scene trying to add an Entity that is already a member of the Scene\"\n        );\n      } else {\n        entityScene.removeEntityNow(entity, true);\n      }\n    }\n\n    if (entity.isRoot()) {\n      this.entities.push(entity);\n    } else if (!isChild) {\n      throw new Error(\n        \"Scene trying to add an Entity that already has a parent\"\n      );\n    }\n\n    entity.UNSAFE_setScene(this);\n    for (const component of entity.getComponents().values()) {\n      this.UNSAFE_addComponent(component);\n    }\n    for (const child of entity.getChildren()) {\n      this.UNSAFE_addEntityNow(child, true);\n    }\n\n    if (process.env.NODE_ENV !== \"production\") {\n      entity.validateRequirements();\n    }\n\n    this.emit(\"add-entity\", entity);\n\n    return this;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_removeEntityNow(entity: Entity) {\n    const entityScene = entity.getScene();\n\n    if (entityScene) {\n      if (entityScene !== this) {\n        throw new Error(\n          \"Scene trying to remove an Entity that is not a member of the Scene\"\n        );\n      }\n    }\n\n    for (const component of entity.getComponents().values()) {\n      this.UNSAFE_removeComponent(component);\n    }\n\n    if (entity.isRoot()) {\n      const index = this.entities.indexOf(entity);\n\n      if (index !== -1) {\n        this.entities.splice(index, 1);\n        entity.UNSAFE_removeScene();\n      }\n    } else {\n      entity.getParent()?.UNSAFE_removeChild(entity);\n    }\n\n    for (const child of entity.getChildren().slice()) {\n      this.removeEntityNow(child, true);\n    }\n    this.emit(\"remove-entity\", entity);\n\n    return this;\n  }\n\n  private _addPlugin<P extends Plugin>(plugin: P) {\n    const Plugin: IConstructor<Plugin> = plugin.getConstructor();\n\n    if (!this.hasPlugin(Plugin)) {\n      const Plugin: IConstructor<Plugin> = plugin.getConstructor();\n\n      this.plugins.push(plugin);\n      this.pluginsMap.set(Plugin, plugin);\n      plugin.UNSAFE_setScene(this);\n      if (this.isInitted) {\n        plugin.onInit();\n      }\n      plugin.onAdd();\n      if (process.env.NODE_ENV !== \"production\") {\n        plugin.validateRequirements();\n      }\n      this.emit(\"add-plugin\", plugin);\n    }\n    return this;\n  }\n  private _removePlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    const plugin = this.getPlugin(Plugin);\n    if (plugin) {\n      this.emit(\"remove-plugin\", plugin);\n      plugin.onRemove();\n      plugin.UNSAFE_removeScene();\n      this.plugins.splice(this.plugins.indexOf(plugin), 1);\n      this.pluginsMap.delete(Plugin);\n    }\n    return this;\n  }\n\n  private sortPlugins() {\n    this.plugins.sort(this.sortPluginsFunction);\n    return this;\n  }\n  private sortPluginsFunction = (a: Plugin, b: Plugin) => {\n    return a.getPluginPriority() - b.getPluginPriority();\n  };\n\n  private sortManagers() {\n    this.managers.sort(this.managerSortFunction);\n    return this;\n  }\n  private managerSortFunction(a: Manager, b: Manager) {\n    return a.getManagerPriority() - b.getManagerPriority();\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      name: this.name || null,\n      plugins: this.plugins\n        .filter((plugin) =>\n          (plugin.getConstructor() as any).isToFromJSONEnabled()\n        )\n        .map((plugin) => plugin.toJSON()),\n      entities: this.entities.map((entity) => entity.toJSON()),\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (json.name) {\n      this.name = json.name as string;\n    }\n    if (isJSONArray(json.plugins)) {\n      this.addPlugins(\n        (json.plugins as Array<IJSONObject>).map((plugin) =>\n          Plugin.newFromJSON(plugin)\n        )\n      );\n    }\n    if (isJSONArray(json.entities)) {\n      this.addEntities(\n        json.entities.map((entity) =>\n          new Entity().fromJSON(entity as IJSONObject)\n        )\n      );\n    }\n    return this.maintain(false);\n  }\n}\n","import { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\n// tslint:disable-next-line: interface-name\nexport interface Entity {\n  on(\n    event: \"resize\",\n    listener: (\n      width: number,\n      height: number,\n      prevWidth: number,\n      prevHeight: number\n    ) => void\n  ): this;\n  off(\n    event: \"resize\",\n    listener: (\n      width: number,\n      height: number,\n      prevWidth: number,\n      prevHeight: number\n    ) => void\n  ): this;\n}\n\nexport abstract class Canvas extends ToFromJSONEventEmitter {\n  private width = 1;\n  private height = 1;\n\n  getWidth() {\n    return this.width;\n  }\n  getHeight() {\n    return this.height;\n  }\n\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n\n  set(width: number, height: number) {\n    const prevWidth = this.width,\n      prevHeight = this.height;\n\n    if (width !== prevWidth || height !== prevHeight) {\n      this.width = width;\n      this.height = height;\n\n      this.onResize();\n      this.emit(\"resize\", width, height, prevWidth, prevHeight);\n    }\n    return this;\n  }\n\n  abstract onResize(): this;\n}\n","import type { CtxRenderer } from \"./CtxRenderer\";\nimport { RendererHandler } from \"../../../plugins/renderer/RendererHandler\";\n\nexport abstract class CtxRendererHandler extends RendererHandler<CtxRenderer> {\n  static rendererHandlerPriority = 0;\n\n  getCtx() {\n    return this.getRequiredRenderer().getCtx();\n  }\n  getCamera() {\n    return this.getRequiredRenderer().getCamera();\n  }\n  getScale() {\n    return this.getRequiredRenderer().getScale();\n  }\n}\n","import { TransformComponentManager } from \"../../../../components/TransformComponentManager\";\nimport { CtxRendererHandler } from \"../CtxRendererHandler\";\nimport { mat2d } from \"gl-matrix\";\n\nconst MAT2D_0 = mat2d.create();\n\nexport class TransformCtxRendererHandler extends CtxRendererHandler {\n  onRender() {\n    const transformComponentManager = this.getManager(\n      TransformComponentManager\n    );\n    if (transformComponentManager) {\n      const renderer = this.getRequiredRenderer(),\n        scale = renderer.getScale();\n\n      for (const transform of transformComponentManager.getComponents()) {\n        if (transform.getRenderable()) {\n          renderer.render((ctx) => {\n            ctx.beginPath();\n            ctx.strokeStyle = \"#0c0\";\n            ctx.moveTo(0, 0);\n            ctx.lineTo(0, 0.5);\n            ctx.stroke();\n\n            ctx.beginPath();\n            ctx.strokeStyle = \"#00c\";\n            ctx.moveTo(0, 0);\n            ctx.lineTo(0.5, 0);\n            ctx.stroke();\n\n            ctx.beginPath();\n            ctx.arc(0, 0, scale * 2, 0, 2 * Math.PI);\n            ctx.fill();\n          }, transform.getMatrix2d(MAT2D_0));\n        }\n      }\n    }\n    return this;\n  }\n}\n","import { SpriteManager } from \"../../../../components/Sprite\";\nimport { TransformComponent } from \"../../../../components/TransformComponent\";\nimport { CtxRendererHandler } from \"../CtxRendererHandler\";\nimport { mat2d, vec2 } from \"gl-matrix\";\nimport type { WebImageAsset } from \"../../assets/WebImageAsset\";\nimport { getAABB2FromRect } from \"../../../../math\";\nimport { AABB2 } from \"../../../../math/AABB2\";\n\nconst MAT2_0 = mat2d.create(),\n  AABB2_0 = AABB2.create(),\n  AABB2_1 = AABB2.create(),\n  VEC2_0 = vec2.create(),\n  VEC2_1 = vec2.create();\n\nexport class SpriteCtxRendererHandler extends CtxRendererHandler {\n  onRender() {\n    const spriteManager = this.getManager(SpriteManager);\n    if (spriteManager) {\n      const renderer = this.getRequiredRenderer(),\n        cameraAABB2 = this.getCamera().getAABB2(AABB2_0),\n        aabb = AABB2_1,\n        tmp0 = VEC2_0,\n        tmp1 = VEC2_1;\n\n      for (const sprite of spriteManager.getComponents()) {\n        const image = sprite.getImageAsset<WebImageAsset>()?.getImage();\n\n        if (sprite.getRenderable() && image) {\n          const transform = TransformComponent.getRequiredTransform(\n            sprite.getRequiredEntity()\n          );\n\n          getAABB2FromRect(\n            aabb,\n            transform.getPosition2(tmp0),\n            transform.getRotationZ(),\n            sprite.getSize(tmp1)\n          );\n\n          if (AABB2.notIntersects(cameraAABB2, aabb)) {\n            continue;\n          }\n\n          renderer.render((ctx) => {\n            const width = sprite.getWidth(),\n              height = sprite.getHeight(),\n              halfWidth = width * 0.5,\n              halfHeight = height * 0.5;\n\n            ctx.scale(1, -1);\n            ctx.drawImage(\n              image,\n              sprite.getClipX(),\n              sprite.getClipY(),\n              sprite.getClipWidth(),\n              sprite.getClipHeight(),\n              -halfWidth,\n              -halfHeight,\n              width,\n              height\n            );\n          }, transform.getMatrix2d(MAT2_0));\n        }\n      }\n    }\n\n    return this;\n  }\n}\n","import { mat2d } from \"gl-matrix\";\nimport { Camera2D, Camera2DManager } from \"../../../components/Camera2D\";\nimport { toRgba } from \"../../../math\";\nimport { Renderer } from \"../../../plugins/renderer/Renderer\";\nimport type { IJSONObject } from \"@aicacia/json\";\n\nconst MAT2D_0 = mat2d.create();\n\nexport class CtxRenderer extends Renderer {\n  static toFromJSONEnabled = false;\n\n  private element: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private lineWidth = 1.0;\n  private camera: Camera2D | null = null;\n  private cameraView: mat2d = mat2d.create();\n  private cameraProjection: mat2d = mat2d.create();\n  private cameraViewProjection: mat2d = mat2d.create();\n  private scale = 1.0;\n  private enabled = true;\n\n  constructor(element: HTMLCanvasElement) {\n    super();\n\n    this.element = element;\n    this.ctx = element.getContext(\"2d\") as CanvasRenderingContext2D;\n  }\n\n  getCameraView() {\n    return this.cameraView;\n  }\n  getCameraProjection() {\n    return this.cameraProjection;\n  }\n  getCameraViewProjection() {\n    return this.cameraViewProjection;\n  }\n  getElement() {\n    return this.element;\n  }\n  getCtx() {\n    return this.ctx;\n  }\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getLineWidth() {\n    return this.lineWidth;\n  }\n  setLineWidth(lineWidth: number) {\n    this.lineWidth = lineWidth;\n    return this;\n  }\n\n  getActiveCamera() {\n    return this.getRequiredScene()\n      .getRequiredManager(Camera2DManager)\n      .getRequiredActive();\n  }\n  getCamera() {\n    return this.camera || this.getActiveCamera();\n  }\n  setCamera(camera: Camera2D) {\n    this.camera = camera;\n    return this;\n  }\n  removeCamera() {\n    this.camera = null;\n    return this;\n  }\n\n  private getCanvasSize() {\n    const width = this.element.width,\n      height = this.element.height;\n\n    return (width > height ? height : width) * 0.5;\n  }\n  getScale() {\n    return this.scale;\n  }\n\n  render(fn: (ctx: CanvasRenderingContext2D) => void, model?: mat2d) {\n    const mvp = MAT2D_0;\n\n    if (model) {\n      mat2d.mul(mvp, this.cameraViewProjection, model);\n    } else {\n      mat2d.copy(mvp, this.cameraViewProjection);\n    }\n    this.ctx.save();\n    this.ctx.transform(mvp[0], mvp[1], mvp[2], mvp[3], mvp[4], mvp[5]);\n    fn(this.ctx);\n    this.ctx.restore();\n    return this;\n  }\n\n  onUpdate() {\n    if (!this.enabled) {\n      return this;\n    }\n    const camera = this.getCamera(),\n      width = this.element.width,\n      height = this.element.height,\n      halfWidth = width * 0.5,\n      halfHeight = height * 0.5;\n\n    camera.set(width, height);\n    mat2d.copy(this.cameraView, camera.getView());\n    mat2d.copy(this.cameraProjection, camera.getProjection());\n    mat2d.mul(\n      this.cameraViewProjection,\n      this.cameraProjection,\n      this.cameraView\n    );\n    this.scale = (1.0 / this.getCanvasSize()) * camera.getZoom();\n\n    this.ctx.save();\n\n    this.ctx.save();\n    this.ctx.fillStyle = toRgba(camera.getBackground());\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.restore();\n\n    this.ctx.lineWidth = this.getLineWidth() * this.getScale();\n    this.ctx.transform(halfWidth, 0, 0, -halfHeight, halfWidth, halfHeight);\n\n    super.onUpdate();\n    this.ctx.restore();\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      lineWidth: this.lineWidth,\n      enabled: this.enabled,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.lineWidth = json.lineWidth as number;\n    this.enabled = json.enabled as boolean;\n    return this;\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport { ImageAsset } from \"../../../plugins/assets/ImageAsset\";\n\nexport class WebImageAsset extends ImageAsset {\n  private image: HTMLImageElement | null = null;\n  private src: string;\n\n  constructor(src: string) {\n    super();\n    this.src = src;\n  }\n\n  getImage() {\n    return this.image;\n  }\n  getWidth() {\n    return this.image?.width ?? 0;\n  }\n  getHeight() {\n    return this.image?.height ?? 0;\n  }\n\n  protected loadAsset() {\n    return new Promise<void>((resolve, reject) => {\n      const image = new Image();\n\n      image.addEventListener(\"load\", () => {\n        this.image = image;\n        resolve();\n      });\n      image.addEventListener(\"error\", (error) => reject(error));\n      image.src = this.src;\n    });\n  }\n\n  protected unloadAsset() {\n    this.image = null;\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      src: this.src,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.src = json.src as string;\n    return this;\n  }\n}\n","import { EventListener } from \"../../../plugins/input/EventListener\";\nimport { Pool } from \"@aicacia/pool\";\nimport {\n  TouchInputEvent,\n  MouseInputEvent,\n  MouseWheelInputEvent,\n  KeyboardInputEvent,\n  ResizeInputEvent,\n} from \"../../../plugins/input\";\n\nexport class WebEventListener extends EventListener {\n  static toFromJSONEnabled = false;\n\n  private touchInputEventPool = new Pool(TouchInputEvent, TouchInputEvent.init);\n  private mouseInputEventPool = new Pool(MouseInputEvent, MouseInputEvent.init);\n  private mouseWheelInputEventPool = new Pool(\n    MouseWheelInputEvent,\n    MouseWheelInputEvent.init\n  );\n  private keyboardInputEventPool = new Pool(\n    KeyboardInputEvent,\n    KeyboardInputEvent.init\n  );\n  private resizeInputEventPool = new Pool(\n    ResizeInputEvent,\n    ResizeInputEvent.init\n  );\n\n  private element: Element;\n  private window: Window;\n\n  constructor(element: Element) {\n    super();\n\n    this.element = element;\n    this.window = element.ownerDocument.defaultView as Window;\n  }\n\n  onAdd() {\n    this.window.addEventListener(\"orientationchange\", this.onResize);\n    this.window.addEventListener(\"resize\", this.onResize);\n\n    this.element.addEventListener(\"touchstart\", this.onTouch);\n    this.element.addEventListener(\"touchmove\", this.onTouch);\n    this.element.addEventListener(\"touchend\", this.onTouch);\n    this.element.addEventListener(\"touchcancel\", this.onTouch);\n\n    this.element.addEventListener(\"mousemove\", this.onMouse);\n    this.element.addEventListener(\"mousedown\", this.onMouse);\n    this.element.addEventListener(\"mouseup\", this.onMouse);\n    this.element.addEventListener(\"wheel\", this.onMouseWheel);\n    this.element.addEventListener(\"mouseleave\", this.onMouse);\n\n    this.element.addEventListener(\"keydown\", this.onKeyboard);\n    this.element.addEventListener(\"keyup\", this.onKeyboard);\n\n    this.onResize();\n\n    return this;\n  }\n\n  onRemove() {\n    this.window.removeEventListener(\"orientationchange\", this.onResize);\n    this.window.removeEventListener(\"resize\", this.onResize);\n\n    this.element.removeEventListener(\"touchstart\", this.onTouch);\n    this.element.removeEventListener(\"touchmove\", this.onTouch);\n    this.element.removeEventListener(\"touchend\", this.onTouch);\n    this.element.removeEventListener(\"touchcancel\", this.onTouch);\n\n    this.element.removeEventListener(\"mousemove\", this.onMouse);\n    this.element.removeEventListener(\"mousedown\", this.onMouse);\n    this.element.removeEventListener(\"mouseup\", this.onMouse);\n    this.element.removeEventListener(\"wheel\", this.onMouseWheel);\n    this.element.removeEventListener(\"mouseleave\", this.onMouse);\n\n    this.element.removeEventListener(\"keydown\", this.onKeyboard);\n    this.element.removeEventListener(\"keyup\", this.onKeyboard);\n\n    return this;\n  }\n\n  onResize = () => {\n    const event = this.resizeInputEventPool.create(\"resize\");\n\n    event.width = this.window.innerWidth;\n    event.height = this.window.innerHeight;\n\n    this.queueEvent(event);\n  };\n\n  onTouch = (e: Event) => {\n    const touchEvent = e as TouchEvent,\n      elementRect = this.element.getBoundingClientRect();\n\n    for (let i = 0, il = touchEvent.touches.length; i < il; i++) {\n      const touch = touchEvent.touches[i],\n        x = touch.clientX - elementRect.left,\n        y = touch.clientY - elementRect.top,\n        event = this.touchInputEventPool.create(touchEvent.type as any);\n\n      event.id = touch.identifier;\n      event.x = x;\n      event.y = y;\n\n      this.queueEvent(event);\n    }\n  };\n\n  onMouse = (e: Event) => {\n    const mouseEvent = e as MouseEvent,\n      elementRect = this.element.getBoundingClientRect(),\n      x = mouseEvent.clientX - elementRect.left,\n      y = mouseEvent.clientY - elementRect.top,\n      event = this.mouseInputEventPool.create(mouseEvent.type as any);\n\n    event.button = mouseEvent.button;\n    event.x = x;\n    event.y = y;\n\n    this.queueEvent(event);\n  };\n\n  onMouseWheel = (e: Event) => {\n    const mouseWheelEvent = e as WheelEvent,\n      event = this.mouseWheelInputEventPool.create(mouseWheelEvent.type as any);\n\n    event.wheel = mouseWheelEvent.deltaY;\n\n    this.queueEvent(event);\n  };\n\n  onKeyboard = (e: Event) => {\n    const keyEvent = e as KeyboardEvent,\n      event = this.keyboardInputEventPool.create(keyEvent.type as any);\n\n    event.code = keyEvent.code;\n\n    this.queueEvent(event);\n  };\n\n  dequeueEvent(event: InputEvent) {\n    if (event instanceof MouseInputEvent) {\n      this.mouseInputEventPool.release(event);\n      return true;\n    } else if (event instanceof KeyboardInputEvent) {\n      this.keyboardInputEventPool.release(event);\n      return true;\n    } else if (event instanceof MouseWheelInputEvent) {\n      this.mouseWheelInputEventPool.release(event);\n      return true;\n    } else if (event instanceof TouchInputEvent) {\n      this.touchInputEventPool.release(event);\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { Canvas } from \"../Canvas\";\n\nexport class WebCanvas extends Canvas {\n  private canvas: HTMLCanvasElement;\n\n  constructor(canvas?: HTMLCanvasElement) {\n    super();\n\n    this.canvas = canvas ? canvas : document.createElement(\"canvas\");\n    this.set(this.canvas.width, this.canvas.height);\n  }\n\n  getElement() {\n    return this.canvas;\n  }\n\n  onResize() {\n    this.canvas.width = this.getWidth();\n    this.canvas.height = this.getHeight();\n    this.canvas.style.width = `${this.getWidth()}px`;\n    this.canvas.style.height = `${this.getHeight()}px`;\n    return this;\n  }\n\n  getImageURI() {\n    return this.canvas\n      .toDataURL(\"image/png\")\n      .replace(\"image/png\", \"image/octet-stream\");\n  }\n\n  getStream(fps = 60): MediaStream {\n    return (this.canvas as any).captureStream(fps);\n  }\n}\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","JSONClassRegistry","constructor","constructorToTypeId","Map","typeIdToConstructor","getByConstructor","klass","typeId","get","storedKlass","Error","getTypeId","set","getById","globalJSONClassRegistry","ToFromJSONEventEmitter","static","toFromJSONEnabled","json","getConstructorFromJSON","fromJSON","getConstructor","getPrototypeOf","toJSON","_json","Manager","scene","managerPriority","UNSAFE_setScene","UNSAFE_removeScene","getScene","getManagerPriority","getPlugin","Plugin","getRequiredPlugin","plugin","getManager","getRequiredManager","manager","onAdd","onRemove","DefaultManager","components","sortFunction","a","b","getRequiredEntity","getDepth","getComponents","addComponent","component","removeComponent","index","indexOf","splice","isEmpty","sort","onInit","onUpdate","onAfterUpdate","Component","entity","requiredComponents","requiredPlugins","getManagerConstructor","getRequiredComponents","getRequiredPlugins","getComponent","getRequiredComponent","UNSAFE_setEntity","UNSAFE_removeEntity","getEntity","getRequiredScene","svene","UNSAFE_setManager","UNSAFE_removeManager","getSceneManager","getRequiredSceneManager","onDetach","RenderableComponent","renderable","getRenderable","setRenderable","DefaultDescriptorManager","TransformComponentManager","VEC2_0","vec2","VEC3_0","vec3","TransformComponent","needsUpdate","localNeedsUpdate","parent","getParent","getTransform","_entity","transform","setNeedsUpdate","getParentTransform","setLocalNeedsUpdate","child","getChildren","getComponentsInstanceOf","getNeedsUpdate","getLocalNeedsUpdate","updateLocalMatrixIfNeeded","updateLocalMatrix","updateMatrixIfNeeded","updateMatrix","translate2","position","current","getLocalPosition2","add","setLocalPosition2","translate3","getLocalPosition3","setLocalPosition3","scale2","scale","getLocalScale2","mul","scale3","getLocalScale3","AABB2","min","fromValues","Infinity","max","out","setMin","setMax","copy","aabb","v","notIntersects","DEG_TO_RAD","Math","PI","RAD_TO_DEG","HALF_PI","TAU","EPSILON","composeMat2d","rotation","sx","sy","c","cos","s","sin","extractScale_VEC2_0","extractScale","matrix","decomposeMat2d","getRotationFromMat2d","atan2","getPointFromAngle","angle","getAngleFromPoint","x","y","getTangentAngle_VEC2_0","getTangentAngle","vec","tmp","tmpX","getAngleBetweenPoints","sign","acos","dot","value","clamp","angleVec2","vec2FromAngle","projectPointOnAxis","point","axis","squaredLength","dotProduct","radToDeg","rad","degToRad","def","equals","abs","toHex","color","toString","toRgb","toRgba","mat4FromMat2d","mat4","mat2dFromMat4","mat2d","getAABB2_points","getAABB2FromRect","size","points","hw","hh","identity","forEach","rotate","expandPoint","VEC3_UP","MAT2_0","Transform2D","localPosition","localScale","localRotation","localMatrix","getLocalPosition","setLocalPosition","getPosition2","getPosition","getPosition3","getLocalRotationZ","getLocalRotation","getLocalRotationQuat","quat","fromEuler","setLocalRotationZ","setLocalRotation","setLocalRotationQuat","getAxisAngle","getRotationZ","getRotation","getRotationQuat","getLocalScale","setLocalScale2","setLocalScale","setLocalScale3","getScale2","getScale","getScale3","getMatrix","getLocalMatrix","parentTransform","getMatrix2d","getMatrix4","getLocalMatrix4","getLocalMatrix2d","toLocalPosition","sub","lookAt","assign","super","MAT4_0","QUAT_0","Transform3D","localRotationQuat","rotateZ","fromRotationTranslationScale","getScaling","getTranslation","up","targetTo","Camera2DManager","active","setActive","camera","getActive","getRequiredActive","MAT2D_0","POINTS","Camera2D","width","height","aspect","minSize","Number","maxSize","projection","view","background","vec4","getBackground","setBackground","getWidth","setWidth","getHeight","setHeight","getAspect","getSize","setSize","getMinSize","setMinSize","getMaxSize","setMaxSize","setZoom","zoom","getZoom","getView","invert","getProjection","updateProjectionIfNeeded","getAABB2","transformMat2d","updateProjection","isActive","right","left","bottom","toRelative","screen","toWorld","mat","toScreen","world","Asset","uuid","v4","loaded","loading","getUUID","getName","setName","isLoaded","isLoading","load","Promise","resolve","loadAsset","then","catch","error","unload","unloadAsset","filterRequirements","requirements","filter","reduce","missing","requirement","isArray","some","requirementToString","map","join","pluginPriority","getPluginPriority","validateRequirements","missingPlugins","getPlugins","missingRequiredPlugins","P","hasPlugin","pluginMessage","missingRequirement","Assets","assetMap","assets","loadedAssets","loadingPromises","unloadingPromises","find","findWithName","asset","findAll","findAllWithName","getAsset","getRequiredAsset","getAssets","getLoadedAssets","getLoadingAssets","from","keys","getUnloadingAssets","getUnloadedAssets","addAsset","addAssets","_addAsset","removeAsset","removeAssets","_removeAsset","loadAll","loadAssets","loadAllInBackground","loadAssetsInBackground","loadAssetInBackground","unloadAssetInBackground","unloadAssetsInBackground","unloadAssets","all","_loadAsset","_unloadAsset","promise","delete","isJSONArray","newFromJSON","JSONAsset","src","options","getJSON","fetch","response","RawJSONAsset","ImageAsset","RendererHandler","renderer","enabled","rendererHandlerPriority","getEnabled","setEnabled","getRendererHandlerPriority","UNSAFE_setRenderer","UNSAFE_removeRenderer","getRenderer","getRequiredRenderer","onBeforeRender","onRender","onAfterRender","Renderer","rendererHandlers","rendererHandlerMap","sortRendererHandlersFunction","getRendererHandlers","getRendererHandler","addRendererHandlers","rendererHandler","_addRendererHandler","sortRendererHandlers","addRendererHandler","removeRendererHandlers","RendererHandlers","_removeRendererHandler","removeRendererHandler","Time","fixedDelta","frame","last","delta","fps","fpsFrame","fpsLast","startTime","Date","now","minDelta","maxDelta","getStartTime","getDelta","getRealDelta","getCurrent","getMinDelta","setMinDelta","getMaxDelta","setMaxDelta","getFrame","getFps","setScale","getFixedDelta","setFixedDelta","RunOnUpdatePlugin","queue","swap","runOnUpdate","fns","EventListener","input","UNSAFE_setInput","UNSAFE_removeInput","getInput","getRequiredInput","queueEvent","_time","InputAxis","negButton","posButton","gravity","sensitivity","dead","getNegButton","setNegButton","getPosButton","setPosButton","getGravity","setGravity","getSensitivity","setSensitivity","getDead","setDead","getValue","UNSAFE_setValue","UNSAFE_update","time","isNeg","isPos","InputButton","frameDown","frameUp","getFrameDown","getFrameUp","UNSAFE_up","UNSAFE_down","InputHandler","MouseInputHandler","onEvent","type","getOrCreateButton","button","wheel","KeyboardInputHandler","code","TouchInputHandler","id","ResizeInputHandler","Input","inputHandlers","inputHandlerMap","eventListeners","eventListenerMap","buttons","axes","addInputHandler","addAxis","addAxes","_addAxis","getAxis","getAxisValue","getRequiredAxis","getInputHandler","getRequiredInputHandler","inputHandler","getEventListener","getRequiredEventListener","eventListener","removeAxes","_removeAxis","removeAxis","addInputHandlers","_addInputHandler","removeInputHandlers","_removeInputHandler","removeInputHandler","addEventListeners","_addEventListener","addEventListener","removeEventListeners","EventListeners","_removeEventListener","removeEventListener","newButton","getButton","getButtonValue","isDownCurrentFrame","_a","isDown","isUp","isUpCurrentFrame","dequeueEvent","updateAxes","values","updateAxis","posValue","negValue","buttonJSON","axisJSON","InputEvent","KeyboardInputEvent","MouseInputEvent","MouseWheelInputEvent","ResizeInputEvent","TouchInputEvent","FullScreenCanvas","canvas","onResizeEventListener","onResize","getCanvas","win","window","p","performance","requestAnimationFrame","bind","cancelAnimationFrame","lastTime","callback","curr","next","setTimeout","h","clearTimeout","EventLoop","running","start","request","run","_ms","update","stop","isStopped","Loop","resolves","Camera2DControlManager","VEC2_1","VEC2_2","ZERO","MIN_SCALE","Camera2DControl","panSpeed","zoomSpeed","dragging","lastMouse","offset","getPanSpeed","setPanSpeed","getZoomSpeed","setZoomSpeed","getRequiredTransform","worldMouse","mouseWheel","Camera3DManager","Camera3D","orthographic","fov","near","far","getFov","setFov","getNear","setNear","getFar","setFar","top","ortho","perspective","transformMat4","SpriteManager","layers","sprite","getOrCreateLayer","getLayer","layerIndex","layer","newLayer","Sprite","imageAsset","clipX","clipY","clipWidth","clipHeight","onImageLoadHandler","getClipX","setClipX","getClipY","setClipY","getClipWidth","setClipWidth","getClipHeight","setClipHeight","setLayer","getImageAsset","setImageAsset","imageAssetUUID","onAddToScene","SpriteClip","duration","getDuration","setDuration","getX","setX","getY","setY","SpriteSheet","currentTime","currentFrame","playBack","currentName","spriteSheets","spriteClips","getPlayBack","setPlayBack","setCurrent","clips","clip","RunOnUpdateComponent","entityTransform","Entity","depth","root","tags","Set","children","removeName","hasTags","every","tag","hasTag","getTags","addTags","removeTag","removeTags","clearTags","clear","addTag","getRoot","isRoot","hasParent","hasScene","recur","forEachChild","found","findWithTag","findWithTags","findWithComponent","matching","findAllWithTag","findAllWithTags","findAllWithComponent","findParent","hasComponent","getComponentInstanceOf","addComponents","_addComponent","removeComponents","Components","_removeComponent","removeFromScene","removeEntity","detach","_removeChild","addEntity","addChildren","_addChild","addChild","removeChildren","removeChild","missingComponents","missingRequiredComponents","C","componentMessage","entries","missingRequirements","UNSAFE_addComponent","UNSAFE_removeComponent","_b","setDepth","_c","UNSAFE_addEntityNow","UNSAFE_removeEntityNow","UNSAFE_removeChild","childJSON","componentJSON","Scene","entities","entitiesToAdd","entitiesToRemove","managers","managerMap","plugins","pluginsMap","isUpdating","isInitted","sortPluginsFunction","init","maintain","removeEntityNow","addEntityNow","removeEntities","removePlugin","forEachEntity","getEntities","getManagers","addPlugins","_addPlugin","sortPlugins","addPlugin","removePlugins","Plugins","_removePlugin","addEntities","force","sortManagers","isChild","entityScene","managerSortFunction","isToFromJSONEnabled","Canvas","prevWidth","prevHeight","CtxRendererHandler","getCtx","getCamera","TransformCtxRendererHandler","transformComponentManager","render","ctx","beginPath","strokeStyle","moveTo","lineTo","stroke","arc","fill","AABB2_0","AABB2_1","SpriteCtxRendererHandler","spriteManager","cameraAABB2","tmp0","tmp1","image","getImage","halfWidth","halfHeight","drawImage","CtxRenderer","element","lineWidth","cameraView","cameraProjection","cameraViewProjection","getContext","getCameraView","getCameraProjection","getCameraViewProjection","getElement","getLineWidth","setLineWidth","getActiveCamera","setCamera","removeCamera","getCanvasSize","model","mvp","save","restore","fillStyle","fillRect","WebImageAsset","reject","Image","WebEventListener","touchInputEventPool","Pool","mouseInputEventPool","mouseWheelInputEventPool","keyboardInputEventPool","resizeInputEventPool","innerWidth","innerHeight","onTouch","e","touchEvent","elementRect","getBoundingClientRect","il","touches","touch","clientX","clientY","identifier","onMouse","mouseEvent","onMouseWheel","mouseWheelEvent","deltaY","onKeyboard","keyEvent","ownerDocument","defaultView","release","WebCanvas","document","createElement","style","getImageURI","toDataURL","replace","getStream","captureStream"],"mappings":"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"}