{"version":3,"file":"index.js","sources":["../node_modules/eventemitter3/index.js","../src/JSONClassRegistry.ts","../src/ToFromJSONEventEmitter.ts","../src/Manager.ts","../src/DefaultManager.ts","../src/Component.ts","../src/components/RenderableComponent.ts","../src/DefaultDescriptorManager.ts","../src/components/TransformComponentManager.ts","../src/components/TransformComponent.ts","../src/math/AABB2.ts","../src/math/index.ts","../src/components/Transform2D/Transform2D.ts","../src/components/Transform3D/Transform3D.ts","../src/components/Camera2D/Camera2DManager.ts","../src/components/Camera2D/Camera2D.ts","../src/plugins/assets/Asset.ts","../src/IRequirement.ts","../src/Plugin.ts","../src/plugins/assets/Assets.ts","../src/plugins/assets/JSONAsset.ts","../src/plugins/assets/RawJSONAsset.ts","../src/plugins/assets/ImageAsset.ts","../src/plugins/renderer/RendererHandler.ts","../src/plugins/renderer/Renderer.ts","../src/plugins/Time.ts","../src/plugins/RunOnUpdatePlugin.ts","../src/plugins/input/EventListener.ts","../src/plugins/input/InputAxis.ts","../src/plugins/input/InputButton.ts","../src/plugins/input/InputHandler.ts","../src/plugins/input/MouseInputHandler.ts","../src/plugins/input/KeyboardInputHandler.ts","../src/plugins/input/TouchInputHandler.ts","../src/plugins/input/ResizeInputHandler.ts","../src/plugins/input/Input.ts","../src/plugins/input/InputEvent.ts","../src/plugins/input/KeyboardInputEvent.ts","../src/plugins/input/MouseInputEvent.ts","../src/plugins/input/MouseWheelInputEvent.ts","../src/plugins/input/ResizeInputEvent.ts","../src/plugins/input/TouchInputEvent.ts","../src/plugins/FullScreenCanvas.ts","../src/plugins/requestAnimationFrame.ts","../src/plugins/EventLoop.ts","../src/plugins/Loop.ts","../src/components/Camera2D/Camera2DControlManager.ts","../src/components/Camera2D/Camera2DControl.ts","../src/components/Camera3D/Camera3DManager.ts","../src/components/Camera3D/Camera3D.ts","../src/components/Sprite/SpriteManager.ts","../src/components/Sprite/Sprite.ts","../src/components/Sprite/SpriteClip.ts","../src/components/Sprite/SpriteSheet.ts","../src/components/RunOnUpdateComponent.ts","../src/components/index.ts","../src/Entity.ts","../src/Scene.ts","../src/Canvas.ts","../src/web/plugins/renderer/CtxRendererHandler.ts","../src/web/plugins/renderer/2d/TransformCtxRendererHandler.ts","../src/web/plugins/renderer/2d/SpriteCtxRendererHandler.ts","../src/web/plugins/renderer/CtxRenderer.ts","../src/web/plugins/assets/WebImageAsset.ts","../src/web/plugins/input/WebEventListener.ts","../src/web/WebCanvas.ts"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","import { IConstructor, Option } from \"@aicacia/core\";\nimport type { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport class JSONClassRegistry {\n  private constructorToTypeId: Map<\n    IConstructor<ToFromJSONEventEmitter>,\n    string\n  > = new Map();\n  private typeIdToConstructor: Map<\n    string,\n    IConstructor<ToFromJSONEventEmitter>\n  > = new Map();\n\n  getByConstructor<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    klass: IConstructor<T>\n  ) {\n    return Option.from(this.constructorToTypeId.get(klass))\n      .map((typeId) => {\n        const storedKlass = this.typeIdToConstructor.get(typeId);\n\n        if (klass === storedKlass) {\n          return typeId;\n        } else {\n          throw new Error(\n            `${klass} and ${storedKlass} are using the same typeId ${typeId}`\n          );\n        }\n      })\n      .unwrapOrElse(() => {\n        const typeId = (\n          klass as any as typeof ToFromJSONEventEmitter\n        ).getTypeId();\n        this.constructorToTypeId.set(klass, typeId);\n        this.typeIdToConstructor.set(typeId, klass);\n        return typeId;\n      });\n  }\n  getById<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    typeId: string\n  ): Option<IConstructor<T>> {\n    return Option.from(this.typeIdToConstructor.get(typeId) as IConstructor<T>);\n  }\n}\n\nexport const globalJSONClassRegistry = new JSONClassRegistry();\n","import type { IConstructor } from \"@aicacia/core\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport type { ValidEventTypes } from \"eventemitter3\";\nimport { EventEmitter } from \"eventemitter3\";\n\nexport abstract class ToFromJSONEventEmitter<\n  EventTypes extends ValidEventTypes = any\n> extends EventEmitter<EventTypes> {\n  static typeId?: string;\n  static toFromJSONEnabled = true;\n\n  static toString() {\n    return this.getTypeId();\n  }\n  static getTypeId() {\n    return this.typeId || this.name;\n  }\n  static isToFromJSONEnabled() {\n    return !!this.toFromJSONEnabled;\n  }\n\n  static getConstructorFromJSON<\n    T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter\n  >(json: IJSONObject): IConstructor<T> {\n    return globalJSONClassRegistry\n      .getById<T>(json.typeId as string)\n      .expect(\n        () =>\n          `Failed to get class ${json.typeId} from globalJSONClassRegistry make sure the Component was added`\n      );\n  }\n\n  static newFromJSON<T extends ToFromJSONEventEmitter = ToFromJSONEventEmitter>(\n    json: IJSONObject\n  ): T {\n    const ComponentClass = this.getConstructorFromJSON<T>(json);\n    return new ComponentClass().fromJSON(json);\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  toJSON(): IJSONObject {\n    const typeId = globalJSONClassRegistry.getByConstructor(\n      this.getConstructor()\n    );\n\n    return {\n      typeId,\n    };\n  }\n  fromJSON(_json: IJSONObject) {\n    return this;\n  }\n}\n\nimport { globalJSONClassRegistry } from \"./JSONClassRegistry\";\n","import { none, Option, IConstructor } from \"@aicacia/core\";\nimport type { Component } from \"./Component\";\nimport type { Plugin } from \"./Plugin\";\nimport type { Scene } from \"./Scene\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport abstract class Manager<\n  C extends Component = Component\n> extends ToFromJSONEventEmitter {\n  static managerPriority = 0;\n\n  static getManagerPriority() {\n    return this.managerPriority;\n  }\n\n  protected scene: Option<Scene> = none();\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene) {\n    this.scene.replace(scene);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene.clear();\n    return this;\n  }\n  getScene(): Option<Scene> {\n    return this.scene;\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getManagerPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getManagerPriority();\n  }\n\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>): Option<P> {\n    return this.getScene().flatMap((scene) => scene.getPlugin(Plugin));\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin).expect(\n      () => `${this.getConstructor()} required ${Plugin} Plugin`\n    );\n  }\n\n  getManager<M extends Manager = Manager>(Manager: IConstructor<M>): Option<M> {\n    return this.getScene().flatMap((scene) => scene.getManager(Manager));\n  }\n  getRequiredManager<M extends Manager = Manager>(Manager: IConstructor<M>): M {\n    return this.getManager(Manager).expect(\n      () => `${this.getConstructor()} required ${Manager} Manager`\n    );\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n\n  abstract addComponent(component: C): this;\n  abstract removeComponent(component: C): this;\n  abstract isEmpty(): boolean;\n  abstract sort(): this;\n  abstract onInit(): this;\n  abstract onUpdate(): this;\n  abstract onAfterUpdate(): this;\n}\n","import type { Component } from \"./Component\";\nimport { Manager } from \"./Manager\";\n\nexport class DefaultManager<\n  C extends Component = Component\n> extends Manager<C> {\n  private components: C[] = [];\n\n  getComponents() {\n    return this.components;\n  }\n\n  addComponent(component: C) {\n    this.components.push(component);\n    return this;\n  }\n  removeComponent(component: C) {\n    const index = this.components.indexOf(component);\n\n    if (index !== -1) {\n      this.components.splice(index, 1);\n    }\n\n    return this;\n  }\n  isEmpty() {\n    return this.components.length === 0;\n  }\n\n  sortFunction = (a: C, b: C) => {\n    return a.getRequiredEntity().getDepth() - b.getRequiredEntity().getDepth();\n  };\n\n  sort() {\n    this.components.sort(this.sortFunction);\n    return this;\n  }\n\n  onInit() {\n    for (const component of this.components) {\n      component.onInit();\n    }\n    return this;\n  }\n  onUpdate() {\n    for (const component of this.components) {\n      component.onUpdate();\n    }\n    return this;\n  }\n  onAfterUpdate() {\n    for (const component of this.components) {\n      component.onAfterUpdate();\n    }\n    return this;\n  }\n}\n","import { none, Option, IConstructor } from \"@aicacia/core\";\nimport type { IRequirement } from \"./IRequirement\";\nimport { DefaultManager } from \"./DefaultManager\";\nimport type { Entity } from \"./Entity\";\nimport type { Manager } from \"./Manager\";\nimport type { Plugin } from \"./Plugin\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface IComponentEventType {\n  \"add-to-scene\": () => void;\n  \"remove-from-scene\": () => void;\n}\n\nexport abstract class Component extends ToFromJSONEventEmitter<IComponentEventType> {\n  static Manager: IConstructor<Manager> = DefaultManager;\n  static requiredComponents: IRequirement<Component>[] = [];\n  static requiredPlugins: IRequirement<Plugin>[] = [];\n\n  static getManagerConstructor<M extends Manager = Manager>(): IConstructor<M> {\n    if (!this.Manager) {\n      throw new Error(this + \" invalid Manager `\" + this.Manager + \"` \" + this);\n    }\n    return this.Manager as IConstructor<M>;\n  }\n  static getRequiredComponents(): IRequirement<Component>[] {\n    return this.requiredComponents;\n  }\n  static getRequiredPlugins(): IRequirement<Plugin>[] {\n    return this.requiredPlugins;\n  }\n\n  private entity: Option<Entity> = none();\n  private manager: Option<Manager> = none();\n\n  getManagerConstructor<M extends Manager = Manager>(): IConstructor<M> {\n    return Object.getPrototypeOf(this).constructor.getManagerConstructor();\n  }\n  getRequiredComponents(): IRequirement<Component>[] {\n    return Object.getPrototypeOf(this).constructor.requiredComponents;\n  }\n  getRequiredPlugins(): IRequirement<Plugin>[] {\n    return Object.getPrototypeOf(this).constructor.requiredPlugins;\n  }\n\n  getComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): Option<C> {\n    return this.getEntity().flatMap((entity) => entity.getComponent(Component));\n  }\n  getRequiredComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C {\n    return this.getComponent(Component).expect(\n      () => `${this.getConstructor()} Component requires ${Component} Component`\n    );\n  }\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    return this.getScene().flatMap((scene) => scene.getPlugin(Plugin));\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin).expect(\n      () => `${this.getConstructor()} Component requires ${Plugin} Plugin`\n    );\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setEntity(entity: Entity) {\n    this.entity.replace(entity);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeEntity() {\n    this.entity.clear();\n    return this;\n  }\n  getEntity() {\n    return this.entity;\n  }\n  getRequiredEntity() {\n    return this.getEntity().expect(\n      () => `${this.getConstructor()} Component requires an Entity`\n    );\n  }\n\n  getScene() {\n    return this.entity.flatMap((entity) => entity.getScene());\n  }\n  getRequiredScene() {\n    return this.getScene().expect(\n      () => `${this.getConstructor()} Component requires a Scene`\n    );\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setManager(manager: Manager) {\n    this.manager.replace(manager);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeManager() {\n    this.manager.clear();\n    return this;\n  }\n  getManager<M extends Manager = Manager>() {\n    return this.manager as Option<M>;\n  }\n  getRequiredManager<M extends Manager = Manager>() {\n    return this.getManager<M>().expect(\n      () =>\n        `${this.getConstructor()} Component is not part of a Manager ${Object.getPrototypeOf(\n          this\n        ).getManagerConstructor()} Manager`\n    );\n  }\n\n  getSceneManager<M extends Manager = Manager>(Manager: IConstructor<M>) {\n    return this.getScene().flatMap((scene) => scene.getManager(Manager));\n  }\n  getRequiredSceneManager<M extends Manager = Manager>(\n    Manager: IConstructor<M>\n  ) {\n    return this.getSceneManager(Manager).expect(\n      () =>\n        `${this.getConstructor()} Component requires ${Object.getPrototypeOf(\n          this\n        ).getManagerConstructor()} Manager`\n    );\n  }\n\n  onInit() {\n    return this;\n  }\n  onDetach() {\n    return this;\n  }\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { Component } from \"../Component\";\n\nexport class RenderableComponent extends Component {\n  private renderable = true;\n\n  getRenderable() {\n    return this.renderable;\n  }\n  setRenderable(renderable = true) {\n    this.renderable = renderable;\n    return this;\n  }\n}\n","import type { Component } from \"./Component\";\nimport { DefaultManager } from \"./DefaultManager\";\n\nexport class DefaultDescriptorManager<\n  C extends Component = Component\n> extends DefaultManager<C> {\n  onInit() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { DefaultDescriptorManager } from \"../DefaultDescriptorManager\";\nimport type { TransformComponent } from \"./TransformComponent\";\n\nexport class TransformComponentManager extends DefaultDescriptorManager<TransformComponent> {}\n","import type { Option } from \"@aicacia/core\";\nimport { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport type { Entity } from \"../Entity\";\nimport { RenderableComponent } from \"./RenderableComponent\";\nimport { TransformComponentManager } from \"./TransformComponentManager\";\n\nconst VEC2_0 = vec2.create(),\n  VEC3_0 = vec3.create();\n\nexport abstract class TransformComponent extends RenderableComponent {\n  static Manager = TransformComponentManager;\n\n  static getParentTransform(entity: Entity): Option<TransformComponent> {\n    return entity.getParent().andThen(TransformComponent.getTransform);\n  }\n\n  static getTransform(entity: Entity): Option<TransformComponent>;\n  static getTransform(_entity: any): any {\n    return undefined;\n  }\n\n  static getRequiredTransform(entity: Entity) {\n    return TransformComponent.getTransform(entity).expect(\n      `Entity required a TransformComponent`\n    );\n  }\n\n  private needsUpdate = true;\n  private localNeedsUpdate = true;\n\n  onDetach() {\n    return this.setNeedsUpdate();\n  }\n\n  getParentTransform() {\n    return this.getEntity().flatMap(TransformComponent.getParentTransform);\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.setLocalNeedsUpdate(needsUpdate);\n\n    if (needsUpdate !== this.needsUpdate) {\n      this.needsUpdate = needsUpdate;\n      this.getEntity().ifSome((entity) => {\n        for (const child of entity.getChildren()) {\n          for (const transform of child.getComponentsInstanceOf(\n            TransformComponent as any\n          )) {\n            (transform as TransformComponent).setNeedsUpdate(needsUpdate);\n          }\n        }\n      });\n    }\n    return this;\n  }\n  getNeedsUpdate() {\n    return this.needsUpdate;\n  }\n\n  setLocalNeedsUpdate(localNeedsUpdate = true) {\n    this.localNeedsUpdate = localNeedsUpdate;\n    return this;\n  }\n  getLocalNeedsUpdate() {\n    return this.localNeedsUpdate;\n  }\n\n  updateLocalMatrixIfNeeded() {\n    if (this.localNeedsUpdate) {\n      this.localNeedsUpdate = false;\n      return this.updateLocalMatrix();\n    } else {\n      return this;\n    }\n  }\n\n  updateMatrixIfNeeded() {\n    if (this.needsUpdate) {\n      this.needsUpdate = false;\n      return this.updateMatrix();\n    } else {\n      return this;\n    }\n  }\n\n  translate2(position: vec2): this {\n    const current = this.getLocalPosition2(VEC2_0);\n    vec2.add(current, current, position);\n    return this.setLocalPosition2(current);\n  }\n  translate3(position: vec3): this {\n    const current = this.getLocalPosition3(VEC3_0);\n    vec3.add(current, current, position);\n    return this.setLocalPosition3(current);\n  }\n\n  scale2(scale: vec2): this {\n    const current = this.getLocalScale2(VEC2_0);\n    vec2.mul(current, current, scale);\n    return this.setLocalPosition2(current);\n  }\n  scale3(scale: vec3): this {\n    const current = this.getLocalScale3(VEC3_0);\n    vec3.mul(current, current, scale);\n    return this.setLocalPosition3(current);\n  }\n\n  abstract updateLocalMatrix(): this;\n  abstract updateMatrix(): this;\n\n  abstract getMatrix2d(out: mat2d): mat2d;\n  abstract getMatrix4(out: mat4): mat4;\n\n  abstract getLocalMatrix2d(out: mat2d): mat2d;\n  abstract getLocalMatrix4(out: mat4): mat4;\n\n  abstract getLocalPosition2(out: vec2): vec2;\n  abstract getLocalPosition3(out: vec3): vec3;\n\n  abstract setLocalPosition2(localPosition: vec2): this;\n  abstract setLocalPosition3(localPosition: vec3): this;\n\n  abstract getLocalRotationZ(): number;\n  abstract getLocalRotationQuat(out: quat): quat;\n\n  abstract setLocalRotationZ(localRotation: number): this;\n  abstract setLocalRotationQuat(localRotation: quat): this;\n\n  abstract getLocalScale2(out: vec2): vec2;\n  abstract getLocalScale3(out: vec3): vec3;\n\n  abstract setLocalScale2(localScale: vec2): this;\n  abstract setLocalScale3(localScale: vec3): this;\n\n  abstract getPosition2(out: vec2): vec2;\n  abstract getPosition3(out: vec3): vec3;\n\n  abstract getRotationZ(): number;\n  abstract getRotationQuat(out: quat): quat;\n\n  abstract getScale2(out: vec2): vec2;\n  abstract getScale3(out: vec3): vec3;\n}\n","import { vec2 } from \"gl-matrix\";\n\nexport class AABB2 {\n  static create() {\n    return new AABB2();\n  }\n\n  static fromValues(min: vec2, max: vec2) {\n    return AABB2.set(AABB2.create(), min, max);\n  }\n\n  static set(out: AABB2, min: vec2, max: vec2) {\n    AABB2.setMin(out, min);\n    AABB2.setMax(out, max);\n    return out;\n  }\n  static setMin(out: AABB2, min: vec2) {\n    vec2.copy(out.min, min);\n    return out;\n  }\n  static setMax(out: AABB2, max: vec2) {\n    vec2.copy(out.max, max);\n    return out;\n  }\n\n  static identity(out: AABB2) {\n    vec2.set(out.min, Infinity, Infinity);\n    vec2.set(out.max, -Infinity, -Infinity);\n    return out;\n  }\n\n  static expandPoint(out: AABB2, aabb: AABB2, v: vec2) {\n    vec2.min(out.min, aabb.min, v);\n    vec2.max(out.max, aabb.max, v);\n    return out;\n  }\n\n  static union(out: AABB2, a: AABB2, b: AABB2) {\n    vec2.min(out.min, a.min, b.min);\n    vec2.max(out.max, a.max, b.max);\n    return out;\n  }\n\n  static intersects(a: AABB2, b: AABB2) {\n    return !this.notIntersects(a, b);\n  }\n\n  static notIntersects(a: AABB2, b: AABB2) {\n    return (\n      a.max[0] < b.min[0] ||\n      a.min[0] > b.max[0] ||\n      a.max[1] < b.min[1] ||\n      a.min[1] > b.max[1]\n    );\n  }\n\n  min: vec2 = vec2.fromValues(Infinity, Infinity);\n  max: vec2 = vec2.fromValues(-Infinity, -Infinity);\n}\n","import { mat2d, vec2, vec3, vec4, mat4 } from \"gl-matrix\";\nimport { AABB2 } from \"./AABB2\";\n\nexport const DEG_TO_RAD = Math.PI / 180;\nexport const RAD_TO_DEG = 180 / Math.PI;\nexport const HALF_PI = Math.PI * 0.5;\nexport const TAU = Math.PI * 2;\nexport const EPSILON = 0.000001;\n\nexport function composeMat2d(\n  out: mat2d,\n  position: vec2,\n  scale: vec2,\n  rotation: number\n): mat2d {\n  const sx = scale[0],\n    sy = scale[1],\n    c = Math.cos(rotation),\n    s = Math.sin(rotation);\n\n  out[0] = c * sx;\n  out[1] = s * sx;\n  out[2] = -s * sy;\n  out[3] = c * sy;\n  out[4] = position[0];\n  out[5] = position[1];\n\n  return out;\n}\n\nconst extractScale_VEC2_0 = vec2.create();\n\nexport function extractScale(out: vec2, matrix: mat2d): vec2 {\n  return vec2.set(\n    out,\n    vec2.len(vec2.set(extractScale_VEC2_0, matrix[0], matrix[1])),\n    vec2.len(vec2.set(extractScale_VEC2_0, matrix[2], matrix[3]))\n  );\n}\n\nexport function decomposeMat2d(\n  matrix: mat2d,\n  position: vec2,\n  scale: vec2\n): number {\n  vec2.set(position, matrix[4], matrix[5]);\n  extractScale(scale, matrix);\n  return getRotationFromMat2d(matrix);\n}\n\nexport function getRotationFromMat2d(matrix: mat2d): number {\n  return Math.atan2(matrix[2], matrix[0]);\n}\n\nexport function getPointFromAngle(out: vec2, angle: number) {\n  out[0] = Math.cos(angle);\n  out[1] = Math.sin(angle);\n  return out;\n}\n\nexport function getAngleFromPoint(out: vec2) {\n  const x = out[0],\n    y = out[1],\n    angle = Math.atan2(y, x);\n\n  if (y < 0) {\n    return TAU + angle;\n  } else {\n    return angle;\n  }\n}\n\nconst getTangentAngle_VEC2_0 = vec2.create();\n\nexport function getTangentAngle(vec: vec2) {\n  const tmp = vec2.copy(getTangentAngle_VEC2_0, vec),\n    tmpX = tmp[0];\n  tmp[0] = tmp[1];\n  tmp[1] = tmpX;\n  return getAngleFromPoint(tmp);\n}\n\nexport function getAngleBetweenPoints(a: vec2, b: vec2): number {\n  const sign = b[1] < a[1] ? -1 : 1;\n  return Math.acos(vec2.dot(a, b) / (vec2.len(a) * vec2.len(b))) * sign;\n}\n\nexport function sign(value: number) {\n  return value < 0 ? -1 : 1;\n}\n\nexport function clamp(value: number, min: number, max: number) {\n  return value < min ? min : value > max ? max : value;\n}\n\nexport function angleVec2(out: vec2) {\n  return Math.atan2(out[1], out[0]);\n}\n\nexport function vec2FromAngle(out: vec2, angle: number) {\n  out[0] = Math.cos(angle);\n  out[1] = Math.sin(angle);\n  return out;\n}\n\nexport function projectPointOnAxis(out: vec2, point: vec2, axis: vec2) {\n  const squaredLength = vec2.squaredLength(axis),\n    dotProduct = vec2.dot(point, axis);\n\n  return vec2.scale(out, axis, dotProduct / squaredLength);\n}\n\nexport function radToDeg(rad: number) {\n  return rad * RAD_TO_DEG;\n}\n\nexport function degToRad(def: number) {\n  return def * DEG_TO_RAD;\n}\n\nexport function equals(a: number, b: number) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\n\nexport function toHex(color: vec3 | vec4) {\n  return `#${((color[0] * 255) | 0).toString(16)}${(\n    (color[1] * 255) |\n    0\n  ).toString(16)}${((color[2] * 255) | 0).toString(16)}`;\n}\n\nexport function toRgb(color: vec3 | vec4) {\n  return `rgb(${color[0] * 255}, ${color[1] * 255}, ${color[2] * 255})`;\n}\n\nexport function toRgba(color: vec4) {\n  return `rgba(${color[0] * 255}, ${color[1] * 255}, ${color[2] * 255}, ${\n    color[3]\n  })`;\n}\n\nexport function mat4FromMat2d(out: mat4, matrix: mat2d) {\n  return mat4.set(\n    out,\n    matrix[0],\n    matrix[1],\n    0.0,\n    matrix[4],\n    matrix[2],\n    matrix[3],\n    0.0,\n    matrix[5],\n    0.0,\n    0.0,\n    1.0,\n    0.0,\n    0.0,\n    0.0,\n    0.0,\n    1.0\n  );\n}\n\nexport function mat2dFromMat4(out: mat2d, matrix: mat4) {\n  return mat2d.set(\n    out,\n    matrix[0],\n    matrix[1],\n    matrix[4],\n    matrix[5],\n    matrix[13],\n    matrix[14]\n  );\n}\n\nconst getAABB2_points = [\n  vec2.create(),\n  vec2.create(),\n  vec2.create(),\n  vec2.create(),\n];\n\nexport function getAABB2FromRect(\n  out: AABB2,\n  position: vec2,\n  angle: number,\n  size: vec2\n): AABB2 {\n  const points = getAABB2_points,\n    hw = size[0] * 0.5,\n    hh = size[1] * 0.5;\n\n  AABB2.identity(out);\n\n  vec2.set(points[0], position[0] - hw, position[1] - hh);\n  vec2.set(points[1], position[0] - hw, position[1] + hh);\n  vec2.set(points[2], position[0] + hw, position[1] + hh);\n  vec2.set(points[3], position[0] + hw, position[1] - hh);\n\n  points.forEach((point) => {\n    vec2.rotate(point, point, position, angle);\n    AABB2.expandPoint(out, out, point);\n  });\n\n  return out;\n}\n","import type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport {\n  composeMat2d,\n  decomposeMat2d,\n  getAngleBetweenPoints,\n  HALF_PI,\n  mat4FromMat2d,\n} from \"../../math\";\nimport { TransformComponent } from \"../TransformComponent\";\n\nconst VEC2_0 = vec2.create(),\n  VEC3_UP = vec3.fromValues(0, 0, 1),\n  MAT2_0 = mat2d.create();\n\nexport class Transform2D extends TransformComponent {\n  private localPosition: vec2 = vec2.create();\n  private localScale: vec2 = vec2.fromValues(1, 1);\n  private localRotation = 0.0;\n  private localMatrix: mat2d = mat2d.create();\n\n  private position: vec2 = vec2.create();\n  private scale: vec2 = vec2.fromValues(1, 1);\n  private rotation = 0.0;\n  private matrix: mat2d = mat2d.create();\n\n  getLocalPosition2(out: vec2) {\n    return vec2.copy(out, this.getLocalPosition());\n  }\n  getLocalPosition3(out: vec3) {\n    const localPosition = this.getLocalPosition();\n    out[0] = localPosition[0];\n    out[1] = localPosition[1];\n    return out;\n  }\n\n  setLocalPosition2(localPosition: vec2) {\n    return this.setLocalPosition(localPosition);\n  }\n  setLocalPosition3(localPosition: vec3) {\n    return this.setLocalPosition(\n      vec2.set(VEC2_0, localPosition[0], localPosition[1])\n    );\n  }\n\n  getPosition2(out: vec2) {\n    return vec2.copy(out, this.getPosition());\n  }\n  getPosition3(out: vec3) {\n    const position = this.getPosition();\n    out[0] = position[0];\n    out[1] = position[1];\n    return out;\n  }\n\n  getLocalRotationZ() {\n    return this.getLocalRotation();\n  }\n  getLocalRotationQuat(out: quat) {\n    return quat.fromEuler(out, 0, 0, this.getLocalRotation());\n  }\n\n  setLocalRotationZ(localRotation: number) {\n    return this.setLocalRotation(localRotation);\n  }\n  setLocalRotationQuat(localRotation: quat) {\n    return this.setLocalRotation(quat.getAxisAngle(VEC3_UP, localRotation));\n  }\n\n  getRotationZ() {\n    return this.getRotation();\n  }\n  getRotationQuat(out: quat) {\n    return quat.fromEuler(out, 0, 0, this.getRotation());\n  }\n\n  getLocalScale2(out: vec2) {\n    return vec2.copy(out, this.getLocalScale());\n  }\n  getLocalScale3(out: vec3) {\n    const localScale = this.getLocalScale();\n    out[0] = localScale[0];\n    out[1] = localScale[1];\n    return out;\n  }\n\n  setLocalScale2(localScale: vec2) {\n    return this.setLocalScale(localScale);\n  }\n  setLocalScale3(localScale: vec3) {\n    return this.setLocalScale(vec2.set(VEC2_0, localScale[0], localScale[1]));\n  }\n\n  getScale2(out: vec2) {\n    return vec2.copy(out, this.getScale());\n  }\n  getScale3(out: vec3) {\n    const scale = this.getScale();\n    out[0] = scale[0];\n    out[1] = scale[1];\n    return out;\n  }\n\n  setLocalPosition(localPosition: vec2) {\n    vec2.copy(this.localPosition, localPosition);\n    return this.setNeedsUpdate();\n  }\n  getPosition() {\n    return this.updateMatrixIfNeeded().position;\n  }\n  getLocalPosition() {\n    return this.localPosition;\n  }\n\n  setLocalScale(localScale: vec2) {\n    vec2.copy(this.localScale, localScale);\n    return this.setNeedsUpdate();\n  }\n  getScale() {\n    return this.updateMatrixIfNeeded().scale;\n  }\n  getLocalScale() {\n    return this.localScale;\n  }\n\n  setLocalRotation(localRotation: number) {\n    this.localRotation = localRotation;\n    return this.setNeedsUpdate();\n  }\n  getRotation() {\n    return this.updateMatrixIfNeeded().rotation;\n  }\n  getLocalRotation() {\n    return this.localRotation;\n  }\n\n  getMatrix() {\n    return this.updateMatrixIfNeeded().matrix;\n  }\n  getLocalMatrix() {\n    return this.updateLocalMatrixIfNeeded().localMatrix;\n  }\n\n  updateLocalMatrix() {\n    composeMat2d(\n      this.localMatrix,\n      this.localPosition,\n      this.localScale,\n      this.localRotation\n    );\n    return this;\n  }\n\n  updateMatrix() {\n    this.updateLocalMatrixIfNeeded()\n      .getParentTransform()\n      .mapOrElse(\n        (parentTransform) => {\n          mat2d.mul(\n            this.matrix,\n            parentTransform.getMatrix2d(MAT2_0),\n            this.localMatrix\n          );\n          this.rotation = decomposeMat2d(\n            this.matrix,\n            this.position,\n            this.scale\n          );\n        },\n        () => {\n          mat2d.copy(this.matrix, this.localMatrix);\n          vec2.copy(this.position, this.localPosition);\n          vec2.copy(this.scale, this.localScale);\n          this.rotation = this.localRotation;\n        }\n      );\n\n    return this;\n  }\n\n  getMatrix4(out: mat4) {\n    return mat4FromMat2d(out, this.getMatrix());\n  }\n  getMatrix2d(out: mat2d) {\n    return mat2d.copy(out, this.getMatrix());\n  }\n\n  getLocalMatrix4(out: mat4) {\n    return mat4FromMat2d(out, this.getLocalMatrix());\n  }\n  getLocalMatrix2d(out: mat2d) {\n    return mat2d.copy(out, this.getLocalMatrix());\n  }\n\n  toLocalPosition(out: vec2, position: vec2) {\n    return vec2.sub(out, position, this.getPosition());\n  }\n\n  lookAt(position: vec2) {\n    return this.setLocalRotation(\n      getAngleBetweenPoints(\n        this.localPosition,\n        this.toLocalPosition(VEC2_0, position)\n      ) - HALF_PI\n    );\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      localPosition: this.localPosition as IJSONArray,\n      localScale: this.localScale as IJSONArray,\n      localRotation: this.localRotation,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .setLocalPosition(json.localPosition as vec2)\n      .setLocalScale(json.localScale as vec2)\n      .setLocalRotation(json.localRotation as number);\n  }\n}\n","import type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { mat2d, mat4, quat, vec2, vec3 } from \"gl-matrix\";\nimport { mat2dFromMat4 } from \"../../math\";\nimport { TransformComponent } from \"../TransformComponent\";\n\nconst MAT4_0 = mat4.create(),\n  QUAT_0 = quat.create(),\n  VEC3_0 = vec3.create(),\n  VEC3_UP = vec3.fromValues(0, 0, 1);\n\nexport class Transform3D extends TransformComponent {\n  private localPosition: vec3 = vec3.create();\n  private localScale: vec3 = vec3.fromValues(1, 1, 1);\n  private localRotation: quat = quat.identity(quat.create());\n  private localMatrix: mat4 = mat4.create();\n\n  private position: vec3 = vec3.create();\n  private scale: vec3 = vec3.fromValues(1, 1, 1);\n  private rotation: quat = quat.identity(quat.create());\n  private matrix: mat4 = mat4.create();\n\n  getLocalPosition3(out: vec3) {\n    return vec3.copy(out, this.getLocalPosition());\n  }\n  getLocalPosition2(out: vec2) {\n    const localPosition = this.getLocalPosition();\n    out[0] = localPosition[0];\n    out[1] = localPosition[1];\n    return out;\n  }\n\n  setLocalPosition2(localPosition: vec2) {\n    return this.setLocalPosition(\n      vec3.set(\n        VEC3_0,\n        localPosition[0],\n        localPosition[1],\n        this.localPosition[2]\n      )\n    );\n  }\n  setLocalPosition3(localPosition: vec3) {\n    return this.setLocalPosition(localPosition);\n  }\n\n  getPosition3(out: vec3) {\n    return vec3.copy(out, this.getPosition());\n  }\n  getPosition2(out: vec2) {\n    const position = this.getPosition();\n    out[0] = position[0];\n    out[1] = position[1];\n    return out;\n  }\n\n  getLocalRotationQuat(out: quat) {\n    return quat.copy(out, this.localRotation);\n  }\n  getLocalRotationZ() {\n    return quat.getAxisAngle(VEC3_UP, this.localRotation);\n  }\n\n  setLocalRotationZ(localRotation: number) {\n    const localRotationQuat = quat.copy(QUAT_0, this.getLocalRotation());\n    quat.rotateZ(localRotationQuat, localRotationQuat, localRotation);\n    return this.setLocalRotation(localRotationQuat);\n  }\n  setLocalRotationQuat(localRotation: quat) {\n    return this.setLocalRotation(localRotation);\n  }\n\n  getRotationQuat(out: quat) {\n    return quat.copy(out, this.getRotation());\n  }\n  getRotationZ() {\n    return quat.getAxisAngle(VEC3_UP, this.getRotation());\n  }\n\n  getLocalScale3(out: vec3) {\n    return vec3.copy(out, this.getLocalScale());\n  }\n  getLocalScale2(out: vec2) {\n    const localScale = this.getLocalScale();\n    out[0] = localScale[0];\n    out[1] = localScale[1];\n    return out;\n  }\n\n  setLocalScale2(localScale: vec2) {\n    return this.setLocalScale(\n      vec3.set(VEC3_0, localScale[0], localScale[1], this.localScale[2])\n    );\n  }\n  setLocalScale3(localScale: vec3) {\n    return this.setLocalScale(localScale);\n  }\n\n  getScale3(out: vec3) {\n    return vec3.copy(out, this.getScale());\n  }\n  getScale2(out: vec2) {\n    const scale = this.getScale();\n    out[0] = scale[0];\n    out[1] = scale[1];\n    return out;\n  }\n\n  setLocalPosition(localPosition: vec3) {\n    vec3.copy(this.localPosition, localPosition);\n    return this.setNeedsUpdate();\n  }\n  getPosition() {\n    return this.updateMatrixIfNeeded().position;\n  }\n  getLocalPosition() {\n    return this.localPosition;\n  }\n\n  setLocalScale(localScale: vec3) {\n    vec3.copy(this.localScale, localScale);\n    return this.setNeedsUpdate();\n  }\n  getScale() {\n    return this.updateMatrixIfNeeded().scale;\n  }\n  getLocalScale() {\n    return this.localScale;\n  }\n\n  setLocalRotation(localRotation: quat) {\n    quat.copy(this.localRotation, localRotation);\n    return this.setNeedsUpdate();\n  }\n  getRotation() {\n    return this.updateMatrixIfNeeded().rotation;\n  }\n  getLocalRotation() {\n    return this.localRotation;\n  }\n\n  getMatrix() {\n    return this.updateMatrixIfNeeded().matrix;\n  }\n  getLocalMatrix() {\n    return this.updateLocalMatrixIfNeeded().localMatrix;\n  }\n\n  updateLocalMatrix() {\n    mat4.fromRotationTranslationScale(\n      this.localMatrix,\n      this.localRotation,\n      this.localPosition,\n      this.localScale\n    );\n\n    return this;\n  }\n\n  updateMatrix() {\n    this.updateLocalMatrixIfNeeded()\n      .getParentTransform()\n      .mapOrElse(\n        (parentTransform) => {\n          mat4.mul(\n            this.matrix,\n            parentTransform.getMatrix4(MAT4_0),\n            this.localMatrix\n          );\n          mat4.getRotation(this.rotation, this.matrix);\n          mat4.getScaling(this.scale, this.matrix);\n          mat4.getTranslation(this.position, this.matrix);\n        },\n        () => {\n          mat4.copy(this.matrix, this.localMatrix);\n          vec3.copy(this.position, this.localPosition);\n          vec3.copy(this.scale, this.localScale);\n          quat.copy(this.rotation, this.localRotation);\n        }\n      );\n\n    return this;\n  }\n\n  getMatrix4(out: mat4) {\n    return mat4.copy(out, this.getMatrix());\n  }\n  getMatrix2d(out: mat2d) {\n    return mat2dFromMat4(out, this.getMatrix());\n  }\n\n  getLocalMatrix4(out: mat4) {\n    return mat4.copy(out, this.getLocalMatrix());\n  }\n  getLocalMatrix2d(out: mat2d) {\n    return mat2dFromMat4(out, this.getLocalMatrix());\n  }\n\n  toLocalPosition(out: vec3, position: vec3) {\n    return vec3.sub(out, position, this.getPosition());\n  }\n\n  lookAt(position: vec3, up: vec3 = VEC3_UP) {\n    mat4.getRotation(\n      this.localRotation,\n      mat4.targetTo(\n        MAT4_0,\n        this.localPosition,\n        this.toLocalPosition(VEC3_0, position),\n        up\n      )\n    );\n    return this.setNeedsUpdate();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      localPosition: this.localPosition as IJSONArray,\n      localScale: this.localScale as IJSONArray,\n      localRotation: this.localRotation as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .setLocalPosition(json.localPosition as vec3)\n      .setLocalScale(json.localScale as vec3)\n      .setLocalRotation(json.localRotation as quat);\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Camera2D } from \"./Camera2D\";\n\nexport class Camera2DManager extends DefaultDescriptorManager<Camera2D> {\n  private active: Option<Camera2D> = none();\n\n  setActive(camera: Camera2D) {\n    if (\n      camera\n        .getManager()\n        .map((manager) => manager === this)\n        .unwrapOr(false)\n    ) {\n      this.active.replace(camera);\n    } else {\n      throw new Error(\n        \"Camera2DManager.setActive(camera: Camera2D): cannot set active if camera is not in manager\"\n      );\n    }\n    return this;\n  }\n  getActive() {\n    return this.active;\n  }\n  getRequiredActive() {\n    return this.getActive().expect(`Expected an Active Camera`);\n  }\n\n  addComponent(camera: Camera2D) {\n    super.addComponent(camera);\n\n    if (this.active.isNone()) {\n      this.active.replace(camera);\n    }\n\n    return this;\n  }\n\n  removeComponent(camera: Camera2D) {\n    super.removeComponent(camera);\n\n    this.active.ifSome((active) => {\n      if (active === camera) {\n        this.active.clear();\n      }\n    });\n\n    return this;\n  }\n}\n","import { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { mat2d, vec2, vec4 } from \"gl-matrix\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { extractScale } from \"../../math\";\nimport type { IJSONArray, IJSONObject } from \"@aicacia/json\";\nimport { Camera2DManager } from \"./Camera2DManager\";\nimport { AABB2 } from \"../../math/AABB2\";\n\nconst MAT2D_0 = mat2d.create(),\n  VEC2_0 = vec2.create(),\n  POINTS = [vec2.create(), vec2.create(), vec2.create(), vec2.create()];\n\nexport class Camera2D extends RenderableComponent {\n  static Manager = Camera2DManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n\n  private width = 1.0;\n  private height = 1.0;\n  private aspect = 1.0;\n\n  private size = 1;\n  private minSize = Number.EPSILON;\n  private maxSize = Infinity;\n\n  private projection = mat2d.identity(mat2d.create());\n  private view = mat2d.identity(mat2d.create());\n\n  private needsUpdate = true;\n  private background: vec4 = vec4.create();\n\n  getBackground() {\n    return this.background;\n  }\n  setBackground(background: vec4) {\n    vec4.copy(this.background, background);\n    return this;\n  }\n\n  set(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = width;\n      this.height = height;\n      this.aspect = width / height;\n      return this.setNeedsUpdate();\n    } else {\n      return this;\n    }\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n  getAspect() {\n    return this.aspect;\n  }\n\n  getSize() {\n    return this.size;\n  }\n  setSize(size: number) {\n    this.size =\n      size < this.minSize\n        ? this.minSize\n        : size > this.maxSize\n        ? this.maxSize\n        : size;\n    return this.setNeedsUpdate();\n  }\n  getMinSize() {\n    return this.minSize;\n  }\n  setMinSize(minSize: number) {\n    this.minSize = minSize;\n    return this.setNeedsUpdate();\n  }\n  getMaxSize() {\n    return this.minSize;\n  }\n  setMaxSize(maxSize: number) {\n    this.maxSize = maxSize;\n    return this.setNeedsUpdate();\n  }\n\n  setZoom(zoom: number) {\n    this.getEntity()\n      .flatMap(TransformComponent.getTransform)\n      .ifSome((transform) =>\n        transform.setLocalScale2(vec2.set(VEC2_0, zoom, zoom))\n      );\n    return this;\n  }\n  getZoom() {\n    return this.getEntity()\n      .flatMap(TransformComponent.getTransform)\n      .map(\n        (transform) =>\n          vec2.len(extractScale(VEC2_0, transform.getMatrix2d(MAT2D_0))) *\n          this.size\n      )\n      .unwrapOr(this.size);\n  }\n\n  getView() {\n    this.getEntity()\n      .flatMap(TransformComponent.getTransform)\n      .ifSome((transform) =>\n        mat2d.invert(this.view, transform.getMatrix2d(MAT2D_0))\n      );\n    return this.view;\n  }\n\n  getProjection() {\n    return this.updateProjectionIfNeeded().projection;\n  }\n\n  getAABB2(out: AABB2): AABB2 {\n    const matrix = MAT2D_0,\n      points = POINTS;\n\n    AABB2.identity(out);\n\n    vec2.set(points[0], 0, 0);\n    vec2.set(points[1], this.width, 0);\n    vec2.set(points[2], this.width, this.height);\n    vec2.set(points[3], 0, this.height);\n\n    mat2d.mul(matrix, this.projection, this.view);\n    mat2d.invert(matrix, matrix);\n\n    for (const point of points) {\n      point[0] = 2.0 * (point[0] / this.width) - 1.0;\n      point[1] = -2.0 * (point[1] / this.height) + 1.0;\n      vec2.transformMat2d(point, point, matrix);\n      AABB2.expandPoint(out, out, point);\n    }\n\n    return out;\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.needsUpdate = needsUpdate;\n    return this;\n  }\n\n  updateProjectionIfNeeded() {\n    if (this.needsUpdate) {\n      return this.updateProjection();\n    } else {\n      return this;\n    }\n  }\n\n  isActive(): boolean {\n    return this.getRequiredManager<Camera2DManager>()\n      .getActive()\n      .map((active) => active === this)\n      .unwrapOr(false);\n  }\n  setActive() {\n    this.getRequiredManager<Camera2DManager>().setActive(this);\n    return this;\n  }\n  updateProjection() {\n    const size = this.getSize(),\n      right = size * this.aspect,\n      left = -right,\n      top = size,\n      bottom = -top,\n      width = right - left,\n      height = top - bottom,\n      x = (right + left) / width,\n      y = (top + bottom) / height;\n\n    mat2d.set(this.projection, 2 / width, 0.0, 0.0, 2 / height, -x, -y);\n    this.needsUpdate = false;\n\n    return this;\n  }\n\n  toRelative(out: vec2, screen: vec2) {\n    this.toWorld(out, screen);\n    vec2.transformMat2d(out, out, this.view);\n    return out;\n  }\n\n  toWorld(out: vec2, screen: vec2) {\n    const mat = MAT2D_0;\n\n    out[0] = 2.0 * (screen[0] / this.width) - 1.0;\n    out[1] = -2.0 * (screen[1] / this.height) + 1.0;\n\n    mat2d.mul(mat, this.projection, this.view);\n    mat2d.invert(mat, mat);\n    vec2.transformMat2d(out, out, mat);\n\n    return out;\n  }\n\n  toScreen(out: vec2, world: vec2) {\n    const mat = mat2d.mul(MAT2D_0, this.projection, this.view);\n\n    vec2.transformMat2d(out, world, mat);\n\n    out[0] = (out[0] + 1.0) * 0.5 * this.width;\n    out[1] = (1.0 - out[1]) * 0.5 * this.height;\n\n    return out;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      width: this.width,\n      height: this.height,\n      background: this.background as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .set(json.width as number, json.height as number)\n      .setBackground(json.background as vec4);\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport { v4 } from \"uuid\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\n\n// tslint:disable-next-line: interface-name\nexport interface Asset {\n  on(event: \"load\" | \"unload\", listener: () => void): this;\n  on(\n    event: \"load-error\" | \"unload-error\",\n    listener: (error: Error) => void\n  ): this;\n}\n\nexport abstract class Asset extends ToFromJSONEventEmitter {\n  private uuid = v4();\n  private name = \"\";\n  private loaded = false;\n  private loading = false;\n\n  getUUID() {\n    return this.uuid;\n  }\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name = name;\n    return this;\n  }\n  isLoaded() {\n    return this.loaded;\n  }\n  isLoading() {\n    return this.loading;\n  }\n\n  load() {\n    if (this.loaded) {\n      return Promise.resolve();\n    } else {\n      this.loading = true;\n      return this.loadAsset()\n        .then(() => {\n          this.loading = false;\n          this.loaded = true;\n          this.emit(\"load\");\n        })\n        .catch((error) => {\n          this.loading = true;\n          this.emit(\"load-error\", error);\n          throw error;\n        });\n    }\n  }\n\n  unload() {\n    if (!this.loaded) {\n      return Promise.resolve();\n    } else {\n      return this.unloadAsset()\n        .then(() => {\n          this.loaded = false;\n          this.emit(\"unload\");\n        })\n        .catch((error) => {\n          this.emit(\"unload-error\", error);\n          throw error;\n        });\n    }\n  }\n\n  protected abstract loadAsset(): Promise<void>;\n  protected abstract unloadAsset(): Promise<void>;\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      uuid: this.uuid,\n      name: this.name,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.uuid = json.uuid as string;\n    this.name = json.name as string;\n    return this;\n  }\n}\n","import type { IConstructor } from \"@aicacia/core\";\n\nexport type IRequirement<T> = IConstructor<T> | Array<IConstructor<T>>;\n\nexport function filterRequirements<T>(\n  requirements: IRequirement<T>[],\n  filter: (value: IConstructor<T>) => boolean\n): IRequirement<T>[] {\n  return requirements.reduce((missing, requirement) => {\n    if (Array.isArray(requirement)) {\n      if (!requirement.some(filter)) {\n        missing.push(requirement);\n      }\n    } else {\n      if (filter(requirement)) {\n        missing.push(requirement);\n      }\n    }\n    return missing;\n  }, [] as IRequirement<T>[]);\n}\n\nexport function requirementToString<T>(requirement: IRequirement<T>): string {\n  if (Array.isArray(requirement)) {\n    return `one of ${requirement.map(requirementToString).join(\", \")}`;\n  } else {\n    return requirement.name || (requirement as any).typeId || \"UnknownClass\";\n  }\n}\n","import { none, Option, IConstructor } from \"@aicacia/core\";\nimport {\n  IRequirement,\n  filterRequirements,\n  requirementToString,\n} from \"./IRequirement\";\nimport type { Manager } from \"./Manager\";\nimport type { Scene } from \"./Scene\";\nimport type { ValidEventTypes } from \"eventemitter3\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport abstract class Plugin<\n  EventTypes extends ValidEventTypes = any\n> extends ToFromJSONEventEmitter<EventTypes> {\n  static pluginPriority = 0;\n  static requiredPlugins: IRequirement<Plugin>[] = [];\n\n  static getPluginPriority() {\n    return this.pluginPriority;\n  }\n  static getRequiredPlugins(): IRequirement<Plugin>[] {\n    return this.requiredPlugins;\n  }\n\n  private scene: Option<Scene> = none();\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getPluginPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getPluginPriority();\n  }\n  getRequiredPlugins(): IConstructor<Plugin>[] {\n    return Object.getPrototypeOf(this).constructor.requiredPlugins;\n  }\n\n  getPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>): Option<P> {\n    return this.getScene().flatMap((scene) => scene.getPlugin(Plugin));\n  }\n  getRequiredPlugin<P extends Plugin = Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin).expect(\n      () => `${this.getConstructor()} required ${Plugin} Plugin`\n    );\n  }\n\n  getManager<M extends Manager = Manager>(Manager: IConstructor<M>): Option<M> {\n    return this.getScene().flatMap((scene) => scene.getManager(Manager));\n  }\n  getRequiredManager<M extends Manager = Manager>(Manager: IConstructor<M>) {\n    return this.getManager(Manager).expect(\n      () => `${this.getConstructor()} required ${Manager} Manager`\n    );\n  }\n\n  validateRequirements() {\n    const missingPlugins: IRequirement<Plugin>[] = [];\n\n    for (const plugin of this.getRequiredScene().getPlugins()) {\n      const missingRequiredPlugins = filterRequirements(\n        plugin.getRequiredPlugins(),\n        (P) => !this.getRequiredScene().hasPlugin(P)\n      );\n\n      if (missingRequiredPlugins.length > 0) {\n        missingPlugins.push(...missingRequiredPlugins);\n      }\n    }\n\n    if (missingPlugins.length > 0) {\n      const pluginMessage = missingPlugins\n        .map(\n          (missingRequirement) =>\n            `${requirementToString(\n              this.getConstructor()\n            )} Plugin requires ${requirementToString(\n              missingRequirement\n            )} Plugin`\n        )\n        .join(\"\\n\");\n\n      throw new Error(pluginMessage);\n    }\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene) {\n    this.scene.replace(scene);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene.clear();\n    return this;\n  }\n  getScene() {\n    return this.scene;\n  }\n  getRequiredScene() {\n    return this.getScene().expect(\n      () => `${this.getConstructor()} required a Scene`\n    );\n  }\n\n  onInit() {\n    return this;\n  }\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n  onUpdate() {\n    return this;\n  }\n}\n","import { Option, iter } from \"@aicacia/core\";\nimport { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { Plugin } from \"../../Plugin\";\nimport { Asset } from \"./Asset\";\n\nexport class Assets extends Plugin {\n  private assetMap: Record<string, Asset> = {};\n  private assets: Asset[] = [];\n  private loadedAssets: Asset[] = [];\n  private loadingPromises: Map<Asset, Promise<void>> = new Map();\n  private unloadingPromises: Map<Asset, Promise<void>> = new Map();\n\n  find(fn: (asset: Asset) => boolean): Option<Asset> {\n    return iter(this.assets).find(fn);\n  }\n  findWithName(name: string) {\n    return this.find((asset) => asset.getName() === name);\n  }\n\n  findAll(fn: (asset: Asset) => boolean): Asset[] {\n    return iter(this.assets).filter(fn).toArray();\n  }\n  findAllWithName(name: string) {\n    return this.findAll((asset) => asset.getName() === name);\n  }\n\n  isLoading() {\n    return this.loadingPromises.size > 0;\n  }\n\n  getAsset<T extends Asset = Asset>(uuid: string): Option<T> {\n    return Option.from(this.assetMap[uuid]) as Option<T>;\n  }\n  getAssets(): readonly Asset[] {\n    return this.assets;\n  }\n\n  getLoadedAssets(): readonly Asset[] {\n    return this.loadedAssets;\n  }\n  getLoadingAssets() {\n    return Array.from(this.loadingPromises.keys());\n  }\n\n  getUnloadingAssets() {\n    return Array.from(this.unloadingPromises.keys());\n  }\n  getUnloadedAssets(): readonly Asset[] {\n    return this.assets.filter((asset) => !asset.isLoaded());\n  }\n\n  addAsset(...assets: Asset[]) {\n    return this.addAssets(assets);\n  }\n  addAssets(assets: Asset[]) {\n    for (const asset of assets) {\n      this._addAsset(asset);\n    }\n    return this;\n  }\n\n  removeAsset(...assets: Asset[]) {\n    return this.removeAssets(assets);\n  }\n  removeAssets(assets: Asset[]) {\n    for (const asset of assets) {\n      this._removeAsset(asset);\n    }\n    return this;\n  }\n\n  loadAll() {\n    return this.loadAssets(this.getUnloadedAssets());\n  }\n  loadAllInBackground() {\n    return this.loadAssetsInBackground(this.getUnloadedAssets());\n  }\n\n  loadAssetInBackground(...assets: readonly Asset[]) {\n    return this.loadAssetsInBackground(assets);\n  }\n  loadAssetsInBackground(assets: readonly Asset[]) {\n    this.loadAssets(assets);\n    return this;\n  }\n\n  unloadAssetInBackground(...assets: readonly Asset[]) {\n    return this.unloadAssetsInBackground(assets);\n  }\n  unloadAssetsInBackground(assets: readonly Asset[]) {\n    this.unloadAssets(assets);\n    return this;\n  }\n\n  loadAsset(...assets: readonly Asset[]) {\n    return this.loadAssets(assets);\n  }\n  loadAssets(assets: readonly Asset[]) {\n    return Promise.all(assets.map((asset) => this._loadAsset(asset)));\n  }\n\n  unloadAsset(...assets: readonly Asset[]) {\n    return this.unloadAssets(assets);\n  }\n  unloadAssets(assets: readonly Asset[]) {\n    return Promise.all(assets.map((asset) => this._unloadAsset(asset)));\n  }\n\n  private _loadAsset(asset: Asset): Promise<void> {\n    if (asset.isLoaded()) {\n      return Promise.resolve();\n    } else {\n      const promise = this.loadingPromises.get(asset);\n\n      if (promise) {\n        return promise;\n      } else {\n        const promise = asset\n          .load()\n          .then(() => {\n            this.loadingPromises.delete(asset);\n            this.loadedAssets.push(asset);\n          })\n          .catch((error) => {\n            this.loadingPromises.delete(asset);\n            throw error;\n          });\n\n        this.loadingPromises.set(asset, promise);\n\n        return promise;\n      }\n    }\n  }\n\n  private _unloadAsset(asset: Asset): Promise<void> {\n    if (!asset.isLoaded()) {\n      return Promise.resolve();\n    } else {\n      const promise = this.unloadingPromises.get(asset);\n\n      if (promise) {\n        return promise;\n      } else {\n        const promise = asset\n          .load()\n          .then(() => {\n            this.unloadingPromises.delete(asset);\n            this.loadedAssets.splice(this.loadedAssets.indexOf(asset), 1);\n          })\n          .catch((error) => {\n            this.unloadingPromises.delete(asset);\n            throw error;\n          });\n\n        this.unloadingPromises.set(asset, promise);\n\n        return promise;\n      }\n    }\n  }\n\n  private _addAsset(asset: Asset) {\n    const uuid = asset.getUUID();\n\n    if (!this.assetMap[uuid]) {\n      this.assetMap[uuid] = asset;\n      this.assets.push(asset);\n    }\n    return this;\n  }\n\n  private _removeAsset(asset: Asset) {\n    const uuid = asset.getUUID();\n\n    if (this.assetMap[uuid]) {\n      delete this.assetMap[uuid];\n      this.assets.splice(this.assets.indexOf(asset), 1);\n    }\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      assets: this.assets.map((asset) => asset.toJSON()),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.assets)) {\n      this.addAssets(\n        json.assets.map((json) => Asset.newFromJSON(json as IJSONObject))\n      );\n    }\n    return this;\n  }\n}\n","import { none } from \"@aicacia/core\";\nimport type { Option } from \"@aicacia/core\";\nimport type { IJSON, IJSONObject } from \"@aicacia/json\";\nimport { Asset } from \"./Asset\";\n\nexport class JSONAsset extends Asset {\n  private json: Option<IJSON> = none();\n  private src: RequestInfo;\n  private options?: RequestInit;\n\n  constructor(src: RequestInfo, options?: RequestInit) {\n    super();\n    this.src = src;\n    this.options = options;\n  }\n\n  getJSON() {\n    return this.json;\n  }\n\n  protected loadAsset() {\n    return fetch(this.src, this.options)\n      .then((response) => response.json())\n      .then((json) => {\n        this.json.replace(json);\n      });\n  }\n\n  protected unloadAsset() {\n    this.json.clear();\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      src: this.src,\n      options: this.options,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.src = json.src as RequestInfo;\n    this.options = json.options as RequestInit;\n    return this;\n  }\n}\n","import type { IJSON, IJSONObject } from \"@aicacia/json\";\nimport { Asset } from \"./Asset\";\n\nexport class RawJSONAsset extends Asset {\n  private json: IJSON;\n\n  constructor(json: IJSON) {\n    super();\n    this.json = json;\n  }\n\n  getJSON() {\n    return this.json;\n  }\n\n  protected loadAsset() {\n    return Promise.resolve();\n  }\n\n  protected unloadAsset() {\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      json: this.json,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.json = json.json as IJSON;\n    return this;\n  }\n}\n","import { Asset } from \"./Asset\";\n\nexport abstract class ImageAsset extends Asset {\n  abstract getWidth(): number;\n  abstract getHeight(): number;\n}\n","import { none } from \"@aicacia/core\";\nimport type { Option, IConstructor } from \"@aicacia/core\";\nimport type { Plugin } from \"../../Plugin\";\nimport type { Manager } from \"../../Manager\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\nimport type { Renderer } from \"./Renderer\";\nimport type { IJSONObject } from \"@aicacia/json\";\n\nexport abstract class RendererHandler<\n  R extends Renderer = Renderer\n> extends ToFromJSONEventEmitter {\n  static rendererHandlerPriority: number;\n\n  static getRendererHandlerPriority() {\n    return this.rendererHandlerPriority;\n  }\n\n  private renderer: Option<R> = none();\n  private enabled = true;\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n  getRendererHandlerPriority(): number {\n    return Object.getPrototypeOf(this).constructor.getRendererHandlerPriority();\n  }\n\n  UNSAFE_setRenderer(renderer: R) {\n    this.renderer.replace(renderer);\n    return this;\n  }\n  UNSAFE_removeRenderer() {\n    this.renderer.clear();\n    return this;\n  }\n  getRenderer() {\n    return this.renderer;\n  }\n  getRequiredRenderer() {\n    return this.renderer.expect(\n      `${this.getConstructor()} expected to be added to a Renderer first`\n    );\n  }\n\n  getScene() {\n    return this.getRenderer().flatMap((renderer) => renderer.getScene());\n  }\n  getRequiredScene() {\n    return this.getScene().expect(`${this.getConstructor()} required scene`);\n  }\n\n  getManager<M extends Manager>(Manager: IConstructor<M>) {\n    return this.getScene().flatMap((scene) => scene.getManager(Manager));\n  }\n  getRequiredManager<M extends Manager>(Manager: IConstructor<M>) {\n    return this.getManager(Manager).expect(\n      `${this.getConstructor()} required ${Manager} Manager`\n    );\n  }\n\n  getPlugin<P extends Plugin>(Plugin: new (...args: any[]) => P) {\n    return this.getScene().flatMap((scene) => scene.getPlugin(Plugin));\n  }\n  getRequiredPlugin<P extends Plugin>(Plugin: new (...args: any[]) => P) {\n    return this.getPlugin(Plugin).expect(\n      `${this.getConstructor()} required ${Plugin} Plugin`\n    );\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onBeforeRender() {\n    return this;\n  }\n  onRender() {\n    return this;\n  }\n  onAfterRender() {\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      enabled: this.enabled,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.enabled = json.enabled as boolean;\n    return this;\n  }\n}\n","import { Option, IConstructor } from \"@aicacia/core\";\nimport { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { Plugin } from \"../../Plugin\";\n\nexport abstract class Renderer extends Plugin {\n  static pluginPriority = Infinity;\n\n  private rendererHandlers: RendererHandler[] = [];\n  private rendererHandlerMap: Map<\n    IConstructor<RendererHandler>,\n    RendererHandler\n  > = new Map();\n\n  getRendererHandlers(): readonly RendererHandler[] {\n    return this.rendererHandlers;\n  }\n  getRendererHandler<R extends RendererHandler>(\n    RendererHandler: IConstructor<R>\n  ) {\n    return Option.from(this.rendererHandlerMap.get(RendererHandler));\n  }\n\n  addRendererHandlers(rendererHandlers: RendererHandler[]) {\n    for (const rendererHandler of rendererHandlers) {\n      this._addRendererHandler(rendererHandler);\n    }\n    return this.sortRendererHandlers();\n  }\n  addRendererHandler(...rendererHandlers: RendererHandler[]) {\n    return this.addRendererHandlers(rendererHandlers);\n  }\n\n  removeRendererHandlers(RendererHandlers: IConstructor<RendererHandler>[]) {\n    for (const RendererHandler of RendererHandlers) {\n      this._removeRendererHandler(RendererHandler);\n    }\n    return this.sortRendererHandlers();\n  }\n  removeRendererHandler(...rendererHandlers: IConstructor<RendererHandler>[]) {\n    return this.removeRendererHandlers(rendererHandlers);\n  }\n\n  onUpdate() {\n    for (const rendererHandler of this.rendererHandlers) {\n      if (rendererHandler.getEnabled()) {\n        rendererHandler.onBeforeRender();\n        rendererHandler.onRender();\n      }\n    }\n    return this;\n  }\n  onAfterUpdate() {\n    for (const rendererHandler of this.rendererHandlers) {\n      if (rendererHandler.getEnabled()) {\n        rendererHandler.onAfterRender();\n      }\n    }\n    return this;\n  }\n\n  private _addRendererHandler<R extends RendererHandler = RendererHandler>(\n    rendererHandler: R\n  ) {\n    const RendererHandler = rendererHandler.getConstructor();\n\n    if (!this.rendererHandlerMap.has(RendererHandler)) {\n      this.rendererHandlers.push(rendererHandler);\n      this.rendererHandlerMap.set(RendererHandler, rendererHandler);\n      rendererHandler.UNSAFE_setRenderer(this);\n      rendererHandler.onAdd();\n      this.emit(\"add-renderer_handler\", rendererHandler);\n    }\n\n    return this;\n  }\n  private _removeRendererHandler<R extends RendererHandler = RendererHandler>(\n    RendererHandler: IConstructor<R>\n  ) {\n    this.getRendererHandler(RendererHandler).ifSome((rendererHandler) => {\n      this.emit(\"remove-renderer_handler\", rendererHandler);\n      rendererHandler.onRemove();\n\n      this.rendererHandlers.splice(\n        this.rendererHandlers.indexOf(rendererHandler),\n        1\n      );\n      this.rendererHandlerMap.delete(RendererHandler);\n      rendererHandler.UNSAFE_removeRenderer();\n    });\n\n    return this;\n  }\n\n  private sortRendererHandlers() {\n    this.rendererHandlers.sort(this.sortRendererHandlersFunction);\n    return this;\n  }\n  private sortRendererHandlersFunction = (\n    a: RendererHandler,\n    b: RendererHandler\n  ) => {\n    return a.getRendererHandlerPriority() - b.getRendererHandlerPriority();\n  };\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      rendererHandlers: this.rendererHandlers.map((rendererHandler) =>\n        rendererHandler.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.rendererHandlers)) {\n      this.addRendererHandlers(\n        json.rendererHandlers.map((json) =>\n          RendererHandler.newFromJSON(json as IJSONObject)\n        )\n      );\n    }\n    return this;\n  }\n}\n\nimport { RendererHandler } from \"./RendererHandler\";\n","import type { IJSONObject } from \"@aicacia/json\";\nimport { Plugin } from \"../Plugin\";\n\nexport class Time extends Plugin {\n  static pluginPriority = -Infinity;\n\n  private scale = 1.0;\n\n  private fixedDelta: number = 1.0 / 60.0;\n\n  private frame = 0;\n  private last: number = -(1.0 / 60.0);\n  private current = 0.0;\n  private delta: number = 1.0 / 60.0;\n  private fps = 60.0;\n  private fpsFrame = 0;\n  private fpsLast = 0;\n\n  private startTime: number = Date.now() * 0.001;\n  private minDelta = 0.000001;\n  private maxDelta = Infinity;\n\n  getStartTime() {\n    return this.startTime;\n  }\n\n  getDelta() {\n    return this.delta * this.scale;\n  }\n  getRealDelta() {\n    return this.delta * this.scale;\n  }\n\n  getCurrent() {\n    return this.current;\n  }\n\n  getMinDelta() {\n    return this.minDelta;\n  }\n  setMinDelta(minDelta: number) {\n    this.minDelta = minDelta;\n    return this;\n  }\n\n  getMaxDelta() {\n    return this.maxDelta;\n  }\n  setMaxDelta(maxDelta: number) {\n    this.maxDelta = maxDelta;\n    return this;\n  }\n\n  getFrame() {\n    return this.frame;\n  }\n  getFps() {\n    return this.fps;\n  }\n\n  getScale() {\n    return this.scale;\n  }\n  setScale(scale: number) {\n    this.scale = scale;\n    return this;\n  }\n\n  getFixedDelta() {\n    return this.fixedDelta * this.scale;\n  }\n  setFixedDelta(fixedDelta: number) {\n    this.fixedDelta = fixedDelta;\n    return this;\n  }\n\n  now() {\n    return Date.now() * 0.001 - this.startTime;\n  }\n\n  onUpdate() {\n    ++this.frame;\n\n    this.last = this.current;\n    this.current = this.now();\n\n    this.fpsFrame++;\n    if (this.fpsLast + 1 < this.current) {\n      this.fps = this.fpsFrame / (this.current - this.fpsLast);\n\n      this.fpsLast = this.current;\n      this.fpsFrame = 0;\n    }\n\n    this.delta = (this.current - this.last) * this.scale;\n    this.delta =\n      this.delta < this.minDelta\n        ? this.minDelta\n        : this.delta > this.maxDelta\n        ? this.maxDelta\n        : this.delta;\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      frame: this.frame,\n      scale: this.scale,\n      fixedDelta: this.fixedDelta,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.frame = json.frame as number;\n    this.scale = json.scale as number;\n    this.fixedDelta = json.fixedDelta as number;\n    return this;\n  }\n}\n","import { Plugin } from \"../Plugin\";\nimport type { IRunOnUpdateFn } from \"../IRunOnUpdateFn\";\n\nexport abstract class RunOnUpdatePlugin extends Plugin {\n  private queue: IRunOnUpdateFn<this>[] = [];\n  private swap: IRunOnUpdateFn<this>[] = [];\n\n  runOnUpdate(...fns: IRunOnUpdateFn<this>[]) {\n    this.queue.push(...fns);\n    return this;\n  }\n\n  onUpdate() {\n    if (this.queue.length > 0) {\n      const queue = this.queue;\n\n      this.queue = this.swap;\n      this.swap = queue;\n\n      for (const fn of queue) {\n        fn.call(this);\n      }\n      this.swap.length = 0;\n    }\n    return this;\n  }\n}\n","import { none, Option, IConstructor } from \"@aicacia/core\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\nimport type { Time } from \"../Time\";\nimport type { Input } from \"./Input\";\nimport type { InputEvent } from \"./InputEvent\";\n\nexport abstract class EventListener<\n  I extends Input = Input\n> extends ToFromJSONEventEmitter {\n  private input: Option<I> = none();\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setInput(input: I) {\n    this.input.replace(input);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeInput() {\n    this.input.clear();\n    return this;\n  }\n  getInput() {\n    return this.input as Option<I>;\n  }\n  getRequiredInput() {\n    return this.getInput().expect(\n      `${this.getConstructor()} requires a Input Plugin`\n    );\n  }\n  getScene() {\n    return this.getInput().flatMap((input) => input.getScene());\n  }\n  getRequiredScene() {\n    return this.getScene().expect(`${this.getConstructor()} requires a Scene`);\n  }\n\n  queueEvent(event: InputEvent) {\n    return this.getInput().map((input) => input.queueEvent(event));\n  }\n  abstract dequeueEvent(event: InputEvent): boolean;\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate(_time: Time) {\n    return this;\n  }\n  onAfterUpdate(_time: Time) {\n    return this;\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\nimport type { Time } from \"../Time\";\n\nexport class InputAxis {\n  private name: string;\n\n  private negButton: string;\n  private posButton: string;\n\n  private gravity = 3;\n  private sensitivity = 3;\n\n  private dead = 0.001;\n\n  private value = 0.0;\n\n  constructor(name: string, negButton: string, posButton: string) {\n    this.name = name;\n    this.negButton = negButton;\n    this.posButton = posButton;\n  }\n\n  getName() {\n    return this.name;\n  }\n\n  getNegButton() {\n    return this.negButton;\n  }\n  setNegButton(negButton: string) {\n    this.negButton = negButton;\n    return this;\n  }\n  getPosButton() {\n    return this.posButton;\n  }\n  setPosButton(posButton: string) {\n    this.posButton = posButton;\n    return this;\n  }\n\n  getGravity() {\n    return this.gravity;\n  }\n  setGravity(gravity: number) {\n    this.gravity = gravity;\n    return this;\n  }\n  getSensitivity() {\n    return this.sensitivity;\n  }\n  setSensitivity(sensitivity: number) {\n    this.sensitivity = sensitivity;\n    return this;\n  }\n\n  getDead() {\n    return this.dead;\n  }\n  setDead(dead: number) {\n    this.dead = dead;\n    return this;\n  }\n\n  getValue() {\n    return this.value;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setValue(value: number) {\n    this.value = value;\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_update(time: Time, value: number, isNeg: boolean, isPos: boolean) {\n    const delta = time.getDelta();\n\n    if (isNeg) {\n      value -= this.getSensitivity() * delta;\n    }\n    if (isPos) {\n      value += this.getSensitivity() * delta;\n    }\n\n    if (!isPos && !isNeg && value !== 0.0) {\n      value -= (value >= 0 ? 1 : -1) * this.getGravity() * delta;\n    }\n\n    value = value >= 1.0 ? 1.0 : value <= -1.0 ? -1.0 : value;\n\n    if (Math.abs(value) <= this.getDead()) {\n      value = 0.0;\n    }\n\n    this.value = value;\n  }\n\n  toJSON() {\n    return {\n      name: this.name,\n      negButton: this.negButton,\n      posButton: this.posButton,\n      gravity: this.gravity,\n      sensitivity: this.sensitivity,\n      dead: this.dead,\n      value: this.value,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    this.name = json.name as string;\n    this.negButton = json.negButton as string;\n    this.posButton = json.posButton as string;\n    this.gravity = json.gravity as number;\n    this.sensitivity = json.sensitivity as number;\n    this.dead = json.dead as number;\n    this.value = json.value as number;\n    return this;\n  }\n}\n","import type { IJSONObject } from \"@aicacia/json\";\n\nexport class InputButton {\n  private name: string;\n  private value = 0.0;\n  private frameDown = 0;\n  private frameUp = 0;\n\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  getName() {\n    return this.name;\n  }\n\n  getFrameDown() {\n    return this.frameDown;\n  }\n  getFrameUp() {\n    return this.frameUp;\n  }\n\n  getValue() {\n    return this.value;\n  }\n  UNSAFE_setValue(value: number) {\n    this.value = value;\n    return this;\n  }\n\n  UNSAFE_up(frame: number) {\n    if (this.value === 1.0) {\n      this.frameUp = frame;\n    }\n    this.value = 0.0;\n    return this;\n  }\n  UNSAFE_down(frame: number) {\n    if (this.value === 0.0) {\n      this.frameDown = frame;\n    }\n    this.value = 1.0;\n    return this;\n  }\n\n  toJSON() {\n    return {\n      name: this.name,\n      value: this.value,\n      frameDown: this.frameDown,\n      frameUp: this.frameUp,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    this.name = json.name as string;\n    this.value = json.value as number;\n    this.frameDown = json.frameDown as number;\n    this.frameUp = json.frameUp as number;\n    return this;\n  }\n}\n","import { none, Option, IConstructor } from \"@aicacia/core\";\nimport { ToFromJSONEventEmitter } from \"../../ToFromJSONEventEmitter\";\n\nexport abstract class InputHandler<\n  I extends Input = Input\n> extends ToFromJSONEventEmitter {\n  private input: Option<I> = none();\n\n  getConstructor(): IConstructor<this> {\n    return Object.getPrototypeOf(this).constructor;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_setInput(input: I) {\n    this.input.replace(input);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeInput() {\n    this.input.clear();\n    return this;\n  }\n  getInput() {\n    return this.input as Option<I>;\n  }\n  getRequiredInput() {\n    return this.getInput().expect(\n      `${this.getConstructor()} requires a Input Plugin`\n    );\n  }\n  getScene() {\n    return this.getInput().flatMap((input) => input.getScene());\n  }\n  getRequiredScene() {\n    return this.getScene().expect(`${this.getConstructor()} requires a Scene`);\n  }\n\n  onAdd() {\n    return this;\n  }\n  onRemove() {\n    return this;\n  }\n  onUpdate(_time: Time) {\n    return this;\n  }\n  onAfterUpdate(_time: Time) {\n    return this;\n  }\n  abstract onEvent(time: Time, event: InputEvent): this;\n}\n\nimport type { Time } from \"../Time\";\nimport type { Input } from \"./Input\";\nimport type { InputEvent } from \"./InputEvent\";\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { MouseInputEvent } from \"./MouseInputEvent\";\nimport type { MouseWheelInputEvent } from \"./MouseWheelInputEvent\";\n\nexport class MouseInputHandler extends InputHandler {\n  onEvent(time: Time, event: MouseInputEvent | MouseWheelInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"mousemove\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        break;\n      case \"mousedown\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        input\n          .getOrCreateButton(`mouse-${event.button}`)\n          .UNSAFE_down(time.getFrame());\n        break;\n      case \"mouseup\":\n      case \"mouseleave\":\n        input.getOrCreateButton(\"mouse-x\").UNSAFE_setValue(event.x);\n        input.getOrCreateButton(\"mouse-y\").UNSAFE_setValue(event.y);\n        input\n          .getOrCreateButton(`mouse-${event.button}`)\n          .UNSAFE_up(time.getFrame());\n        break;\n      case \"wheel\":\n        input.getOrCreateButton(\"mouse-wheel\").UNSAFE_setValue(event.wheel);\n        break;\n    }\n    return this;\n  }\n\n  onAfterUpdate() {\n    this.getRequiredInput().getOrCreateButton(\"mouse-wheel\").UNSAFE_setValue(0);\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { KeyboardInputEvent } from \"./KeyboardInputEvent\";\n\nexport class KeyboardInputHandler extends InputHandler {\n  onEvent(time: Time, event: KeyboardInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"keydown\":\n        input.getOrCreateButton(event.code).UNSAFE_down(time.getFrame());\n        break;\n      case \"keyup\":\n        input.getOrCreateButton(event.code).UNSAFE_up(time.getFrame());\n        break;\n    }\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { TouchInputEvent } from \"./TouchInputEvent\";\n\nexport class TouchInputHandler extends InputHandler {\n  onEvent(time: Time, event: TouchInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"touchstart\":\n        input.getOrCreateButton(`touch-${event.id}-x`).UNSAFE_setValue(event.x);\n        input.getOrCreateButton(`touch-${event.id}-y`).UNSAFE_setValue(event.y);\n\n        input\n          .getOrCreateButton(`touch-${event.id}`)\n          .UNSAFE_down(time.getFrame());\n        break;\n      case \"touchmove\":\n        input.getOrCreateButton(`touch-${event.id}-x`).UNSAFE_setValue(event.x);\n        input.getOrCreateButton(`touch-${event.id}-y`).UNSAFE_setValue(event.y);\n        break;\n      case \"touchend\":\n        input.getOrCreateButton(`touch-${event.id}`).UNSAFE_up(time.getFrame());\n        break;\n    }\n    return this;\n  }\n}\n","import type { Time } from \"../Time\";\nimport { InputHandler } from \"./InputHandler\";\nimport type { ResizeInputEvent } from \"./ResizeInputEvent\";\n\nexport class ResizeInputHandler extends InputHandler {\n  onEvent(_time: Time, event: ResizeInputEvent) {\n    const input = this.getRequiredInput();\n\n    switch (event.type) {\n      case \"resize\":\n        input.getOrCreateButton(\"screen-width\").UNSAFE_setValue(event.width);\n        input.getOrCreateButton(\"screen-height\").UNSAFE_setValue(event.height);\n        break;\n    }\n    return this;\n  }\n}\n","import { Option } from \"@aicacia/core\";\nimport type { IConstructor } from \"@aicacia/core\";\nimport { Plugin } from \"../../Plugin\";\nimport { Time } from \"../Time\";\nimport { InputAxis } from \"./InputAxis\";\nimport { InputButton } from \"./InputButton\";\nimport { InputHandler } from \"./InputHandler\";\nimport { MouseInputHandler } from \"./MouseInputHandler\";\nimport { KeyboardInputHandler } from \"./KeyboardInputHandler\";\nimport type { EventListener } from \"./EventListener\";\nimport { TouchInputHandler } from \"./TouchInputHandler\";\nimport type { InputEvent } from \"./InputEvent\";\nimport { ResizeInputHandler } from \"./ResizeInputHandler\";\nimport { IJSONObject, isJSONArray } from \"@aicacia/json\";\n\nexport type IInputEventTypes = {\n  \"add-input_handler\": (handler: InputHandler) => void;\n  \"remove-input_handler\": (handler: InputHandler) => void;\n  \"add-event_listener\": (listener: EventListener) => void;\n  \"remove-event_listener\": (listener: EventListener) => void;\n} & {\n  [name: string]: (event: InputEvent) => void;\n};\n\nexport class Input extends Plugin<IInputEventTypes> {\n  private events: InputEvent[] = [];\n\n  private inputHandlers: InputHandler[] = [];\n  private inputHandlerMap: Map<IConstructor<InputHandler>, InputHandler> =\n    new Map();\n\n  private eventListeners: EventListener[] = [];\n  private eventListenerMap: Map<IConstructor<EventListener>, EventListener> =\n    new Map();\n\n  private buttons: Record<string, InputButton> = {};\n  private axes: Record<string, InputAxis> = {};\n\n  constructor() {\n    super();\n\n    this.addInputHandler(\n      new MouseInputHandler(),\n      new KeyboardInputHandler(),\n      new TouchInputHandler(),\n      new ResizeInputHandler()\n    );\n    this.addAxis(\n      new InputAxis(\"horizontal-keys\", \"ArrowLeft\", \"ArrowRight\"),\n      new InputAxis(\"vertical-keys\", \"ArrowDown\", \"ArrowUp\")\n    );\n  }\n\n  queueEvent(event: InputEvent) {\n    this.emit(\"event\", event);\n    this.events.push(event);\n    return this;\n  }\n\n  addAxes(axes: InputAxis[]) {\n    for (const axis of axes) {\n      this._addAxis(axis);\n    }\n    return this;\n  }\n  addAxis(...axes: InputAxis[]) {\n    return this.addAxes(axes);\n  }\n  getAxis(name: string) {\n    return Option.from(this.axes[name]);\n  }\n  getAxisValue(name: string) {\n    return this.getAxis(name)\n      .map((axis) => axis.getValue())\n      .unwrapOr(0.0);\n  }\n\n  getRequiredAxis(name: string) {\n    return this.getAxis(name).expect(`Failed to get Required Axis ${name}`);\n  }\n\n  getInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ) {\n    return Option.from(this.inputHandlerMap.get(InputHandler));\n  }\n  getRequiredInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ) {\n    return this.getInputHandler(InputHandler).expect(\n      `Failed to get Required InputHandler ${InputHandler}`\n    );\n  }\n\n  getEventListener<I extends EventListener = EventListener>(\n    EventListener: IConstructor<I>\n  ) {\n    return Option.from(this.eventListenerMap.get(EventListener));\n  }\n  getRequiredEventListener<I extends EventListener = EventListener>(\n    EventListener: IConstructor<I>\n  ) {\n    return this.getEventListener(EventListener).expect(\n      `Failed to get Required EventListener ${EventListener}`\n    );\n  }\n\n  removeAxes(axes: InputAxis[]) {\n    for (const axis of axes) {\n      this._removeAxis(axis);\n    }\n    return this;\n  }\n  removeAxis(...axes: InputAxis[]) {\n    return this.removeAxes(axes);\n  }\n\n  addInputHandlers(inputHandlers: InputHandler[]) {\n    for (const inputHandler of inputHandlers) {\n      this._addInputHandler(inputHandler);\n    }\n    return this;\n  }\n  addInputHandler(...inputHandlers: InputHandler[]) {\n    return this.addInputHandlers(inputHandlers);\n  }\n\n  removeInputHandlers(inputHandlers: IConstructor<InputHandler>[]) {\n    for (const inputHandler of inputHandlers) {\n      this._removeInputHandler(inputHandler);\n    }\n    return this;\n  }\n  removeInputHandler(...inputHandlers: IConstructor<InputHandler>[]) {\n    return this.removeInputHandlers(inputHandlers);\n  }\n\n  addEventListeners(eventListeners: EventListener[]) {\n    for (const eventListener of eventListeners) {\n      this._addEventListener(eventListener);\n    }\n    return this;\n  }\n  addEventListener(...eventListeners: EventListener[]) {\n    return this.addEventListeners(eventListeners);\n  }\n\n  removeEventListeners(EventListeners: IConstructor<EventListener>[]) {\n    for (const EventListener of EventListeners) {\n      this._removeEventListener(EventListener);\n    }\n    return this;\n  }\n  removeEventListener(...eventListeners: IConstructor<EventListener>[]) {\n    return this.removeEventListeners(eventListeners);\n  }\n\n  getOrCreateButton(name: string) {\n    const button = this.buttons[name];\n\n    if (button) {\n      return button;\n    } else {\n      const newButton = new InputButton(name);\n      this.buttons[name] = newButton;\n      return newButton;\n    }\n  }\n  getButton(name: string) {\n    return Option.from(this.buttons[name]);\n  }\n  getButtonValue(name: string) {\n    return this.getButton(name)\n      .map((button) => button.getValue())\n      .unwrapOr(0.0);\n  }\n\n  isDownCurrentFrame(name: string) {\n    return this.getButton(name)\n      .map(\n        (button) =>\n          button.getFrameDown() === this.getRequiredPlugin(Time).getFrame()\n      )\n      .unwrapOr(false);\n  }\n  isDown(name: string) {\n    return !this.isUp(name);\n  }\n\n  isUpCurrentFrame(name: string) {\n    return this.getButton(name)\n      .map(\n        (button) =>\n          button.getFrameUp() === this.getRequiredPlugin(Time).getFrame()\n      )\n      .unwrapOr(false);\n  }\n  isUp(name: string) {\n    return this.getButtonValue(name) == 0.0;\n  }\n\n  onUpdate() {\n    const time = this.getRequiredPlugin(Time);\n    for (const eventListener of this.eventListeners) {\n      eventListener.onUpdate(time);\n    }\n    for (const inputHandler of this.inputHandlers) {\n      for (const event of this.events) {\n        inputHandler.onEvent(time, event);\n      }\n      inputHandler.onUpdate(time);\n    }\n    for (const event of this.events) {\n      this.emit(event.type, event);\n    }\n    for (const eventListener of this.eventListeners) {\n      for (let i = 0; i < this.events.length; i++) {\n        const event = this.events[i];\n\n        if (eventListener.dequeueEvent(event)) {\n          this.events.splice(i, 1);\n          i--;\n        }\n      }\n    }\n    this.events.length = 0;\n    this.updateAxes(time);\n    return this;\n  }\n\n  onAfterUpdate() {\n    const time = this.getRequiredPlugin(Time);\n    for (const eventListener of this.eventListeners) {\n      eventListener.onAfterUpdate(time);\n    }\n    for (const inputHandler of this.inputHandlers) {\n      inputHandler.onAfterUpdate(time);\n    }\n    return this;\n  }\n\n  private _addAxis(axis: InputAxis) {\n    if (!this.axes[axis.getName()]) {\n      this.axes[axis.getName()] = axis;\n    }\n    return this;\n  }\n\n  private _removeAxis(axis: InputAxis) {\n    if (this.axes[axis.getName()]) {\n      delete this.axes[axis.getName()];\n    }\n    return this;\n  }\n\n  private updateAxes(time: Time) {\n    for (const axis of Object.values(this.axes)) {\n      this.updateAxis(axis, time);\n    }\n  }\n\n  private updateAxis(axis: InputAxis, time: Time) {\n    const posValue = this.getButtonValue(axis.getPosButton()),\n      negValue = this.getButtonValue(axis.getNegButton());\n\n    axis.UNSAFE_update(\n      time,\n      axis.getValue(),\n      negValue !== 0.0,\n      posValue !== 0.0\n    );\n  }\n\n  private _addInputHandler<I extends InputHandler = InputHandler>(\n    inputHandler: I\n  ) {\n    const InputHandler = inputHandler.getConstructor();\n\n    if (!this.inputHandlerMap.has(InputHandler)) {\n      this.inputHandlers.push(inputHandler);\n      this.inputHandlerMap.set(InputHandler, inputHandler);\n      inputHandler.UNSAFE_setInput(this);\n      inputHandler.onAdd();\n      this.emit(\"add-input_handler\", inputHandler);\n    }\n\n    return this;\n  }\n  private _removeInputHandler<I extends InputHandler = InputHandler>(\n    InputHandler: IConstructor<I>\n  ) {\n    this.getInputHandler(InputHandler).ifSome((inputHandler) => {\n      this.emit(\"remove-input_handler\", inputHandler);\n      inputHandler.onRemove();\n\n      this.inputHandlers.splice(this.inputHandlers.indexOf(inputHandler), 1);\n      this.inputHandlerMap.delete(InputHandler);\n      inputHandler.UNSAFE_removeInput();\n    });\n    return this;\n  }\n\n  private _addEventListener<E extends EventListener = EventListener>(\n    eventListener: E\n  ) {\n    const EventListener = eventListener.getConstructor();\n\n    if (!this.eventListenerMap.has(EventListener)) {\n      this.eventListeners.push(eventListener);\n      this.eventListenerMap.set(EventListener, eventListener);\n      eventListener.UNSAFE_setInput(this);\n      eventListener.onAdd();\n      this.emit(\"add-event_listener\", eventListener);\n    }\n\n    return this;\n  }\n  private _removeEventListener<E extends EventListener = EventListener>(\n    EventListener: IConstructor<E>\n  ) {\n    this.getEventListener(EventListener).ifSome((eventListener) => {\n      this.emit(\"remove-event_listener\", eventListener);\n      eventListener.onRemove();\n\n      this.eventListeners.splice(this.eventListeners.indexOf(eventListener), 1);\n      this.eventListenerMap.delete(EventListener);\n      eventListener.UNSAFE_removeInput();\n    });\n    return this;\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      buttons: Object.values(this.buttons).map((button) => button.toJSON()),\n      axes: Object.values(this.axes).map((axis) => axis.toJSON()),\n      inputHandlers: this.inputHandlers.map((inputHandler) =>\n        inputHandler.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (isJSONArray(json.buttons)) {\n      for (const value of json.buttons) {\n        const buttonJSON = value as ReturnType<InputButton[\"toJSON\"]>,\n          button = new InputButton(buttonJSON.name).fromJSON(buttonJSON);\n        this.buttons[button.getName()] = button;\n      }\n    }\n    if (isJSONArray(json.axes)) {\n      this.addAxes(\n        json.axes.map((json) => {\n          const axisJSON = json as ReturnType<InputAxis[\"toJSON\"]>;\n          return new InputAxis(\n            axisJSON.name,\n            axisJSON.negButton,\n            axisJSON.posButton\n          ).fromJSON(axisJSON);\n        })\n      );\n    }\n    if (isJSONArray(json.inputHandlers)) {\n      this.addInputHandlers(\n        json.inputHandlers.map((json) =>\n          InputHandler.newFromJSON(json as IJSONObject)\n        )\n      );\n    }\n    return this;\n  }\n}\n","export class InputEvent<T extends string = string> {\n  type: T;\n\n  constructor(type: T) {\n    this.type = type;\n  }\n\n  static init<T extends string = string>(\n    event: InputEvent,\n    type: T\n  ): InputEvent {\n    event.type = type;\n    return event;\n  }\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class KeyboardInputEvent extends InputEvent<\"keyup\" | \"keydown\"> {\n  code = \"\";\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class MouseInputEvent extends InputEvent<\n  \"mousemove\" | \"mousedown\" | \"mouseup\" | \"mouseleave\"\n> {\n  button = 0;\n  x = 0;\n  y = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class MouseWheelInputEvent extends InputEvent<\"wheel\"> {\n  wheel = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class ResizeInputEvent extends InputEvent<\"resize\"> {\n  width = 0;\n  height = 0;\n}\n","import { InputEvent } from \"./InputEvent\";\n\nexport class TouchInputEvent extends InputEvent<\n  \"touchstart\" | \"touchmove\" | \"touchend\"\n> {\n  id = 0;\n  x = 0;\n  y = 0;\n}\n","import type { Canvas } from \"../Canvas\";\nimport { RunOnUpdatePlugin } from \"./RunOnUpdatePlugin\";\nimport { Input } from \"./input\";\nimport type { IRequirement } from \"../IRequirement\";\nimport type { Plugin } from \"../Plugin\";\n\nexport class FullScreenCanvas extends RunOnUpdatePlugin {\n  static toFromJSONEnabled = false;\n  static requiredPlugins: IRequirement<Plugin>[] = [Input];\n\n  private canvas: Canvas;\n\n  constructor(canvas: Canvas) {\n    super();\n\n    this.canvas = canvas;\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  onAdd() {\n    this.getRequiredPlugin(Input).on(\"resize\", this.onResizeEventListener);\n    return this;\n  }\n\n  onRemove() {\n    this.getRequiredPlugin(Input).off(\"resize\", this.onResizeEventListener);\n    return this;\n  }\n\n  private onResizeEventListener = () => {\n    this.runOnUpdate(this.onResize);\n  };\n\n  private onResize() {\n    const input = this.getRequiredPlugin(Input);\n    this.canvas.set(\n      input.getButtonValue(\"screen-width\"),\n      input.getButtonValue(\"screen-height\")\n    );\n  }\n}\n","export type IRequestAnimationFrame = (\n  callback: (timestamp: number) => void\n) => number;\nexport type ICancelAnimationFrame = (handle: number) => void;\n\nconst win = typeof window !== \"undefined\" ? window : ({} as any),\n  p = typeof performance !== \"undefined\" ? performance : Date,\n  now = () => p.now();\n\nlet requestAnimationFrame: IRequestAnimationFrame =\n    win.requestAnimationFrame && win.requestAnimationFrame.bind(win),\n  cancelAnimationFrame: ICancelAnimationFrame =\n    win.cancelAnimationFrame && win.cancelAnimationFrame.bind(win);\n\nif (!requestAnimationFrame || !cancelAnimationFrame) {\n  let lastTime = 0;\n  requestAnimationFrame = (callback: (timestamp: number) => void) => {\n    const curr = now(),\n      next = Math.max(lastTime + 1000 / 60, curr);\n    return setTimeout(() => {\n      callback((lastTime = next));\n    }, next - curr) as any;\n  };\n  cancelAnimationFrame = (h) => clearTimeout(h as any);\n}\n\nexport { requestAnimationFrame, cancelAnimationFrame, now };\n","import {\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from \"./requestAnimationFrame\";\nimport { Input } from \"./input\";\nimport { Plugin } from \"../Plugin\";\n\nexport class EventLoop extends Plugin {\n  static requiredPlugins = [Input];\n  private id: number | null = null;\n  private running = false;\n\n  onInit() {\n    this.getRequiredPlugin(Input).on(\"event\", this.start);\n    this.start();\n    return this;\n  }\n  onRemove() {\n    this.getRequiredPlugin(Input).off(\"event\", this.start);\n    return this;\n  }\n\n  start = () => {\n    if (!this.running) {\n      this.running = true;\n      this.request();\n    }\n  };\n  stop() {\n    this.running = false;\n\n    if (this.id !== null) {\n      cancelAnimationFrame(this.id);\n      this.id = null;\n    }\n    return this;\n  }\n  isStopped() {\n    return this.running === false;\n  }\n\n  private run = (_ms: number) => {\n    this.id = null;\n    this.getRequiredScene().update();\n    this.running = false;\n    return this;\n  };\n\n  private request() {\n    this.id = requestAnimationFrame(this.run);\n    return this;\n  }\n}\n","import {\n  requestAnimationFrame,\n  cancelAnimationFrame,\n} from \"./requestAnimationFrame\";\nimport { Plugin } from \"../Plugin\";\n\nexport type ILoopHandler = (ms: number) => void;\n\nexport class Loop extends Plugin {\n  private id: number | null = null;\n  private running = false;\n  private resolves: Array<() => void> = [];\n\n  promise(): Promise<void> {\n    if (this.running) {\n      return new Promise((resolve) => this.resolves.push(resolve));\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  start() {\n    if (!this.running) {\n      this.running = true;\n      this.request();\n    }\n  }\n  stop() {\n    this.running = false;\n\n    if (this.id !== null) {\n      cancelAnimationFrame(this.id);\n      this.id = null;\n    }\n    return this;\n  }\n  isStopped() {\n    return this.running === false;\n  }\n\n  private run = (_ms: number) => {\n    this.getRequiredScene().update();\n\n    if (this.running) {\n      this.request();\n    } else if (this.resolves.length) {\n      const resolves = this.resolves;\n\n      this.resolves = [];\n\n      for (const resolve of resolves) {\n        resolve();\n      }\n    }\n    return this;\n  };\n\n  private request() {\n    this.id = requestAnimationFrame(this.run);\n    return this;\n  }\n\n  onInit() {\n    this.start();\n    return this;\n  }\n}\n","import { DefaultManager } from \"../../DefaultManager\";\nimport type { Camera2DControl } from \"./Camera2DControl\";\n\nexport class Camera2DControlManager extends DefaultManager<Camera2DControl> {\n  onInit() {\n    return this;\n  }\n  onAfterUpdate() {\n    return this;\n  }\n}\n","import { vec2 } from \"gl-matrix\";\nimport { Input } from \"../../plugins\";\nimport { Camera2D } from \"./Camera2D\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { Camera2DControlManager } from \"./Camera2DControlManager\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport { EPSILON } from \"../../math\";\n\nconst VEC2_0 = vec2.create(),\n  VEC2_1 = vec2.create(),\n  VEC2_2 = vec2.create(),\n  ZERO = vec2.fromValues(0, 0),\n  MIN_SCALE = vec2.fromValues(EPSILON, EPSILON);\n\nexport class Camera2DControl extends RenderableComponent {\n  static Manager = Camera2DControlManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n  static requiredPlugins = [Input];\n\n  private enabled = true;\n\n  private panSpeed = 1.0;\n  private zoomSpeed = 1.0;\n\n  private dragging = false;\n  private lastMouse: vec2 = vec2.create();\n  private offset: vec2 = vec2.create();\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getPanSpeed() {\n    return this.panSpeed;\n  }\n  setPanSpeed(panSpeed: number) {\n    this.panSpeed = panSpeed;\n    return this;\n  }\n\n  getZoomSpeed() {\n    return this.zoomSpeed;\n  }\n  setZoomSpeed(zoomSpeed: number) {\n    this.zoomSpeed = zoomSpeed;\n    return this;\n  }\n\n  onUpdate() {\n    const input = this.getRequiredPlugin(Input),\n      transform = TransformComponent.getRequiredTransform(\n        this.getRequiredEntity()\n      ),\n      scale = transform.getLocalScale2(VEC2_1),\n      camera = this.getRequiredComponent(Camera2D),\n      worldMouse = camera.toRelative(\n        VEC2_0,\n        vec2.set(\n          VEC2_0,\n          -input.getButtonValue(\"mouse-x\"),\n          -input.getButtonValue(\"mouse-y\")\n        )\n      );\n\n    if (this.dragging) {\n      vec2.sub(this.offset, worldMouse, this.lastMouse);\n      vec2.scale(this.offset, this.offset, this.panSpeed);\n      vec2.mul(this.offset, this.offset, scale);\n      vec2.rotate(this.offset, this.offset, ZERO, transform.getRotationZ());\n      this.enabled && transform.translate2(this.offset);\n    }\n\n    if (input.isDown(\"mouse-0\")) {\n      this.dragging = true;\n    } else {\n      this.dragging = false;\n    }\n\n    const mouseWheel = input.getButtonValue(\"mouse-wheel\"),\n      zoomSpeed = vec2.set(VEC2_2, this.zoomSpeed, this.zoomSpeed);\n\n    if (mouseWheel !== 0 && this.enabled) {\n      if (mouseWheel > 0) {\n        vec2.add(scale, scale, zoomSpeed);\n      } else if (mouseWheel < 0) {\n        vec2.sub(scale, scale, zoomSpeed);\n        vec2.max(scale, MIN_SCALE, scale);\n      }\n      transform.setLocalScale2(scale);\n    }\n\n    vec2.copy(this.lastMouse, worldMouse);\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      enabled: this.enabled,\n      zoomSpeed: this.zoomSpeed,\n      panSpeed: this.panSpeed,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    this.setEnabled(json.enabled as boolean);\n    this.setZoomSpeed(json.zoomSpeed as number);\n    this.setPanSpeed(json.panSpeed as number);\n    return this;\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Camera3D } from \"./Camera3D\";\n\nexport class Camera3DManager extends DefaultDescriptorManager<Camera3D> {\n  private active: Option<Camera3D> = none();\n\n  setActive(camera: Camera3D) {\n    if (\n      camera\n        .getManager()\n        .map((manager) => manager === this)\n        .unwrapOr(false)\n    ) {\n      this.active.replace(camera);\n    } else {\n      throw new Error(\n        \"Camera3DManager.setActive(camera: Camera3D): cannot set active if camera is not in manager\"\n      );\n    }\n    return this;\n  }\n  getActive() {\n    return this.active;\n  }\n  getRequiredActive() {\n    return this.getActive().expect(`Expected an Active Camera`);\n  }\n\n  addComponent(camera: Camera3D) {\n    super.addComponent(camera);\n\n    if (this.active.isNone()) {\n      this.active.replace(camera);\n    }\n\n    return this;\n  }\n\n  removeComponent(camera: Camera3D) {\n    super.removeComponent(camera);\n\n    this.active.ifSome((active) => {\n      if (active === camera) {\n        this.active.clear();\n      }\n    });\n\n    return this;\n  }\n}\n","import { mat4, vec2, vec3, vec4 } from \"gl-matrix\";\nimport { Transform2D } from \"../Transform2D\";\nimport { Transform3D } from \"../Transform3D\";\nimport { EPSILON } from \"../../math\";\nimport { RenderableComponent } from \"../RenderableComponent\";\nimport { TransformComponent } from \"../TransformComponent\";\nimport { Camera3DManager } from \"./Camera3DManager\";\nimport type { IJSONArray, IJSONObject } from \"@aicacia/json\";\n\nconst MAT4_0 = mat4.create(),\n  VEC2_0 = vec2.create();\n\nexport class Camera3D extends RenderableComponent {\n  static Manager = Camera3DManager;\n  static requiredComponents = [[Transform2D, Transform3D]];\n\n  private width = 1.0;\n  private height = 1.0;\n  private aspect = 1.0;\n\n  private orthographic = false;\n\n  private size = 1;\n  private minSize = Number.EPSILON;\n  private maxSize = Infinity;\n\n  private fov = 16;\n  private near = EPSILON;\n  private far = 1024;\n\n  private projection = mat4.identity(mat4.create());\n  private view = mat4.identity(mat4.create());\n\n  private needsUpdate = true;\n  private background: vec4 = vec4.create();\n\n  getBackground() {\n    return this.background;\n  }\n  setBackground(background: vec4) {\n    vec4.copy(this.background, background);\n    return this;\n  }\n\n  set(width: number, height: number) {\n    if (width !== this.width || height !== this.height) {\n      this.width = width;\n      this.height = height;\n      this.aspect = width / height;\n      return this.setNeedsUpdate();\n    } else {\n      return this;\n    }\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n  getAspect() {\n    return this.aspect;\n  }\n\n  getSize() {\n    return this.size;\n  }\n  setSize(size: number) {\n    this.size =\n      size < this.minSize\n        ? this.minSize\n        : size > this.maxSize\n        ? this.maxSize\n        : size;\n    return this.setNeedsUpdate();\n  }\n  getMinSize() {\n    return this.minSize;\n  }\n  setMinSize(minSize: number) {\n    this.minSize = minSize;\n    return this.setNeedsUpdate();\n  }\n  getMaxSize() {\n    return this.minSize;\n  }\n  setMaxSize(maxSize: number) {\n    this.maxSize = maxSize;\n    return this.setNeedsUpdate();\n  }\n\n  getFov() {\n    return this.fov;\n  }\n  setFov(fov: number) {\n    this.fov = fov;\n    return this.setNeedsUpdate();\n  }\n\n  getNear() {\n    return this.near;\n  }\n  setNear(near: number) {\n    this.near = near;\n    return this.setNeedsUpdate();\n  }\n  getFar() {\n    return this.far;\n  }\n  setFar(far: number) {\n    this.far = far;\n    return this.setNeedsUpdate();\n  }\n\n  getView() {\n    this.getEntity().ifSome((entity) =>\n      TransformComponent.getTransform(entity).ifSome((transform) => {\n        mat4.invert(this.view, transform.getMatrix4(MAT4_0));\n      })\n    );\n    return this.view;\n  }\n\n  getProjection() {\n    return this.updateProjectionIfNeeded().projection;\n  }\n\n  setNeedsUpdate(needsUpdate = true) {\n    this.needsUpdate = needsUpdate;\n    return this;\n  }\n\n  updateProjectionIfNeeded() {\n    if (this.needsUpdate) {\n      return this.updateProjection();\n    } else {\n      return this;\n    }\n  }\n\n  isActive(): boolean {\n    return this.getRequiredManager<Camera3DManager>()\n      .getActive()\n      .map((active) => active === this)\n      .unwrapOr(false);\n  }\n  setActive() {\n    this.getRequiredManager<Camera3DManager>().setActive(this);\n    return this;\n  }\n  updateProjection() {\n    if (this.orthographic) {\n      const right = this.size * this.aspect,\n        left = -right,\n        top = this.size,\n        bottom = -top;\n\n      mat4.ortho(\n        this.projection,\n        left,\n        right,\n        bottom,\n        top,\n        this.near,\n        this.far\n      );\n    } else {\n      mat4.perspective(\n        this.projection,\n        this.fov,\n        this.aspect,\n        this.near,\n        this.far\n      );\n    }\n    this.needsUpdate = false;\n\n    return this;\n  }\n\n  toRelative(out: vec3, screen: vec2) {\n    this.toWorld(out, screen);\n    vec3.transformMat4(out, out, this.getView());\n    return out;\n  }\n\n  toWorld(out: vec3, screen: vec2) {\n    const mat = MAT4_0;\n\n    out[0] = 2.0 * (screen[0] / this.width) - 1.0;\n    out[1] = -2.0 * (screen[1] / this.height) + 1.0;\n    out[2] = this.near;\n\n    mat4.mul(mat, this.projection, this.getView());\n    mat4.invert(mat, mat);\n    vec3.transformMat4(out, out, mat);\n\n    return out;\n  }\n\n  toScreen(out: vec2, world: vec3) {\n    const mat = mat4.mul(MAT4_0, this.getProjection(), this.getView());\n\n    VEC2_0[0] = world[0];\n    VEC2_0[1] = world[1];\n    vec2.transformMat4(out, VEC2_0, mat);\n\n    out[0] = (out[0] + 1.0) * 0.5 * this.width;\n    out[1] = (1.0 - out[1]) * 0.5 * this.height;\n\n    return out;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      width: this.width,\n      height: this.height,\n      size: this.size,\n      fov: this.fov,\n      near: this.near,\n      far: this.far,\n      background: this.background as IJSONArray,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    return super\n      .fromJSON(json)\n      .set(json.width as number, json.height as number)\n      .setSize(json.size as number)\n      .setFov(json.fov as number)\n      .setNear(json.near as number)\n      .setFar(json.far as number)\n      .setBackground(json.background as vec4);\n  }\n}\n","import { DefaultDescriptorManager } from \"../../DefaultDescriptorManager\";\nimport type { Sprite } from \"./Sprite\";\n\nexport class SpriteManager extends DefaultDescriptorManager<Sprite> {\n  private layers: Record<number, Sprite[]> = {};\n\n  isEmpty() {\n    return Object.values(this.layers).length === 0;\n  }\n\n  getComponents() {\n    return ([] as Sprite[]).concat(...Object.values(this.layers));\n  }\n\n  addComponent(sprite: Sprite) {\n    this.getOrCreateLayer(sprite.getLayer()).push(sprite);\n    return this;\n  }\n  removeComponent(sprite: Sprite) {\n    const layerIndex = sprite.getLayer(),\n      layer = this.layers[layerIndex];\n\n    if (layer) {\n      const index = layer.indexOf(sprite);\n\n      if (index !== -1) {\n        layer.splice(index, 1);\n\n        if (layer.length === 0) {\n          delete this.layers[layerIndex];\n        }\n      }\n    }\n\n    return this;\n  }\n\n  sortFunction = (a: Sprite, b: Sprite) => {\n    return a.getRequiredEntity().getDepth() - b.getRequiredEntity().getDepth();\n  };\n\n  sort() {\n    for (const layer of Object.values(this.layers)) {\n      layer.sort(this.sortFunction);\n    }\n    return this;\n  }\n\n  private getOrCreateLayer(layerIndex: number) {\n    const layer = this.layers[layerIndex];\n\n    if (layer) {\n      return layer;\n    } else {\n      const newLayer: Sprite[] = [];\n      this.layers[layerIndex] = newLayer;\n      return newLayer;\n    }\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport type { vec2 } from \"gl-matrix\";\nimport { Assets } from \"../../plugins\";\nimport type { ImageAsset } from \"../../plugins/assets/ImageAsset\";\nimport { RenderableComponent } from \"../RenderableComponent\";\n\nexport class Sprite extends RenderableComponent {\n  static requiredPlugins = [Assets];\n\n  private layer = 0;\n  private imageAsset: Option<ImageAsset> = none();\n\n  private clipX = 0;\n  private clipY = 0;\n  private clipWidth = 1;\n  private clipHeight = 1;\n  private width = 1;\n  private height = 1;\n\n  getClipX() {\n    return this.clipX;\n  }\n  setClipX(clipX: number) {\n    this.clipX = clipX;\n    return this;\n  }\n\n  getClipY() {\n    return this.clipY;\n  }\n  setClipY(clipY: number) {\n    this.clipY = clipY;\n    return this;\n  }\n\n  getClipWidth() {\n    return this.clipWidth;\n  }\n  setClipWidth(clipWidth: number) {\n    this.clipWidth = clipWidth;\n    return this;\n  }\n\n  getClipHeight() {\n    return this.clipHeight;\n  }\n  setClipHeight(clipHeight: number) {\n    this.clipHeight = clipHeight;\n    return this;\n  }\n\n  getSize(out: vec2): vec2 {\n    out[0] = this.width;\n    out[1] = this.height;\n    return out;\n  }\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    this.width = width;\n    return this;\n  }\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    this.height = height;\n    return this;\n  }\n\n  getLayer() {\n    return this.layer;\n  }\n  setLayer(layer: number) {\n    const managerOption = this.getManager();\n    managerOption.ifSome((manager) => manager.removeComponent(this));\n    this.layer = layer | 0;\n    managerOption.ifSome((manager) => manager.addComponent(this));\n    return this;\n  }\n\n  getImageAsset<T extends ImageAsset = ImageAsset>(): Option<T> {\n    return this.imageAsset as Option<T>;\n  }\n  setImageAsset(imageAsset: ImageAsset) {\n    this.imageAsset.replace(imageAsset);\n\n    if (imageAsset.isLoaded()) {\n      this.onImageLoadHandler();\n    } else {\n      imageAsset.on(\"load\", this.onImageLoadHandler);\n    }\n\n    return this;\n  }\n\n  private onImageLoadHandler = () => {\n    this.imageAsset.ifSome((imageAsset) => {\n      this.clipWidth = imageAsset.getWidth();\n      this.clipHeight = imageAsset.getHeight();\n      imageAsset.off(\"load\", this.onImageLoadHandler);\n    });\n  };\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      imageAssetUUID: this.imageAsset\n        .map((imageAsset) => imageAsset.getUUID() as string | null)\n        .unwrapOr(null),\n      layer: this.layer,\n      clipX: this.clipX,\n      clipY: this.clipY,\n      clipWidth: this.clipWidth,\n      clipHeight: this.clipHeight,\n      width: this.width,\n      height: this.height,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    const onAddToScene = () => {\n      this.setImageAsset(\n        this.getRequiredPlugin(Assets)\n          .getAsset<ImageAsset>(json.imageAssetUUID as string)\n          .expect(`Sprite.fromJSON Failed to get Asset ${json.imageAssetUUID}`)\n      );\n      this.off(\"add-to-scene\", onAddToScene);\n    };\n\n    this.on(\"add-to-scene\", onAddToScene);\n\n    return super\n      .fromJSON(json)\n      .setLayer(json.layer as number)\n      .setClipX(json.clipX as number)\n      .setClipY(json.clipY as number)\n      .setClipWidth(json.clipWidth as number)\n      .setClipHeight(json.clipHeight as number)\n      .setWidth(json.width as number)\n      .setHeight(json.height as number);\n  }\n}\n\nimport { SpriteManager } from \"./SpriteManager\";\n\nSprite.Manager = SpriteManager;\n","import type { IJSONObject } from \"@aicacia/json\";\n\nexport class SpriteClip {\n  private duration = 1.0;\n  private x = 0;\n  private y = 0;\n  private width = 1;\n  private height = 1;\n\n  getDuration() {\n    return this.duration;\n  }\n  setDuration(duration: number) {\n    this.duration = duration;\n    return this;\n  }\n\n  getX() {\n    return this.x;\n  }\n  setX(x: number) {\n    this.x = x;\n    return this;\n  }\n\n  getY() {\n    return this.y;\n  }\n  setY(y: number) {\n    this.y = y;\n    return this;\n  }\n\n  getWidth() {\n    return this.width;\n  }\n  setWidth(width: number) {\n    this.width = width;\n    return this;\n  }\n\n  getHeight() {\n    return this.height;\n  }\n  setHeight(height: number) {\n    this.height = height;\n    return this;\n  }\n\n  toJSON() {\n    return {\n      duration: this.duration,\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    this.duration = json.duration as number;\n    this.x = json.x as number;\n    this.y = json.y as number;\n    this.width = json.width as number;\n    this.height = json.height as number;\n    return this;\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport type { SpriteClip } from \"./SpriteClip\";\nimport { Component } from \"../../Component\";\nimport { Time } from \"../../plugins/Time\";\nimport { Sprite } from \"./Sprite\";\n\nexport class SpriteSheet extends Component {\n  static requiredComponents = [Sprite];\n  static requiredPlugins = [Time];\n\n  private currentTime = 0;\n  private currentFrame = 0;\n  private playBack = 1;\n  private currentName: Option<string> = none();\n  private spriteSheets: Record<string, SpriteClip[]> = {};\n\n  get = (name: string) => {\n    return Option.from(this.spriteSheets[name]);\n  };\n  set(name: string, spriteClips: SpriteClip[]) {\n    this.spriteSheets[name] = spriteClips;\n    return this;\n  }\n  getPlayBack() {\n    return this.playBack;\n  }\n  setPlayBack(playBack: number) {\n    this.playBack = playBack;\n    return this;\n  }\n  setCurrent(name: string) {\n    if (!this.spriteSheets.hasOwnProperty(name)) {\n      throw new Error(\n        `SpriteSheet setCurrent(name: string) no SpriteSheet found named ${name}`\n      );\n    }\n    this.currentName.replace(name);\n    this.currentFrame = 0;\n    this.currentTime = 0;\n    return this;\n  }\n  getCurrent() {\n    return this.currentName.flatMap(this.get);\n  }\n\n  onUpdate() {\n    this.getCurrent().ifSome((clips) => {\n      const clip = clips[this.currentFrame];\n\n      if (clip) {\n        const sprite = this.getRequiredComponent(Sprite);\n\n        sprite.setClipX(clip.getX());\n        sprite.setClipY(clip.getY());\n        sprite.setClipWidth(clip.getWidth());\n        sprite.setClipHeight(clip.getHeight());\n\n        if (this.currentTime >= clip.getDuration()) {\n          this.currentTime = 0;\n          this.currentFrame += 1;\n\n          if (this.currentFrame >= clips.length) {\n            this.currentFrame = 0;\n          }\n        }\n\n        this.currentTime +=\n          this.getRequiredPlugin(Time).getDelta() * this.playBack;\n      }\n    });\n\n    return this;\n  }\n}\n","import { RenderableComponent } from \"./RenderableComponent\";\nimport type { IRunOnUpdateFn } from \"../IRunOnUpdateFn\";\n\nexport abstract class RunOnUpdateComponent extends RenderableComponent {\n  private queue: IRunOnUpdateFn<this>[] = [];\n  private swap: IRunOnUpdateFn<this>[] = [];\n\n  runOnUpdate(...fns: IRunOnUpdateFn<this>[]) {\n    this.queue.push(...fns);\n    return this;\n  }\n\n  onUpdate() {\n    if (this.queue.length > 0) {\n      const queue = this.queue;\n\n      this.queue = this.swap;\n      this.swap = queue;\n\n      for (const fn of queue) {\n        fn.call(this);\n      }\n      this.swap.length = 0;\n    }\n    return this;\n  }\n}\n","import { TransformComponent } from \"./TransformComponent\";\nimport { Transform2D } from \"./Transform2D\";\nimport { Transform3D } from \"./Transform3D\";\nimport type { Entity } from \"../Entity\";\n\nexport {\n  Camera2D,\n  Camera2DManager,\n  Camera2DControl,\n  Camera2DControlManager,\n} from \"./Camera2D\";\nexport { Camera3D, Camera3DManager } from \"./Camera3D\";\nexport { Sprite, SpriteClip, SpriteManager, SpriteSheet } from \"./Sprite\";\nexport { Transform2D };\nexport { Transform3D };\nexport { RenderableComponent } from \"./RenderableComponent\";\nexport { RunOnUpdateComponent } from \"./RunOnUpdateComponent\";\nexport { TransformComponentManager } from \"./TransformComponentManager\";\n\nTransformComponent.getTransform = function getTransform(entity: Entity) {\n  const entityTransform = entity\n    .getComponent<TransformComponent>(Transform2D)\n    .orElse(() => entity.getComponent<TransformComponent>(Transform3D));\n\n  if (entityTransform.isNone()) {\n    return TransformComponent.getParentTransform(entity);\n  } else {\n    return entityTransform;\n  }\n};\n\nexport { TransformComponent };\n","import { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { none, Option, some, IConstructor } from \"@aicacia/core\";\nimport {\n  filterRequirements,\n  IRequirement,\n  requirementToString,\n} from \"./IRequirement\";\nimport { Component } from \"./Component\";\nimport type { Plugin } from \"./Plugin\";\nimport type { Scene } from \"./Scene\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface IEntityEventTypes {\n  \"add-component\": (component: Component) => void;\n  \"remove-component\": (component: Component) => void;\n  \"add-child\": (child: Entity) => void;\n  \"remove-child\": (child: Entity) => void;\n}\n\nexport class Entity extends ToFromJSONEventEmitter<IEntityEventTypes> {\n  private name: Option<string> = none();\n  private depth = 0;\n  private scene: Option<Scene> = none();\n  private root: Entity = this;\n  private parent: Option<Entity> = none();\n  private tags: Set<string> = new Set();\n  private children: Entity[] = [];\n  private components: Map<IConstructor<Component>, Component> = new Map();\n\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name.replace(name);\n    return this;\n  }\n  removeName() {\n    this.name.take();\n    return this;\n  }\n\n  hasTags(tags: string[]) {\n    return tags.every((tag) => this.tags.has(tag));\n  }\n  hasTag(...tags: string[]) {\n    return this.hasTags(tags);\n  }\n  getTags() {\n    return this.tags;\n  }\n  addTags(tags: string[]) {\n    for (const tag of tags) {\n      this.tags.add(tag);\n    }\n    return this;\n  }\n  removeTag(...tags: string[]) {\n    return this.removeTags(tags);\n  }\n  removeTags(tags: string[]) {\n    for (const tag of tags) {\n      this.tags.delete(tag);\n    }\n    return this;\n  }\n  clearTags() {\n    this.tags.clear();\n    return this;\n  }\n  addTag(...tags: string[]) {\n    return this.addTags(tags);\n  }\n\n  getDepth() {\n    return this.depth;\n  }\n  getRoot() {\n    return this.root;\n  }\n  isRoot() {\n    return this.root === this;\n  }\n\n  hasParent(): boolean {\n    return this.parent.isSome();\n  }\n  getParent(): Option<Entity> {\n    return this.parent;\n  }\n\n  hasScene() {\n    return this.scene.isSome();\n  }\n  getScene(): Option<Scene> {\n    return this.scene;\n  }\n  getRequiredScene() {\n    return this.getScene().expect(\"Entity expected to have a Scene\");\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_setScene(scene: Scene, recur = false) {\n    this.scene.replace(scene);\n    if (recur) {\n      for (const child of this.children) {\n        child.UNSAFE_setScene(scene, recur);\n      }\n    }\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeScene() {\n    this.scene.clear();\n    return this;\n  }\n\n  forEachChild(fn: (entity: Entity) => false | void, recur = true) {\n    for (const child of this.getChildren()) {\n      if (fn(child) === false) {\n        break;\n      }\n\n      if (recur) {\n        child.forEachChild(fn, recur);\n      }\n    }\n    return this;\n  }\n  find(fn: (entity: Entity) => boolean, recur = true): Option<Entity> {\n    for (const child of this.getChildren()) {\n      if (fn(child)) {\n        return some(child);\n      } else if (recur) {\n        const found = child.find(fn, recur);\n\n        if (found.isSome()) {\n          return found;\n        }\n      }\n    }\n\n    return none();\n  }\n  findWithName(name: string) {\n    return this.find((child) =>\n      child.name.map((childName) => childName === name).unwrapOr(false)\n    );\n  }\n  findWithTag(...tags: string[]) {\n    return this.find((entity) => entity.hasTags(tags));\n  }\n  findWithTags(tags: string[]) {\n    return this.findWithTag(...tags);\n  }\n  findWithComponent<C extends Component>(Component: IConstructor<C>) {\n    return this.find((entity) => entity.getComponent(Component).isSome());\n  }\n\n  findAll(fn: (entity: Entity) => boolean, recur = true): Entity[] {\n    const children = this.getChildren(),\n      matching = [];\n\n    for (const child of children) {\n      if (fn(child)) {\n        matching.push(child);\n      } else if (recur) {\n        matching.push(...child.findAll(fn, recur));\n      }\n    }\n\n    return matching;\n  }\n  findAllWithName(name: string, recur = true) {\n    return this.findAll(\n      (child) =>\n        child.name.map((childName) => childName === name).unwrapOr(false),\n      recur\n    );\n  }\n  findAllWithTag(...tags: string[]) {\n    return this.findAll((entity) => entity.hasTags(tags));\n  }\n  findAllWithTags(tags: string[]) {\n    return this.findAllWithTag(...tags);\n  }\n  findAllWithComponent<C extends Component>(\n    Component: IConstructor<C>,\n    recur = true\n  ) {\n    return this.findAll(\n      (entity) => entity.getComponent(Component).isSome(),\n      recur\n    );\n  }\n\n  findParent(fn: (entity: Entity) => boolean): Option<Entity> {\n    return this.getParent().flatMap((parent) => {\n      if (fn(parent)) {\n        return some(parent);\n      } else {\n        return parent.findParent(fn);\n      }\n    });\n  }\n\n  getComponents() {\n    return this.components;\n  }\n  hasComponent<C extends Component = Component>(Component: IConstructor<C>) {\n    return this.getComponent(Component).isSome();\n  }\n  getComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): Option<C> {\n    return Option.from(this.components.get(Component) as C);\n  }\n  getRequiredComponent<C extends Component = Component>(\n    Component: IConstructor<C>\n  ) {\n    return this.getComponent(Component).expect(\n      () => `Entity expected to have a ${Component} Component`\n    );\n  }\n  getComponentInstanceOf<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): Option<C> {\n    for (const component of this.components.values()) {\n      if (component instanceof Component) {\n        return some(component);\n      }\n    }\n    return none();\n  }\n  getComponentsInstanceOf<C extends Component = Component>(\n    Component: IConstructor<C>\n  ): C[] {\n    return Array.from(this.components.values()).filter(\n      (component) => component instanceof Component\n    ) as C[];\n  }\n\n  addComponents(components: Component[]) {\n    for (const component of components) {\n      this._addComponent(component);\n    }\n    return this;\n  }\n  addComponent(...components: Component[]) {\n    return this.addComponents(components);\n  }\n\n  removeComponents(Components: IConstructor<Component>[]) {\n    for (const Component of Components) {\n      this._removeComponent(Component);\n    }\n    return this;\n  }\n  removeComponent(...components: IConstructor<Component>[]) {\n    return this.removeComponents(components);\n  }\n\n  removeFromScene() {\n    this.scene.ifSome((scene) => {\n      scene.removeEntity(this);\n    });\n  }\n  detach() {\n    this.parent.ifSome((parent) => {\n      parent._removeChild(this);\n      this.scene.ifSome((scene) => scene.addEntity(this));\n      for (const component of this.components.values()) {\n        component.onDetach();\n      }\n    });\n  }\n  getChildren(): readonly Entity[] {\n    return this.children;\n  }\n  addChildren(children: Entity[]) {\n    for (const child of children) {\n      this._addChild(child);\n    }\n    return this;\n  }\n  addChild(...children: Entity[]) {\n    return this.addChildren(children);\n  }\n\n  removeChildren(children: Entity[]) {\n    for (const child of children) {\n      this._removeChild(child);\n    }\n    return this;\n  }\n  removeChild(...children: Entity[]) {\n    return this.removeChildren(children);\n  }\n\n  validateRequirements() {\n    const missingComponents: Map<\n        IConstructor<Component>,\n        IRequirement<Component>[]\n      > = new Map(),\n      missingPlugins: Map<\n        IConstructor<Component>,\n        IRequirement<Plugin>[]\n      > = new Map();\n\n    for (const [Component, component] of this.components) {\n      const missingRequiredComponents = filterRequirements(\n          component.getRequiredComponents(),\n          (C) => !this.hasComponent(C)\n        ),\n        missingRequiredPlugins = filterRequirements(\n          component.getRequiredPlugins(),\n          (P) => !this.getRequiredScene().hasPlugin(P)\n        );\n\n      if (missingRequiredComponents.length > 0) {\n        missingComponents.set(Component, missingRequiredComponents);\n      }\n      if (missingRequiredComponents.length > 0) {\n        missingPlugins.set(Component, missingRequiredPlugins);\n      }\n    }\n\n    if (missingComponents.size > 0 || missingPlugins.size > 0) {\n      const componentMessage = [...missingComponents.entries()]\n          .map(([component, missingRequirements]) =>\n            missingRequirements\n              .map(\n                (missingRequirement) =>\n                  `Entity's ${requirementToString(\n                    component\n                  )} requires ${requirementToString(\n                    missingRequirement\n                  )} Component`\n              )\n              .join(\"\\n\")\n          )\n          .join(\"\\n\"),\n        pluginMessage = [...missingPlugins.entries()]\n          .map(([component, missingRequirements]) =>\n            missingRequirements\n              .map(\n                (missingRequirement) =>\n                  `Entity's ${requirementToString(\n                    component\n                  )} requires ${requirementToString(missingRequirement)} Plugin`\n              )\n              .join(\"\\n\")\n          )\n          .join(\"\\n\");\n\n      throw new Error(\n        componentMessage\n          ? `${componentMessage}\\n${pluginMessage}`\n          : pluginMessage\n      );\n    }\n  }\n\n  private _addComponent<C extends Component>(component: C) {\n    const Component = component.getConstructor();\n\n    if (!this.components.has(Component)) {\n      component.UNSAFE_setEntity(this);\n\n      this.components.set(Component, component);\n\n      this.scene.ifSome((scene) => scene.UNSAFE_addComponent(component));\n      this.emit(\"add-component\", component);\n    }\n    return this;\n  }\n\n  private _removeComponent<C extends Component>(Component: IConstructor<C>) {\n    const componentOption = this.getComponent(Component);\n\n    componentOption.ifSome((component) => {\n      this.emit(\"remove-component\", component);\n      component.UNSAFE_removeEntity();\n\n      this.components.delete(Component);\n\n      this.scene.ifSome((scene) => scene.UNSAFE_removeComponent(component));\n    });\n    return this;\n  }\n\n  private _addChild(child: Entity) {\n    if (this.children.indexOf(child) === -1) {\n      if (child.isRoot()) {\n        child.scene.ifSome((scene) => scene.removeEntity(child));\n      }\n      child.parent.ifSome((parent) => parent._removeChild(child));\n\n      this.children.push(child);\n\n      child.parent.replace(this);\n      child.root = this.root;\n      child.setDepth(this.depth + 1);\n      this.scene.ifSome((scene) => scene.UNSAFE_addEntityNow(child, true));\n\n      this.emit(\"add-child\", child);\n    }\n    return this;\n  }\n  private _removeChild(child: Entity) {\n    this.scene.ifSome((scene) => scene.UNSAFE_removeEntityNow(child));\n    this.UNSAFE_removeChild(child);\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_removeChild(child: Entity) {\n    const index = this.children.indexOf(child);\n\n    if (index !== -1) {\n      this.emit(\"remove-child\", child);\n      this.children.splice(index, 1);\n\n      child.scene.clear();\n      child.parent.clear();\n      child.root = child;\n      child.setDepth(0);\n    }\n    return this;\n  }\n\n  private setDepth(depth: number) {\n    this.depth = depth;\n    for (const child of this.children) {\n      child.setDepth(depth + 1);\n    }\n    return this;\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      name: this.name.unwrapOr(null as any),\n      tags: [...this.tags.values()],\n      children: this.children.map((child) => child.toJSON()),\n      components: [...this.components.values()].map((component) =>\n        component.toJSON()\n      ),\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (json.name) {\n      this.name.replace(json.name as string);\n    }\n    if (isJSONArray(json.tags)) {\n      this.addTags(json.tags as string[]);\n    }\n    if (isJSONArray(json.children)) {\n      this.addChildren(\n        json.children.map((childJSON) =>\n          new Entity().fromJSON(childJSON as IJSONObject)\n        )\n      );\n    }\n    if (isJSONArray(json.components)) {\n      this.addComponents(\n        json.components.map(\n          (componentJSON) =>\n            Component.newFromJSON(componentJSON as IJSONObject) as Component\n        )\n      );\n    }\n    return this;\n  }\n}\n","import { IJSONObject, isJSONArray } from \"@aicacia/json\";\nimport { none, Option, some, IConstructor } from \"@aicacia/core\";\nimport type { Component } from \"./Component\";\nimport { Entity } from \"./Entity\";\nimport type { Manager } from \"./Manager\";\nimport { Plugin } from \"./Plugin\";\nimport { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\nexport interface ISceneEventTypes {\n  maintain(): void;\n  update(): void;\n  init(): void;\n  clear(): void;\n  \"add-component\": (component: Component) => void;\n  \"remove-component\": (component: Component) => void;\n  \"add-plugin\": (plugin: Plugin) => void;\n  \"remove-plugin\": (plugin: Plugin) => void;\n  \"add-entity\": (entity: Entity) => void;\n  \"remove-entity\": (entity: Entity) => void;\n}\n\nexport class Scene extends ToFromJSONEventEmitter<ISceneEventTypes> {\n  private name: Option<string> = none();\n\n  private entities: Entity[] = [];\n  private entitiesToAdd: Entity[] = [];\n  private entitiesToRemove: Entity[] = [];\n\n  private managers: Manager[] = [];\n  private managerMap: Map<IConstructor<Manager>, Manager> = new Map();\n\n  private plugins: Plugin[] = [];\n  private pluginsMap: Map<IConstructor<Plugin>, Plugin> = new Map();\n\n  private isUpdating = false;\n  private isInitted = false;\n\n  init() {\n    if (!this.isInitted) {\n      this.isInitted = true;\n      this.emit(\"init\");\n      this.maintain();\n      for (const plugin of this.plugins) {\n        plugin.onInit();\n      }\n      for (const manager of this.managers) {\n        manager.onInit();\n      }\n      this.isInitted = true;\n    }\n    return this;\n  }\n\n  maintain(emit = true) {\n    emit && this.emit(\"maintain\");\n    for (const entity of this.entitiesToRemove) {\n      this.removeEntityNow(entity, true);\n    }\n    this.entitiesToRemove.length = 0;\n    for (const entity of this.entitiesToAdd) {\n      this.addEntityNow(entity, true);\n    }\n    this.entitiesToAdd.length = 0;\n    return this;\n  }\n\n  update() {\n    this.init();\n    this.isUpdating = true;\n    this.emit(\"update\");\n    this.maintain();\n    for (const plugin of this.plugins) {\n      plugin.onUpdate();\n    }\n    for (const manager of this.managers) {\n      manager.onUpdate();\n    }\n    for (const manager of this.managers) {\n      manager.onAfterUpdate();\n    }\n    for (const plugin of this.plugins) {\n      plugin.onAfterUpdate();\n    }\n    this.isUpdating = false;\n    return this;\n  }\n\n  clear() {\n    this.emit(\"clear\");\n    this.removeEntities(this.entities);\n    this.removePlugin(...this.pluginsMap.keys());\n    return this;\n  }\n\n  getName() {\n    return this.name;\n  }\n  setName(name: string) {\n    this.name.replace(name);\n    return this;\n  }\n  removeName() {\n    this.name.take();\n    return this;\n  }\n\n  forEachEntity(fn: (entity: Entity) => false | void, recur = true) {\n    for (const entity of this.entities) {\n      if (fn(entity) === false) {\n        break;\n      }\n\n      if (recur) {\n        entity.forEachChild(fn, recur);\n      }\n    }\n    return this;\n  }\n  find(fn: (entity: Entity) => boolean, recur = true): Option<Entity> {\n    for (const entity of this.entities) {\n      if (fn(entity)) {\n        return some(entity);\n      } else if (recur) {\n        const found = entity.find(fn, recur);\n\n        if (found.isSome()) {\n          return found;\n        }\n      }\n    }\n\n    return none();\n  }\n  findWithTag(...tags: string[]) {\n    return this.find((entity) => entity.hasTags(tags), true);\n  }\n  findWithTags(tags: string[]) {\n    return this.findWithTag(...tags);\n  }\n  findWithName(name: string) {\n    return this.find(\n      (entity) =>\n        entity\n          .getName()\n          .map((entityName) => entityName === name)\n          .unwrapOr(false),\n      true\n    );\n  }\n\n  findAll(fn: (entity: Entity) => boolean, recur = true): Entity[] {\n    const matching = [];\n\n    for (const entity of this.entities) {\n      if (fn(entity)) {\n        matching.push(entity);\n      } else if (recur) {\n        matching.push(...entity.findAll(fn, recur));\n      }\n    }\n\n    return matching;\n  }\n  findAllWithTag(...tags: string[]) {\n    return this.findAll((entity) => entity.hasTags(tags), true);\n  }\n  findAllWithTags(tags: string[]) {\n    return this.findAllWithTag(...tags);\n  }\n  findAllWithName(name: string) {\n    return this.findAll(\n      (entity) =>\n        entity\n          .getName()\n          .map((entityName) => entityName === name)\n          .unwrapOr(false),\n      true\n    );\n  }\n\n  getEntities(): readonly Entity[] {\n    return this.entities;\n  }\n\n  getManagers(): readonly Manager[] {\n    return this.managers;\n  }\n\n  getManager<M extends Manager>(Manager: IConstructor<M>): Option<M> {\n    return Option.from(this.managerMap.get(Manager)) as Option<M>;\n  }\n  getRequiredManager<M extends Manager>(Manager: IConstructor<M>) {\n    return this.getManager(Manager).expect(\n      () => `Scene required ${Manager} Manager`\n    );\n  }\n\n  getPlugins(): readonly Plugin[] {\n    return this.plugins;\n  }\n\n  hasPlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin).isSome();\n  }\n  getPlugin<P extends Plugin>(Plugin: IConstructor<P>): Option<P> {\n    return Option.from(this.pluginsMap.get(Plugin)) as Option<P>;\n  }\n  getRequiredPlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    return this.getPlugin(Plugin).expect(\n      () => `Scene required ${Plugin} Plugin`\n    );\n  }\n\n  addPlugins(plugins: Plugin[]) {\n    for (const plugin of plugins) {\n      this._addPlugin(plugin);\n    }\n    return this.sortPlugins();\n  }\n  addPlugin(...plugins: Plugin[]) {\n    return this.addPlugins(plugins);\n  }\n\n  removePlugins(Plugins: IConstructor<Plugin>[]) {\n    for (const Plugin of Plugins) {\n      this._removePlugin(Plugin);\n    }\n    return this;\n  }\n  removePlugin(...plugins: IConstructor<Plugin>[]) {\n    return this.removePlugins(plugins);\n  }\n\n  addEntities(entities: Entity[]) {\n    this.entitiesToAdd.push(...entities);\n    return this;\n  }\n  addEntity(...entities: Entity[]) {\n    return this.addEntities(entities);\n  }\n\n  removeEntities(entities: Entity[]) {\n    this.entitiesToRemove.push(...entities);\n    return this;\n  }\n  removeEntity(...entities: Entity[]) {\n    return this.removeEntities(entities);\n  }\n\n  addEntityNow(entity: Entity, force = false) {\n    if (this.isUpdating && !force) {\n      throw new Error(\n        \"Scene.addEntityNow called while updating, use force to suppress this Error\"\n      );\n    }\n    return this.UNSAFE_addEntityNow(entity, false);\n  }\n\n  removeEntityNow(entity: Entity, force = false) {\n    if (this.isUpdating && !force) {\n      throw new Error(\n        \"Scene.removeEntityNow called while updating, use force to suppress this Error\"\n      );\n    }\n    return this.UNSAFE_removeEntityNow(entity);\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_addComponent(component: Component) {\n    const Manager: IConstructor<Manager> = component.getManagerConstructor();\n\n    const managerOption = this.getManager(Manager);\n    let manager: Manager;\n\n    if (managerOption.isNone()) {\n      manager = new Manager();\n\n      manager.UNSAFE_setScene(this);\n\n      this.managers.push(manager);\n      this.managerMap.set(Manager, manager);\n      this.sortManagers();\n\n      manager.onAdd();\n    } else {\n      manager = managerOption.unwrap();\n    }\n\n    manager.addComponent(component);\n    component.UNSAFE_setManager(manager);\n\n    manager.sort();\n    component.onAdd();\n\n    component.emit(\"add-to-scene\");\n    this.emit(\"add-component\", component);\n\n    return this;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_removeComponent(component: Component) {\n    const Manager: IConstructor<Manager> = component.getManagerConstructor();\n\n    const managerOption = this.getManager(Manager);\n\n    this.emit(\"remove-component\", component);\n    component.emit(\"remove-from-scene\");\n\n    managerOption.ifSome((manager) => {\n      component.onRemove();\n\n      manager.removeComponent(component);\n      component.UNSAFE_removeManager();\n\n      if (manager.isEmpty()) {\n        manager.onRemove();\n\n        this.managers.splice(this.managers.indexOf(manager), 1);\n        this.managerMap.delete(Manager);\n      }\n    });\n\n    return this;\n  }\n  /**\n   * @ignore\n   */\n  UNSAFE_addEntityNow(entity: Entity, isChild: boolean) {\n    const entitySceneOption = entity.getScene();\n\n    if (entitySceneOption.isSome()) {\n      const entityScene = entitySceneOption.unwrap();\n\n      if (entityScene === this) {\n        throw new Error(\n          \"Scene trying to add an Entity that is already a member of the Scene\"\n        );\n      } else {\n        entityScene.removeEntityNow(entity, true);\n      }\n    }\n\n    if (entity.isRoot()) {\n      this.entities.push(entity);\n    } else if (!isChild) {\n      throw new Error(\n        \"Scene trying to add an Entity that already has a parent\"\n      );\n    }\n\n    entity.UNSAFE_setScene(this);\n    for (const component of entity.getComponents().values()) {\n      this.UNSAFE_addComponent(component);\n    }\n    for (const child of entity.getChildren()) {\n      this.UNSAFE_addEntityNow(child, true);\n    }\n\n    if (process.env.NODE_ENV !== \"production\") {\n      entity.validateRequirements();\n    }\n\n    this.emit(\"add-entity\", entity);\n\n    return this;\n  }\n\n  /**\n   * @ignore\n   */\n  UNSAFE_removeEntityNow(entity: Entity) {\n    const entitySceneOption = entity.getScene();\n\n    if (entitySceneOption.isSome()) {\n      const entityScene = entitySceneOption.unwrap();\n\n      if (entityScene !== this) {\n        throw new Error(\n          \"Scene trying to remove an Entity that is not a member of the Scene\"\n        );\n      }\n    }\n\n    for (const component of entity.getComponents().values()) {\n      this.UNSAFE_removeComponent(component);\n    }\n\n    if (entity.isRoot()) {\n      const index = this.entities.indexOf(entity);\n\n      if (index !== -1) {\n        this.entities.splice(index, 1);\n        entity.UNSAFE_removeScene();\n      }\n    } else {\n      entity.getParent().ifSome((parent) => parent.UNSAFE_removeChild(entity));\n    }\n\n    for (const child of entity.getChildren().slice()) {\n      this.removeEntityNow(child, true);\n    }\n    this.emit(\"remove-entity\", entity);\n\n    return this;\n  }\n\n  private _addPlugin<P extends Plugin>(plugin: P) {\n    const Plugin: IConstructor<Plugin> = plugin.getConstructor();\n\n    if (!this.hasPlugin(Plugin)) {\n      const Plugin: IConstructor<Plugin> = plugin.getConstructor();\n\n      this.plugins.push(plugin);\n      this.pluginsMap.set(Plugin, plugin);\n      plugin.UNSAFE_setScene(this);\n      if (this.isInitted) {\n        plugin.onInit();\n      }\n      plugin.onAdd();\n      if (process.env.NODE_ENV !== \"production\") {\n        plugin.validateRequirements();\n      }\n      this.emit(\"add-plugin\", plugin);\n    }\n    return this;\n  }\n  private _removePlugin<P extends Plugin>(Plugin: IConstructor<P>) {\n    this.getPlugin(Plugin).ifSome((plugin) => {\n      this.emit(\"remove-plugin\", plugin);\n      plugin.onRemove();\n      plugin.UNSAFE_removeScene();\n      this.plugins.splice(this.plugins.indexOf(plugin), 1);\n      this.pluginsMap.delete(Plugin);\n    });\n\n    return this;\n  }\n\n  private sortPlugins() {\n    this.plugins.sort(this.sortPluginsFunction);\n    return this;\n  }\n  private sortPluginsFunction = (a: Plugin, b: Plugin) => {\n    return a.getPluginPriority() - b.getPluginPriority();\n  };\n\n  private sortManagers() {\n    this.managers.sort(this.managerSortFunction);\n    return this;\n  }\n  private managerSortFunction(a: Manager, b: Manager) {\n    return a.getManagerPriority() - b.getManagerPriority();\n  }\n\n  toJSON(): IJSONObject {\n    return {\n      ...super.toJSON(),\n      name: this.name.unwrapOr(null as any),\n      plugins: this.plugins\n        .filter((plugin) =>\n          (plugin.getConstructor() as any).isToFromJSONEnabled()\n        )\n        .map((plugin) => plugin.toJSON()),\n      entities: this.entities.map((entity) => entity.toJSON()),\n    };\n  }\n\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    if (json.name) {\n      this.name.replace(json.name as string);\n    }\n    if (isJSONArray(json.plugins)) {\n      this.addPlugins(\n        (json.plugins as Array<IJSONObject>).map((plugin) =>\n          Plugin.newFromJSON(plugin)\n        )\n      );\n    }\n    if (isJSONArray(json.entities)) {\n      this.addEntities(\n        json.entities.map((entity) =>\n          new Entity().fromJSON(entity as IJSONObject)\n        )\n      );\n    }\n    return this.maintain(false);\n  }\n}\n","import { ToFromJSONEventEmitter } from \"./ToFromJSONEventEmitter\";\n\n// tslint:disable-next-line: interface-name\nexport interface Entity {\n  on(\n    event: \"resize\",\n    listener: (\n      width: number,\n      height: number,\n      prevWidth: number,\n      prevHeight: number\n    ) => void\n  ): this;\n  off(\n    event: \"resize\",\n    listener: (\n      width: number,\n      height: number,\n      prevWidth: number,\n      prevHeight: number\n    ) => void\n  ): this;\n}\n\nexport abstract class Canvas extends ToFromJSONEventEmitter {\n  private width = 1;\n  private height = 1;\n\n  getWidth() {\n    return this.width;\n  }\n  getHeight() {\n    return this.height;\n  }\n\n  setWidth(width: number) {\n    return this.set(width, this.height);\n  }\n  setHeight(height: number) {\n    return this.set(this.width, height);\n  }\n\n  set(width: number, height: number) {\n    const prevWidth = this.width,\n      prevHeight = this.height;\n\n    if (width !== prevWidth || height !== prevHeight) {\n      this.width = width;\n      this.height = height;\n\n      this.onResize();\n      this.emit(\"resize\", width, height, prevWidth, prevHeight);\n    }\n    return this;\n  }\n\n  abstract onResize(): this;\n}\n","import type { CtxRenderer } from \"./CtxRenderer\";\nimport { RendererHandler } from \"../../../plugins/renderer/RendererHandler\";\n\nexport abstract class CtxRendererHandler extends RendererHandler<CtxRenderer> {\n  static rendererHandlerPriority = 0;\n\n  getCtx() {\n    return this.getRequiredRenderer().getCtx();\n  }\n  getCamera() {\n    return this.getRequiredRenderer().getCamera();\n  }\n  getScale() {\n    return this.getRequiredRenderer().getScale();\n  }\n}\n","import { TransformComponentManager } from \"../../../../components/TransformComponentManager\";\nimport { CtxRendererHandler } from \"../CtxRendererHandler\";\nimport { mat2d } from \"gl-matrix\";\n\nconst MAT2D_0 = mat2d.create();\n\nexport class TransformCtxRendererHandler extends CtxRendererHandler {\n  onRender() {\n    this.getManager(TransformComponentManager).ifSome(\n      (transformComponentManager) => {\n        const renderer = this.getRequiredRenderer(),\n          scale = renderer.getScale();\n\n        for (const transform of transformComponentManager.getComponents()) {\n          if (transform.getRenderable()) {\n            renderer.render((ctx) => {\n              ctx.beginPath();\n              ctx.strokeStyle = \"#0c0\";\n              ctx.moveTo(0, 0);\n              ctx.lineTo(0, 0.5);\n              ctx.stroke();\n\n              ctx.beginPath();\n              ctx.strokeStyle = \"#00c\";\n              ctx.moveTo(0, 0);\n              ctx.lineTo(0.5, 0);\n              ctx.stroke();\n\n              ctx.beginPath();\n              ctx.arc(0, 0, scale * 2, 0, 2 * Math.PI);\n              ctx.fill();\n            }, transform.getMatrix2d(MAT2D_0));\n          }\n        }\n      }\n    );\n\n    return this;\n  }\n}\n","import { SpriteManager } from \"../../../../components/Sprite\";\nimport { TransformComponent } from \"../../../../components/TransformComponent\";\nimport { CtxRendererHandler } from \"../CtxRendererHandler\";\nimport { mat2d, vec2 } from \"gl-matrix\";\nimport type { WebImageAsset } from \"../../assets/WebImageAsset\";\nimport { getAABB2FromRect } from \"../../../../math\";\nimport { AABB2 } from \"../../../../math/AABB2\";\n\nconst MAT2_0 = mat2d.create(),\n  AABB2_0 = AABB2.create(),\n  AABB2_1 = AABB2.create(),\n  VEC2_0 = vec2.create(),\n  VEC2_1 = vec2.create();\n\nexport class SpriteCtxRendererHandler extends CtxRendererHandler {\n  onRender() {\n    this.getManager(SpriteManager).ifSome((spriteManager) => {\n      const renderer = this.getRequiredRenderer(),\n        cameraAABB2 = this.getCamera().getAABB2(AABB2_0),\n        aabb = AABB2_1,\n        tmp0 = VEC2_0,\n        tmp1 = VEC2_1;\n\n      for (const sprite of spriteManager.getComponents()) {\n        const imageOption = sprite\n          .getImageAsset<WebImageAsset>()\n          .flatMap((webImageAsset) => webImageAsset.getImage());\n\n        if (sprite.getRenderable() && imageOption.isSome()) {\n          const image = imageOption.unwrap(),\n            transform = TransformComponent.getRequiredTransform(\n              sprite.getRequiredEntity()\n            );\n\n          getAABB2FromRect(\n            aabb,\n            transform.getPosition2(tmp0),\n            transform.getRotationZ(),\n            sprite.getSize(tmp1)\n          );\n\n          if (AABB2.notIntersects(cameraAABB2, aabb)) {\n            continue;\n          }\n\n          renderer.render((ctx) => {\n            const width = sprite.getWidth(),\n              height = sprite.getHeight(),\n              halfWidth = width * 0.5,\n              halfHeight = height * 0.5;\n\n            ctx.scale(1, -1);\n            ctx.drawImage(\n              image,\n              sprite.getClipX(),\n              sprite.getClipY(),\n              sprite.getClipWidth(),\n              sprite.getClipHeight(),\n              -halfWidth,\n              -halfHeight,\n              width,\n              height\n            );\n          }, transform.getMatrix2d(MAT2_0));\n        }\n      }\n    });\n\n    return this;\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport { mat2d } from \"gl-matrix\";\nimport { Camera2D, Camera2DManager } from \"../../../components/Camera2D\";\nimport { toRgba } from \"../../../math\";\nimport { Renderer } from \"../../../plugins/renderer/Renderer\";\nimport type { IJSONObject } from \"@aicacia/json\";\n\nconst MAT2D_0 = mat2d.create();\n\nexport class CtxRenderer extends Renderer {\n  static toFromJSONEnabled = false;\n\n  private element: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private lineWidth = 1.0;\n  private camera: Option<Camera2D> = none();\n  private cameraView: mat2d = mat2d.create();\n  private cameraProjection: mat2d = mat2d.create();\n  private cameraViewProjection: mat2d = mat2d.create();\n  private scale = 1.0;\n  private enabled = true;\n\n  constructor(element: HTMLCanvasElement) {\n    super();\n\n    this.element = element;\n    this.ctx = element.getContext(\"2d\") as CanvasRenderingContext2D;\n  }\n\n  getCameraView() {\n    return this.cameraView;\n  }\n  getCameraProjection() {\n    return this.cameraProjection;\n  }\n  getCameraViewProjection() {\n    return this.cameraViewProjection;\n  }\n  getElement() {\n    return this.element;\n  }\n  getCtx() {\n    return this.ctx;\n  }\n\n  getEnabled() {\n    return this.enabled;\n  }\n  setEnabled(enabled = true) {\n    this.enabled = enabled;\n    return this;\n  }\n\n  getLineWidth() {\n    return this.lineWidth;\n  }\n  setLineWidth(lineWidth: number) {\n    this.lineWidth = lineWidth;\n    return this;\n  }\n\n  getActiveCamera = () => {\n    return this.getRequiredScene()\n      .getRequiredManager(Camera2DManager)\n      .getRequiredActive();\n  };\n  getCamera() {\n    return this.camera.unwrapOrElse(this.getActiveCamera);\n  }\n  setCamera(camera: Camera2D) {\n    this.camera.replace(camera);\n    return this;\n  }\n  removeCamera() {\n    this.camera.clear();\n    return this;\n  }\n\n  private getCanvasSize() {\n    const width = this.element.width,\n      height = this.element.height;\n\n    return (width > height ? height : width) * 0.5;\n  }\n  getScale() {\n    return this.scale;\n  }\n\n  render(fn: (ctx: CanvasRenderingContext2D) => void, model?: mat2d) {\n    const mvp = MAT2D_0;\n\n    if (model) {\n      mat2d.mul(mvp, this.cameraViewProjection, model);\n    } else {\n      mat2d.copy(mvp, this.cameraViewProjection);\n    }\n    this.ctx.save();\n    this.ctx.transform(mvp[0], mvp[1], mvp[2], mvp[3], mvp[4], mvp[5]);\n    fn(this.ctx);\n    this.ctx.restore();\n    return this;\n  }\n\n  onUpdate() {\n    if (!this.enabled) {\n      return this;\n    }\n    const camera = this.getCamera(),\n      width = this.element.width,\n      height = this.element.height,\n      halfWidth = width * 0.5,\n      halfHeight = height * 0.5;\n\n    camera.set(width, height);\n    mat2d.copy(this.cameraView, camera.getView());\n    mat2d.copy(this.cameraProjection, camera.getProjection());\n    mat2d.mul(\n      this.cameraViewProjection,\n      this.cameraProjection,\n      this.cameraView\n    );\n    this.scale = (1.0 / this.getCanvasSize()) * camera.getZoom();\n\n    this.ctx.save();\n\n    this.ctx.save();\n    this.ctx.fillStyle = toRgba(camera.getBackground());\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.restore();\n\n    this.ctx.lineWidth = this.getLineWidth() * this.getScale();\n    this.ctx.transform(halfWidth, 0, 0, -halfHeight, halfWidth, halfHeight);\n\n    super.onUpdate();\n    this.ctx.restore();\n\n    return this;\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      lineWidth: this.lineWidth,\n      enabled: this.enabled,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.lineWidth = json.lineWidth as number;\n    this.enabled = json.enabled as boolean;\n    return this;\n  }\n}\n","import { none, Option } from \"@aicacia/core\";\nimport type { IJSONObject } from \"@aicacia/json\";\nimport { ImageAsset } from \"../../../plugins/assets/ImageAsset\";\n\nexport class WebImageAsset extends ImageAsset {\n  private image: Option<HTMLImageElement> = none();\n  private src: string;\n\n  constructor(src: string) {\n    super();\n    this.src = src;\n  }\n\n  getImage() {\n    return this.image;\n  }\n  getWidth() {\n    return this.image.map((image) => image.width).unwrapOr(0);\n  }\n  getHeight() {\n    return this.image.map((image) => image.height).unwrapOr(0);\n  }\n\n  protected loadAsset() {\n    return new Promise<void>((resolve, reject) => {\n      const image = new Image();\n\n      image.addEventListener(\"load\", () => {\n        this.image.replace(image);\n        resolve();\n      });\n      image.addEventListener(\"error\", (error) => reject(error));\n      image.src = this.src;\n    });\n  }\n\n  protected unloadAsset() {\n    this.image.clear();\n    return Promise.resolve();\n  }\n\n  toJSON() {\n    return {\n      ...super.toJSON(),\n      src: this.src,\n    };\n  }\n  fromJSON(json: IJSONObject) {\n    super.fromJSON(json);\n    this.src = json.src as string;\n    return this;\n  }\n}\n","import { EventListener } from \"../../../plugins/input/EventListener\";\nimport { Pool } from \"@aicacia/pool\";\nimport {\n  TouchInputEvent,\n  MouseInputEvent,\n  MouseWheelInputEvent,\n  KeyboardInputEvent,\n  ResizeInputEvent,\n} from \"../../../plugins/input\";\n\nexport class WebEventListener extends EventListener {\n  static toFromJSONEnabled = false;\n\n  private touchInputEventPool = new Pool(TouchInputEvent, TouchInputEvent.init);\n  private mouseInputEventPool = new Pool(MouseInputEvent, MouseInputEvent.init);\n  private mouseWheelInputEventPool = new Pool(\n    MouseWheelInputEvent,\n    MouseWheelInputEvent.init\n  );\n  private keyboardInputEventPool = new Pool(\n    KeyboardInputEvent,\n    KeyboardInputEvent.init\n  );\n  private resizeInputEventPool = new Pool(\n    ResizeInputEvent,\n    ResizeInputEvent.init\n  );\n\n  private element: Element;\n  private window: Window;\n\n  constructor(element: Element) {\n    super();\n\n    this.element = element;\n    this.window = element.ownerDocument.defaultView as Window;\n  }\n\n  onAdd() {\n    this.window.addEventListener(\"orientationchange\", this.onResize);\n    this.window.addEventListener(\"resize\", this.onResize);\n\n    this.element.addEventListener(\"touchstart\", this.onTouch);\n    this.element.addEventListener(\"touchmove\", this.onTouch);\n    this.element.addEventListener(\"touchend\", this.onTouch);\n    this.element.addEventListener(\"touchcancel\", this.onTouch);\n\n    this.element.addEventListener(\"mousemove\", this.onMouse);\n    this.element.addEventListener(\"mousedown\", this.onMouse);\n    this.element.addEventListener(\"mouseup\", this.onMouse);\n    this.element.addEventListener(\"wheel\", this.onMouseWheel);\n    this.element.addEventListener(\"mouseleave\", this.onMouse);\n\n    this.element.addEventListener(\"keydown\", this.onKeyboard);\n    this.element.addEventListener(\"keyup\", this.onKeyboard);\n\n    this.onResize();\n\n    return this;\n  }\n\n  onRemove() {\n    this.window.removeEventListener(\"orientationchange\", this.onResize);\n    this.window.removeEventListener(\"resize\", this.onResize);\n\n    this.element.removeEventListener(\"touchstart\", this.onTouch);\n    this.element.removeEventListener(\"touchmove\", this.onTouch);\n    this.element.removeEventListener(\"touchend\", this.onTouch);\n    this.element.removeEventListener(\"touchcancel\", this.onTouch);\n\n    this.element.removeEventListener(\"mousemove\", this.onMouse);\n    this.element.removeEventListener(\"mousedown\", this.onMouse);\n    this.element.removeEventListener(\"mouseup\", this.onMouse);\n    this.element.removeEventListener(\"wheel\", this.onMouseWheel);\n    this.element.removeEventListener(\"mouseleave\", this.onMouse);\n\n    this.element.removeEventListener(\"keydown\", this.onKeyboard);\n    this.element.removeEventListener(\"keyup\", this.onKeyboard);\n\n    return this;\n  }\n\n  onResize = () => {\n    const event = this.resizeInputEventPool.create(\"resize\");\n\n    event.width = this.window.innerWidth;\n    event.height = this.window.innerHeight;\n\n    this.queueEvent(event);\n  };\n\n  onTouch = (e: Event) => {\n    const touchEvent = e as TouchEvent,\n      elementRect = this.element.getBoundingClientRect();\n\n    for (let i = 0, il = touchEvent.touches.length; i < il; i++) {\n      const touch = touchEvent.touches[i],\n        x = touch.clientX - elementRect.left,\n        y = touch.clientY - elementRect.top,\n        event = this.touchInputEventPool.create(touchEvent.type as any);\n\n      event.id = touch.identifier;\n      event.x = x;\n      event.y = y;\n\n      this.queueEvent(event);\n    }\n  };\n\n  onMouse = (e: Event) => {\n    const mouseEvent = e as MouseEvent,\n      elementRect = this.element.getBoundingClientRect(),\n      x = mouseEvent.clientX - elementRect.left,\n      y = mouseEvent.clientY - elementRect.top,\n      event = this.mouseInputEventPool.create(mouseEvent.type as any);\n\n    event.button = mouseEvent.button;\n    event.x = x;\n    event.y = y;\n\n    this.queueEvent(event);\n  };\n\n  onMouseWheel = (e: Event) => {\n    const mouseWheelEvent = e as MouseWheelEvent,\n      event = this.mouseWheelInputEventPool.create(mouseWheelEvent.type as any);\n\n    event.wheel = mouseWheelEvent.deltaY;\n\n    this.queueEvent(event);\n  };\n\n  onKeyboard = (e: Event) => {\n    const keyEvent = e as KeyboardEvent,\n      event = this.keyboardInputEventPool.create(keyEvent.type as any);\n\n    event.code = keyEvent.code;\n\n    this.queueEvent(event);\n  };\n\n  dequeueEvent(event: InputEvent) {\n    if (event instanceof MouseInputEvent) {\n      this.mouseInputEventPool.release(event);\n      return true;\n    } else if (event instanceof KeyboardInputEvent) {\n      this.keyboardInputEventPool.release(event);\n      return true;\n    } else if (event instanceof MouseWheelInputEvent) {\n      this.mouseWheelInputEventPool.release(event);\n      return true;\n    } else if (event instanceof TouchInputEvent) {\n      this.touchInputEventPool.release(event);\n      return true;\n    } else {\n      return false;\n    }\n  }\n}\n","import { Canvas } from \"../Canvas\";\n\nexport class WebCanvas extends Canvas {\n  private canvas: HTMLCanvasElement;\n\n  constructor(canvas?: HTMLCanvasElement) {\n    super();\n\n    this.canvas = canvas ? canvas : document.createElement(\"canvas\");\n    this.set(this.canvas.width, this.canvas.height);\n  }\n\n  getElement() {\n    return this.canvas;\n  }\n\n  onResize() {\n    this.canvas.width = this.getWidth();\n    this.canvas.height = this.getHeight();\n    this.canvas.style.width = `${this.getWidth()}px`;\n    this.canvas.style.height = `${this.getHeight()}px`;\n    return this;\n  }\n\n  getImageURI() {\n    return this.canvas\n      .toDataURL(\"image/png\")\n      .replace(\"image/png\", \"image/octet-stream\");\n  }\n\n  getStream(fps = 60): MediaStream {\n    return (this.canvas as any).captureStream(fps);\n  }\n}\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","JSONClassRegistry","constructor","Map","getByConstructor","klass","Option","from","constructorToTypeId","get","map","typeId","storedKlass","typeIdToConstructor","Error","unwrapOrElse","getTypeId","set","getById","globalJSONClassRegistry","ToFromJSONEventEmitter","toString","isToFromJSONEnabled","toFromJSONEnabled","getConstructorFromJSON","json","expect","newFromJSON","fromJSON","getConstructor","getPrototypeOf","toJSON","_json","Manager","none","getManagerPriority","managerPriority","UNSAFE_setScene","scene","replace","UNSAFE_removeScene","clear","getScene","getPlugin","Plugin","flatMap","getRequiredPlugin","getManager","getRequiredManager","onAdd","onRemove","DefaultManager","a","b","getRequiredEntity","getDepth","getComponents","components","addComponent","component","removeComponent","index","indexOf","splice","isEmpty","sort","sortFunction","onInit","onUpdate","onAfterUpdate","Component","getManagerConstructor","getRequiredComponents","requiredComponents","getRequiredPlugins","requiredPlugins","getComponent","getEntity","entity","getRequiredComponent","UNSAFE_setEntity","UNSAFE_removeEntity","getRequiredScene","UNSAFE_setManager","manager","UNSAFE_removeManager","getSceneManager","getRequiredSceneManager","onDetach","RenderableComponent","getRenderable","renderable","setRenderable","DefaultDescriptorManager","TransformComponentManager","VEC2_0","vec2","VEC3_0","vec3","TransformComponent","getParentTransform","getParent","andThen","getTransform","_entity","getRequiredTransform","setNeedsUpdate","needsUpdate","setLocalNeedsUpdate","ifSome","child","getChildren","transform","getComponentsInstanceOf","getNeedsUpdate","localNeedsUpdate","getLocalNeedsUpdate","updateLocalMatrixIfNeeded","updateLocalMatrix","updateMatrixIfNeeded","updateMatrix","translate2","position","current","getLocalPosition2","add","setLocalPosition2","translate3","getLocalPosition3","setLocalPosition3","scale2","scale","getLocalScale2","mul","scale3","getLocalScale3","AABB2","fromValues","Infinity","min","max","out","setMin","setMax","copy","identity","expandPoint","aabb","v","union","intersects","notIntersects","DEG_TO_RAD","Math","PI","RAD_TO_DEG","HALF_PI","TAU","EPSILON","composeMat2d","rotation","sx","sy","c","cos","s","sin","extractScale_VEC2_0","extractScale","matrix","decomposeMat2d","getRotationFromMat2d","atan2","getPointFromAngle","angle","getAngleFromPoint","x","y","getTangentAngle_VEC2_0","getTangentAngle","vec","tmp","tmpX","getAngleBetweenPoints","sign","acos","dot","value","clamp","angleVec2","vec2FromAngle","projectPointOnAxis","point","axis","squaredLength","dotProduct","radToDeg","rad","degToRad","def","equals","abs","toHex","color","toRgb","toRgba","mat4FromMat2d","mat4","mat2dFromMat4","mat2d","getAABB2_points","getAABB2FromRect","size","points","hw","hh","forEach","rotate","VEC3_UP","MAT2_0","Transform2D","getLocalPosition","localPosition","setLocalPosition","getPosition2","getPosition","getPosition3","getLocalRotationZ","getLocalRotation","getLocalRotationQuat","quat","fromEuler","setLocalRotationZ","localRotation","setLocalRotation","setLocalRotationQuat","getAxisAngle","getRotationZ","getRotation","getRotationQuat","getLocalScale","localScale","setLocalScale2","setLocalScale","setLocalScale3","getScale2","getScale","getScale3","getMatrix","getLocalMatrix","localMatrix","mapOrElse","parentTransform","getMatrix2d","getMatrix4","getLocalMatrix4","getLocalMatrix2d","toLocalPosition","sub","lookAt","super","MAT4_0","QUAT_0","Transform3D","localRotationQuat","rotateZ","fromRotationTranslationScale","getScaling","getTranslation","up","targetTo","Camera2DManager","setActive","camera","unwrapOr","active","getActive","getRequiredActive","isNone","MAT2D_0","POINTS","Camera2D","Number","vec4","getBackground","background","setBackground","width","height","aspect","getWidth","setWidth","getHeight","setHeight","getAspect","getSize","setSize","minSize","maxSize","getMinSize","setMinSize","getMaxSize","setMaxSize","setZoom","zoom","getZoom","getView","invert","view","getProjection","updateProjectionIfNeeded","projection","getAABB2","transformMat2d","updateProjection","isActive","right","left","bottom","toRelative","screen","toWorld","mat","toScreen","world","Asset","v4","getUUID","uuid","getName","setName","isLoaded","loaded","isLoading","loading","load","Promise","resolve","loadAsset","then","catch","error","unload","unloadAsset","filterRequirements","requirements","filter","reduce","missing","requirement","isArray","some","requirementToString","join","getPluginPriority","pluginPriority","validateRequirements","missingPlugins","plugin","getPlugins","missingRequiredPlugins","P","hasPlugin","pluginMessage","missingRequirement","Assets","find","iter","assets","findWithName","asset","findAll","toArray","findAllWithName","loadingPromises","getAsset","assetMap","getAssets","getLoadedAssets","loadedAssets","getLoadingAssets","keys","getUnloadingAssets","unloadingPromises","getUnloadedAssets","addAsset","addAssets","_addAsset","removeAsset","removeAssets","_removeAsset","loadAll","loadAssets","loadAllInBackground","loadAssetsInBackground","loadAssetInBackground","unloadAssetInBackground","unloadAssetsInBackground","unloadAssets","all","_loadAsset","_unloadAsset","promise","delete","isJSONArray","JSONAsset","src","options","getJSON","fetch","response","RawJSONAsset","ImageAsset","RendererHandler","getRendererHandlerPriority","rendererHandlerPriority","getEnabled","enabled","setEnabled","UNSAFE_setRenderer","renderer","UNSAFE_removeRenderer","getRenderer","getRequiredRenderer","onBeforeRender","onRender","onAfterRender","Renderer","getRendererHandlers","rendererHandlers","getRendererHandler","rendererHandlerMap","addRendererHandlers","rendererHandler","_addRendererHandler","sortRendererHandlers","addRendererHandler","removeRendererHandlers","RendererHandlers","_removeRendererHandler","removeRendererHandler","sortRendererHandlersFunction","Time","Date","now","getStartTime","startTime","getDelta","delta","getRealDelta","getCurrent","getMinDelta","minDelta","setMinDelta","getMaxDelta","maxDelta","setMaxDelta","getFrame","frame","getFps","fps","setScale","getFixedDelta","fixedDelta","setFixedDelta","last","fpsFrame","fpsLast","RunOnUpdatePlugin","runOnUpdate","fns","queue","swap","EventListener","UNSAFE_setInput","input","UNSAFE_removeInput","getInput","getRequiredInput","queueEvent","_time","InputAxis","negButton","posButton","getNegButton","setNegButton","getPosButton","setPosButton","getGravity","gravity","setGravity","getSensitivity","sensitivity","setSensitivity","getDead","dead","setDead","getValue","UNSAFE_setValue","UNSAFE_update","time","isNeg","isPos","InputButton","getFrameDown","frameDown","getFrameUp","frameUp","UNSAFE_up","UNSAFE_down","InputHandler","MouseInputHandler","onEvent","type","getOrCreateButton","button","wheel","KeyboardInputHandler","code","TouchInputHandler","id","ResizeInputHandler","Input","addInputHandler","addAxis","addAxes","axes","_addAxis","getAxis","getAxisValue","getRequiredAxis","getInputHandler","inputHandlerMap","getRequiredInputHandler","getEventListener","eventListenerMap","getRequiredEventListener","removeAxes","_removeAxis","removeAxis","addInputHandlers","inputHandlers","inputHandler","_addInputHandler","removeInputHandlers","_removeInputHandler","removeInputHandler","addEventListeners","eventListeners","eventListener","_addEventListener","addEventListener","removeEventListeners","EventListeners","_removeEventListener","removeEventListener","buttons","newButton","getButton","getButtonValue","isDownCurrentFrame","isDown","isUp","isUpCurrentFrame","dequeueEvent","updateAxes","values","updateAxis","posValue","negValue","buttonJSON","axisJSON","InputEvent","init","KeyboardInputEvent","MouseInputEvent","MouseWheelInputEvent","ResizeInputEvent","TouchInputEvent","FullScreenCanvas","canvas","onResize","getCanvas","onResizeEventListener","win","window","p","performance","requestAnimationFrame","bind","cancelAnimationFrame","lastTime","callback","curr","next","setTimeout","h","clearTimeout","EventLoop","running","request","_ms","update","start","stop","isStopped","run","Loop","resolves","Camera2DControlManager","VEC2_1","VEC2_2","ZERO","MIN_SCALE","Camera2DControl","getPanSpeed","panSpeed","setPanSpeed","getZoomSpeed","zoomSpeed","setZoomSpeed","worldMouse","dragging","offset","lastMouse","mouseWheel","Camera3DManager","Camera3D","getFov","fov","setFov","getNear","near","setNear","getFar","far","setFar","orthographic","top","ortho","perspective","transformMat4","SpriteManager","layers","sprite","getOrCreateLayer","getLayer","layerIndex","layer","newLayer","Sprite","imageAsset","clipWidth","clipHeight","onImageLoadHandler","getClipX","clipX","setClipX","getClipY","clipY","setClipY","getClipWidth","setClipWidth","getClipHeight","setClipHeight","setLayer","managerOption","getImageAsset","setImageAsset","imageAssetUUID","onAddToScene","SpriteClip","getDuration","duration","setDuration","getX","setX","getY","setY","SpriteSheet","spriteSheets","spriteClips","getPlayBack","playBack","setPlayBack","setCurrent","currentName","currentFrame","currentTime","clips","clip","RunOnUpdateComponent","entityTransform","orElse","Entity","Set","removeName","take","hasTags","tags","every","tag","hasTag","getTags","addTags","removeTag","removeTags","clearTags","addTag","depth","getRoot","root","isRoot","hasParent","parent","isSome","hasScene","recur","children","forEachChild","found","childName","findWithTag","findWithTags","findWithComponent","matching","findAllWithTag","findAllWithTags","findAllWithComponent","findParent","hasComponent","getComponentInstanceOf","addComponents","_addComponent","removeComponents","Components","_removeComponent","removeFromScene","removeEntity","detach","_removeChild","addEntity","addChildren","_addChild","addChild","removeChildren","removeChild","missingComponents","missingRequiredComponents","C","componentMessage","entries","missingRequirements","UNSAFE_addComponent","UNSAFE_removeComponent","setDepth","UNSAFE_addEntityNow","UNSAFE_removeEntityNow","UNSAFE_removeChild","childJSON","componentJSON","Scene","isInitted","maintain","plugins","managers","entitiesToRemove","removeEntityNow","entitiesToAdd","addEntityNow","isUpdating","removeEntities","entities","removePlugin","pluginsMap","forEachEntity","entityName","getEntities","getManagers","managerMap","addPlugins","_addPlugin","sortPlugins","addPlugin","removePlugins","Plugins","_removePlugin","addEntities","force","sortManagers","unwrap","isChild","entitySceneOption","entityScene","sortPluginsFunction","managerSortFunction","Canvas","prevWidth","prevHeight","CtxRendererHandler","getCtx","getCamera","TransformCtxRendererHandler","transformComponentManager","render","ctx","beginPath","strokeStyle","moveTo","lineTo","stroke","arc","fill","AABB2_0","AABB2_1","SpriteCtxRendererHandler","spriteManager","cameraAABB2","tmp0","tmp1","imageOption","webImageAsset","getImage","image","halfWidth","halfHeight","drawImage","CtxRenderer","element","getContext","getCameraView","cameraView","getCameraProjection","cameraProjection","getCameraViewProjection","cameraViewProjection","getElement","getLineWidth","lineWidth","setLineWidth","getActiveCamera","setCamera","removeCamera","getCanvasSize","model","mvp","save","restore","fillStyle","fillRect","WebImageAsset","reject","Image","WebEventListener","Pool","resizeInputEventPool","innerWidth","innerHeight","e","touchEvent","elementRect","getBoundingClientRect","il","touches","touch","clientX","clientY","touchInputEventPool","identifier","mouseEvent","mouseInputEventPool","mouseWheelEvent","mouseWheelInputEventPool","deltaY","keyEvent","keyboardInputEventPool","ownerDocument","defaultView","onTouch","onMouse","onMouseWheel","onKeyboard","release","WebCanvas","document","createElement","style","getImageURI","toDataURL","getStream","captureStream"],"mappings":"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"}